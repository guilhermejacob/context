<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="1.6 Survey of Consumer Finances (SCF) | Poverty and Inequality with Complex Survey Data" />
<meta property="og:type" content="book" />

<meta property="og:description" content="A book about the R convey package" />
<meta name="github-repo" content="guilhermejacob/context" />

<meta name="author" content="By Guilherme Jacob, Anthony Damico, and Djalma Pessoa. The authors received no external funding for the convey software and this accompanying textbook." />

<meta name="date" content="2023-12-02" />

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<meta name="description" content="A book about the R convey package">

<title>1.6 Survey of Consumer Finances (SCF) | Poverty and Inequality with Complex Survey Data</title>

<link href="libs/tufte-css-2015.12.29/tufte-fonts.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte-background.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte-italics.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte.css" rel="stylesheet" />


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="toc.css" type="text/css" />

</head>

<body>



<div class="row">
<div class="col-sm-12">
<div id="TOC">
<ul>
<li class="has-sub"><a href="index.html#intro" id="toc-intro"><span class="toc-section-number">1</span> Intro</a>
<ul>
<li><a href="1.1-install.html#install" id="toc-install"><span class="toc-section-number">1.1</span> Installation</a></li>
<li><a href="1.2-survey.html#survey" id="toc-survey"><span class="toc-section-number">1.2</span> Complex surveys and statistical inference</a></li>
<li><a href="1.3-usage-examples.html#usage-examples" id="toc-usage-examples"><span class="toc-section-number">1.3</span> Usage Examples</a></li>
<li class="has-sub"><a href="1.4-current-population-survey---annual-social-and-economic-supplement-cps-asec.html#current-population-survey---annual-social-and-economic-supplement-cps-asec" id="toc-current-population-survey---annual-social-and-economic-supplement-cps-asec"><span class="toc-section-number">1.4</span> Current Population Survey - Annual Social and Economic Supplement (CPS-ASEC)</a>
<ul>
<li><a href="1.4-current-population-survey---annual-social-and-economic-supplement-cps-asec.html#household-income" id="toc-household-income"><span class="toc-section-number">1.4.1</span> Household Income</a></li>
<li><a href="1.4-current-population-survey---annual-social-and-economic-supplement-cps-asec.html#family-income" id="toc-family-income"><span class="toc-section-number">1.4.2</span> Family Income</a></li>
<li><a href="1.4-current-population-survey---annual-social-and-economic-supplement-cps-asec.html#worker-earnings" id="toc-worker-earnings"><span class="toc-section-number">1.4.3</span> Worker Earnings</a></li>
</ul></li>
<li class="has-sub"><a href="1.5-pesquisa-nacional-por-amostra-de-domicílios-contínua-pnad-contínua.html#pesquisa-nacional-por-amostra-de-domicílios-contínua-pnad-contínua" id="toc-pesquisa-nacional-por-amostra-de-domicílios-contínua-pnad-contínua"><span class="toc-section-number">1.5</span> Pesquisa Nacional por Amostra de Domicílios Contínua (PNAD-Contínua)</a>
<ul>
<li><a href="1.5-pesquisa-nacional-por-amostra-de-domicílios-contínua-pnad-contínua.html#per-capita-income" id="toc-per-capita-income"><span class="toc-section-number">1.5.1</span> Per Capita Income</a></li>
<li><a href="1.5-pesquisa-nacional-por-amostra-de-domicílios-contínua-pnad-contínua.html#worker-earnings-1" id="toc-worker-earnings-1"><span class="toc-section-number">1.5.2</span> Worker Earnings</a></li>
</ul></li>
<li class="has-sub"><a href="1.6-survey-of-consumer-finances-scf.html#survey-of-consumer-finances-scf" id="toc-survey-of-consumer-finances-scf"><span class="toc-section-number">1.6</span> Survey of Consumer Finances (SCF)</a>
<ul>
<li><a href="1.6-survey-of-consumer-finances-scf.html#analysis-examples-with-the-survey-library" id="toc-analysis-examples-with-the-survey-library"><span class="toc-section-number">1.6.1</span> Analysis Examples with the <code>survey</code> library</a></li>
<li><a href="1.6-survey-of-consumer-finances-scf.html#family-net-worth" id="toc-family-net-worth"><span class="toc-section-number">1.6.2</span> Family Net Worth</a></li>
<li><a href="1.6-survey-of-consumer-finances-scf.html#family-income-1" id="toc-family-income-1"><span class="toc-section-number">1.6.3</span> Family Income</a></li>
</ul></li>
</ul></li>
<li class="has-sub"><a href="2-var.html#var" id="toc-var"><span class="toc-section-number">2</span> Variance Estimation</a>
<ul>
<li class="has-sub"><a href="2.1-lin.html#lin" id="toc-lin"><span class="toc-section-number">2.1</span> Linearization-Based Variance Estimation</a>
<ul>
<li><a href="2.1-lin.html#influence-functions" id="toc-influence-functions"><span class="toc-section-number">2.1.1</span> Influence Functions</a></li>
</ul></li>
<li class="has-sub"><a href="2.2-replication-based-variance-estimation.html#replication-based-variance-estimation" id="toc-replication-based-variance-estimation"><span class="toc-section-number">2.2</span> Replication-Based Variance Estimation</a>
<ul>
<li><a href="2.2-replication-based-variance-estimation.html#replication-design-example" id="toc-replication-design-example"><span class="toc-section-number">2.2.1</span> Replication Design Example</a></li>
</ul></li>
<li><a href="2.3-variance-estimation-for-decompositions.html#variance-estimation-for-decompositions" id="toc-variance-estimation-for-decompositions"><span class="toc-section-number">2.3</span> Variance Estimation for Decompositions</a></li>
</ul></li>
<li class="has-sub"><a href="3-poverty.html#poverty" id="toc-poverty"><span class="toc-section-number">3</span> Poverty Indices</a>
<ul>
<li class="has-sub"><a href="3.1-at-risk-of-poverty-threshold-svyarpt.html#at-risk-of-poverty-threshold-svyarpt" id="toc-at-risk-of-poverty-threshold-svyarpt"><span class="toc-section-number">3.1</span> At Risk of Poverty Threshold (svyarpt)</a>
<ul>
<li><a href="3.1-at-risk-of-poverty-threshold-svyarpt.html#replication-example" id="toc-replication-example"><span class="toc-section-number">3.1.1</span> Replication Example</a></li>
</ul></li>
<li class="has-sub"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#at-risk-of-poverty-ratio-svyarpr" id="toc-at-risk-of-poverty-ratio-svyarpr"><span class="toc-section-number">3.2</span> At Risk of Poverty Ratio (svyarpr)</a>
<ul>
<li><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#replication-example-1" id="toc-replication-example-1"><span class="toc-section-number">3.2.1</span> Replication Example</a></li>
</ul></li>
<li class="has-sub"><a href="3.3-relative-median-income-ratio-svyrmir.html#relative-median-income-ratio-svyrmir" id="toc-relative-median-income-ratio-svyrmir"><span class="toc-section-number">3.3</span> Relative Median Income Ratio (svyrmir)</a>
<ul>
<li><a href="3.3-relative-median-income-ratio-svyrmir.html#replication-example-2" id="toc-replication-example-2"><span class="toc-section-number">3.3.1</span> Replication Example</a></li>
</ul></li>
<li class="has-sub"><a href="3.4-relative-median-poverty-gap-svyrmpg.html#relative-median-poverty-gap-svyrmpg" id="toc-relative-median-poverty-gap-svyrmpg"><span class="toc-section-number">3.4</span> Relative Median Poverty Gap (svyrmpg)</a>
<ul>
<li><a href="3.4-relative-median-poverty-gap-svyrmpg.html#replication-example-3" id="toc-replication-example-3"><span class="toc-section-number">3.4.1</span> Replication Example</a></li>
</ul></li>
<li class="has-sub"><a href="3.5-median-income-below-the-at-risk-of-poverty-threshold-svypoormed.html#median-income-below-the-at-risk-of-poverty-threshold-svypoormed" id="toc-median-income-below-the-at-risk-of-poverty-threshold-svypoormed"><span class="toc-section-number">3.5</span> Median Income Below the At Risk of Poverty Threshold (svypoormed)</a>
<ul>
<li><a href="3.5-median-income-below-the-at-risk-of-poverty-threshold-svypoormed.html#replication-example-4" id="toc-replication-example-4"><span class="toc-section-number">3.5.1</span> Replication Example</a></li>
</ul></li>
<li class="has-sub"><a href="3.6-foster-greer-thorbecke-class-svyfgt-svyfgtdec.html#foster-greer-thorbecke-class-svyfgt-svyfgtdec" id="toc-foster-greer-thorbecke-class-svyfgt-svyfgtdec"><span class="toc-section-number">3.6</span> Foster-Greer-Thorbecke class (svyfgt, svyfgtdec)</a>
<ul>
<li><a href="3.6-foster-greer-thorbecke-class-svyfgt-svyfgtdec.html#replication-example-5" id="toc-replication-example-5"><span class="toc-section-number">3.6.1</span> Replication Example</a></li>
<li><a href="3.6-foster-greer-thorbecke-class-svyfgt-svyfgtdec.html#monte-carlo-simulation" id="toc-monte-carlo-simulation"><span class="toc-section-number">3.6.2</span> Monte Carlo Simulation</a></li>
</ul></li>
<li class="has-sub"><a href="3.7-watts-poverty-measure-svywatts-svywattsdec.html#watts-poverty-measure-svywatts-svywattsdec" id="toc-watts-poverty-measure-svywatts-svywattsdec"><span class="toc-section-number">3.7</span> Watts poverty measure (svywatts, svywattsdec)</a>
<ul>
<li><a href="3.7-watts-poverty-measure-svywatts-svywattsdec.html#monte-carlo-simulation-1" id="toc-monte-carlo-simulation-1"><span class="toc-section-number">3.7.1</span> Monte Carlo Simulation</a></li>
</ul></li>
</ul></li>
<li class="has-sub"><a href="4-inequality.html#inequality" id="toc-inequality"><span class="toc-section-number">4</span> Inequality Measurement</a>
<ul>
<li><a href="4.1-which-inequality-measure-should-be-used.html#which-inequality-measure-should-be-used" id="toc-which-inequality-measure-should-be-used"><span class="toc-section-number">4.1</span> Which inequality measure should be used?</a></li>
<li class="has-sub"><a href="4.2-the-gender-pay-gap-svygpg.html#the-gender-pay-gap-svygpg" id="toc-the-gender-pay-gap-svygpg"><span class="toc-section-number">4.2</span> The Gender Pay Gap (svygpg)</a>
<ul>
<li><a href="4.2-the-gender-pay-gap-svygpg.html#replication-example-6" id="toc-replication-example-6"><span class="toc-section-number">4.2.1</span> Replication Example</a></li>
</ul></li>
<li class="has-sub"><a href="4.3-quintile-share-ratio-svyqsr.html#quintile-share-ratio-svyqsr" id="toc-quintile-share-ratio-svyqsr"><span class="toc-section-number">4.3</span> Quintile Share Ratio (svyqsr)</a>
<ul>
<li><a href="4.3-quintile-share-ratio-svyqsr.html#replication-example-7" id="toc-replication-example-7"><span class="toc-section-number">4.3.1</span> Replication Example</a></li>
</ul></li>
<li><a href="4.4-lorenz-curve-based-measures.html#lorenz-curve-based-measures" id="toc-lorenz-curve-based-measures"><span class="toc-section-number">4.4</span> Lorenz Curve-based Measures</a></li>
<li class="has-sub"><a href="4.5-lorenz-curve-svylorenz.html#lorenz-curve-svylorenz" id="toc-lorenz-curve-svylorenz"><span class="toc-section-number">4.5</span> Lorenz Curve (svylorenz)</a>
<ul>
<li><a href="4.5-lorenz-curve-svylorenz.html#replication-example-8" id="toc-replication-example-8"><span class="toc-section-number">4.5.1</span> Replication Example</a></li>
</ul></li>
<li class="has-sub"><a href="4.6-gini-index-svygini.html#gini-index-svygini" id="toc-gini-index-svygini"><span class="toc-section-number">4.6</span> Gini index (svygini)</a>
<ul>
<li><a href="4.6-gini-index-svygini.html#replication-example-9" id="toc-replication-example-9"><span class="toc-section-number">4.6.1</span> Replication Example</a></li>
<li><a href="4.6-gini-index-svygini.html#analysis-examples" id="toc-analysis-examples"><span class="toc-section-number">4.6.2</span> Analysis Examples</a></li>
</ul></li>
<li class="has-sub"><a href="4.7-zenga-index-svyzenga.html#zenga-index-svyzenga" id="toc-zenga-index-svyzenga"><span class="toc-section-number">4.7</span> Zenga index (svyzenga)</a>
<ul>
<li><a href="4.7-zenga-index-svyzenga.html#replication-example-10" id="toc-replication-example-10"><span class="toc-section-number">4.7.1</span> Replication Example</a></li>
</ul></li>
<li><a href="4.8-social-welfare-function-based-measures.html#social-welfare-function-based-measures" id="toc-social-welfare-function-based-measures"><span class="toc-section-number">4.8</span> Social Welfare Function-based Measures</a></li>
<li class="has-sub"><a href="4.9-atkinson-index-svyatk.html#atkinson-index-svyatk" id="toc-atkinson-index-svyatk"><span class="toc-section-number">4.9</span> Atkinson index (svyatk)</a>
<ul>
<li><a href="4.9-atkinson-index-svyatk.html#replication-example-11" id="toc-replication-example-11"><span class="toc-section-number">4.9.1</span> Replication Example</a></li>
</ul></li>
<li><a href="4.10-entropy-based-measures.html#entropy-based-measures" id="toc-entropy-based-measures"><span class="toc-section-number">4.10</span> Entropy-based Measures</a></li>
<li class="has-sub"><a href="4.11-generalized-entropy-and-decomposition-svygei-svygeidec.html#generalized-entropy-and-decomposition-svygei-svygeidec" id="toc-generalized-entropy-and-decomposition-svygei-svygeidec"><span class="toc-section-number">4.11</span> Generalized Entropy and Decomposition (svygei, svygeidec)</a>
<ul>
<li><a href="4.11-generalized-entropy-and-decomposition-svygei-svygeidec.html#replication-example-12" id="toc-replication-example-12"><span class="toc-section-number">4.11.1</span> Replication Example</a></li>
</ul></li>
<li class="has-sub"><a href="4.12-j-divergence-and-decomposition-svyjdiv-svyjdivdec.html#j-divergence-and-decomposition-svyjdiv-svyjdivdec" id="toc-j-divergence-and-decomposition-svyjdiv-svyjdivdec"><span class="toc-section-number">4.12</span> J-Divergence and Decomposition (svyjdiv, svyjdivdec)</a>
<ul>
<li><a href="4.12-j-divergence-and-decomposition-svyjdiv-svyjdivdec.html#monte-carlo-simulation-2" id="toc-monte-carlo-simulation-2"><span class="toc-section-number">4.12.1</span> Monte Carlo Simulation</a></li>
</ul></li>
</ul></li>
<li class="has-sub"><a href="5-richness.html#richness" id="toc-richness"><span class="toc-section-number">5</span> Richness</a>
<ul>
<li class="has-sub"><a href="5.1-richness-measures-svyrich.html#richness-measures-svyrich" id="toc-richness-measures-svyrich"><span class="toc-section-number">5.1</span> Richness Measures (svyrich)</a>
<ul>
<li><a href="5.1-richness-measures-svyrich.html#monte-carlo-simulation-3" id="toc-monte-carlo-simulation-3"><span class="toc-section-number">5.1.1</span> Monte Carlo Simulation</a></li>
</ul></li>
</ul></li>
<li class="has-sub"><a href="6-multidimensional-poverty.html#multidimensional-poverty" id="toc-multidimensional-poverty"><span class="toc-section-number">6</span> Multidimensional Poverty</a>
<ul>
<li><a href="6.1-example-calculation.html#example-calculation" id="toc-example-calculation"><span class="toc-section-number">6.1</span> Example Calculation</a></li>
</ul></li>
<li class="has-sub"><a href="7-covariance-matrix.html#covariance-matrix" id="toc-covariance-matrix"><span class="toc-section-number">7</span> Covariance Matrix</a>
<ul>
<li><a href="7.1-example-calculation-1.html#example-calculation-1" id="toc-example-calculation-1"><span class="toc-section-number">7.1</span> Example Calculation</a></li>
</ul></li>
</ul>
</div>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<div id="survey-of-consumer-finances-scf" class="section level2" number="1.6">
<h2><span class="header-section-number">1.6</span> Survey of Consumer Finances (SCF)</h2>
<p>The SCF studies net worth across the United States by asking respondents about both active and passive income, mortgages, pensions, credit card debt, even car leases. Administered by the <a href="https://www.federalreserve.gov/">Board of Governors of the Federal Reserve System</a> triennially since 1989, this complex sample survey generalizes to the civilian non-institutional population and comprehensively assesses household wealth.</p>
<p>This section downloads, imports, and prepares the most current microdata for analysis, then reproduces some statistics and margin of error terms from the Federal Reserve.</p>
<p>This survey uses a multiply-imputed variance estimation technique described in the <a href="https://www.federalreserve.gov/econres/files/2004_codebk2004.txt">2004 Codebook</a>. Most users do not need to study this function carefully. Define a function specific to only this dataset:</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="1.6-survey-of-consumer-finances-scf.html#cb54-1" tabindex="-1"></a>scf_MIcombine <span class="ot">&lt;-</span></span>
<span id="cb54-2"><a href="1.6-survey-of-consumer-finances-scf.html#cb54-2" tabindex="-1"></a>  <span class="cf">function</span> (results,</span>
<span id="cb54-3"><a href="1.6-survey-of-consumer-finances-scf.html#cb54-3" tabindex="-1"></a>            variances,</span>
<span id="cb54-4"><a href="1.6-survey-of-consumer-finances-scf.html#cb54-4" tabindex="-1"></a>            <span class="at">call =</span> <span class="fu">sys.call</span>(),</span>
<span id="cb54-5"><a href="1.6-survey-of-consumer-finances-scf.html#cb54-5" tabindex="-1"></a>            <span class="at">df.complete =</span> <span class="cn">Inf</span>,</span>
<span id="cb54-6"><a href="1.6-survey-of-consumer-finances-scf.html#cb54-6" tabindex="-1"></a>            ...) {</span>
<span id="cb54-7"><a href="1.6-survey-of-consumer-finances-scf.html#cb54-7" tabindex="-1"></a>    m <span class="ot">&lt;-</span> <span class="fu">length</span>(results)</span>
<span id="cb54-8"><a href="1.6-survey-of-consumer-finances-scf.html#cb54-8" tabindex="-1"></a>    oldcall <span class="ot">&lt;-</span> <span class="fu">attr</span>(results, <span class="st">&quot;call&quot;</span>)</span>
<span id="cb54-9"><a href="1.6-survey-of-consumer-finances-scf.html#cb54-9" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">missing</span>(variances)) {</span>
<span id="cb54-10"><a href="1.6-survey-of-consumer-finances-scf.html#cb54-10" tabindex="-1"></a>      variances <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>(<span class="fu">lapply</span>(results, vcov))</span>
<span id="cb54-11"><a href="1.6-survey-of-consumer-finances-scf.html#cb54-11" tabindex="-1"></a>      results <span class="ot">&lt;-</span> <span class="fu">lapply</span>(results, coef)</span>
<span id="cb54-12"><a href="1.6-survey-of-consumer-finances-scf.html#cb54-12" tabindex="-1"></a>    }</span>
<span id="cb54-13"><a href="1.6-survey-of-consumer-finances-scf.html#cb54-13" tabindex="-1"></a>    vbar <span class="ot">&lt;-</span> variances[[<span class="dv">1</span>]]</span>
<span id="cb54-14"><a href="1.6-survey-of-consumer-finances-scf.html#cb54-14" tabindex="-1"></a>    cbar <span class="ot">&lt;-</span> results[[<span class="dv">1</span>]]</span>
<span id="cb54-15"><a href="1.6-survey-of-consumer-finances-scf.html#cb54-15" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>m) {</span>
<span id="cb54-16"><a href="1.6-survey-of-consumer-finances-scf.html#cb54-16" tabindex="-1"></a>      cbar <span class="ot">&lt;-</span> cbar <span class="sc">+</span> results[[i]]</span>
<span id="cb54-17"><a href="1.6-survey-of-consumer-finances-scf.html#cb54-17" tabindex="-1"></a>      <span class="co"># MODIFICATION:</span></span>
<span id="cb54-18"><a href="1.6-survey-of-consumer-finances-scf.html#cb54-18" tabindex="-1"></a>      <span class="co"># vbar &lt;- vbar + variances[[i]]</span></span>
<span id="cb54-19"><a href="1.6-survey-of-consumer-finances-scf.html#cb54-19" tabindex="-1"></a>    }</span>
<span id="cb54-20"><a href="1.6-survey-of-consumer-finances-scf.html#cb54-20" tabindex="-1"></a>    cbar <span class="ot">&lt;-</span> cbar <span class="sc">/</span> m</span>
<span id="cb54-21"><a href="1.6-survey-of-consumer-finances-scf.html#cb54-21" tabindex="-1"></a>    <span class="co"># MODIFICATION:</span></span>
<span id="cb54-22"><a href="1.6-survey-of-consumer-finances-scf.html#cb54-22" tabindex="-1"></a>    <span class="co"># vbar &lt;- vbar/m</span></span>
<span id="cb54-23"><a href="1.6-survey-of-consumer-finances-scf.html#cb54-23" tabindex="-1"></a>    evar <span class="ot">&lt;-</span> <span class="fu">var</span>(<span class="fu">do.call</span>(<span class="st">&quot;rbind&quot;</span>, results))</span>
<span id="cb54-24"><a href="1.6-survey-of-consumer-finances-scf.html#cb54-24" tabindex="-1"></a>    r <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">/</span> m) <span class="sc">*</span> evar <span class="sc">/</span> vbar</span>
<span id="cb54-25"><a href="1.6-survey-of-consumer-finances-scf.html#cb54-25" tabindex="-1"></a>    df <span class="ot">&lt;-</span> (m <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">/</span> r) <span class="sc">^</span> <span class="dv">2</span></span>
<span id="cb54-26"><a href="1.6-survey-of-consumer-finances-scf.html#cb54-26" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.matrix</span>(df))</span>
<span id="cb54-27"><a href="1.6-survey-of-consumer-finances-scf.html#cb54-27" tabindex="-1"></a>      df <span class="ot">&lt;-</span> <span class="fu">diag</span>(df)</span>
<span id="cb54-28"><a href="1.6-survey-of-consumer-finances-scf.html#cb54-28" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.finite</span>(df.complete)) {</span>
<span id="cb54-29"><a href="1.6-survey-of-consumer-finances-scf.html#cb54-29" tabindex="-1"></a>      dfobs <span class="ot">&lt;-</span> ((df.complete <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">/</span> (df.complete <span class="sc">+</span> <span class="dv">3</span>)) <span class="sc">*</span> df.complete <span class="sc">*</span></span>
<span id="cb54-30"><a href="1.6-survey-of-consumer-finances-scf.html#cb54-30" tabindex="-1"></a>        vbar <span class="sc">/</span> (vbar <span class="sc">+</span> evar)</span>
<span id="cb54-31"><a href="1.6-survey-of-consumer-finances-scf.html#cb54-31" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">is.matrix</span>(dfobs))</span>
<span id="cb54-32"><a href="1.6-survey-of-consumer-finances-scf.html#cb54-32" tabindex="-1"></a>        dfobs <span class="ot">&lt;-</span> <span class="fu">diag</span>(dfobs)</span>
<span id="cb54-33"><a href="1.6-survey-of-consumer-finances-scf.html#cb54-33" tabindex="-1"></a>      df <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">/</span> dfobs <span class="sc">+</span> <span class="dv">1</span> <span class="sc">/</span> df)</span>
<span id="cb54-34"><a href="1.6-survey-of-consumer-finances-scf.html#cb54-34" tabindex="-1"></a>    }</span>
<span id="cb54-35"><a href="1.6-survey-of-consumer-finances-scf.html#cb54-35" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.matrix</span>(r))</span>
<span id="cb54-36"><a href="1.6-survey-of-consumer-finances-scf.html#cb54-36" tabindex="-1"></a>      r <span class="ot">&lt;-</span> <span class="fu">diag</span>(r)</span>
<span id="cb54-37"><a href="1.6-survey-of-consumer-finances-scf.html#cb54-37" tabindex="-1"></a>    rval <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb54-38"><a href="1.6-survey-of-consumer-finances-scf.html#cb54-38" tabindex="-1"></a>      <span class="at">coefficients =</span> cbar,</span>
<span id="cb54-39"><a href="1.6-survey-of-consumer-finances-scf.html#cb54-39" tabindex="-1"></a>      <span class="at">variance =</span> vbar <span class="sc">+</span> evar <span class="sc">*</span></span>
<span id="cb54-40"><a href="1.6-survey-of-consumer-finances-scf.html#cb54-40" tabindex="-1"></a>        (m <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">/</span> m,</span>
<span id="cb54-41"><a href="1.6-survey-of-consumer-finances-scf.html#cb54-41" tabindex="-1"></a>      <span class="at">call =</span> <span class="fu">c</span>(oldcall, call),</span>
<span id="cb54-42"><a href="1.6-survey-of-consumer-finances-scf.html#cb54-42" tabindex="-1"></a>      <span class="at">nimp =</span> m,</span>
<span id="cb54-43"><a href="1.6-survey-of-consumer-finances-scf.html#cb54-43" tabindex="-1"></a>      <span class="at">df =</span> df,</span>
<span id="cb54-44"><a href="1.6-survey-of-consumer-finances-scf.html#cb54-44" tabindex="-1"></a>      <span class="at">missinfo =</span> (r <span class="sc">+</span> <span class="dv">2</span> <span class="sc">/</span> (df <span class="sc">+</span> <span class="dv">3</span>)) <span class="sc">/</span> (r <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb54-45"><a href="1.6-survey-of-consumer-finances-scf.html#cb54-45" tabindex="-1"></a>    )</span>
<span id="cb54-46"><a href="1.6-survey-of-consumer-finances-scf.html#cb54-46" tabindex="-1"></a>    <span class="fu">class</span>(rval) <span class="ot">&lt;-</span> <span class="st">&quot;MIresult&quot;</span></span>
<span id="cb54-47"><a href="1.6-survey-of-consumer-finances-scf.html#cb54-47" tabindex="-1"></a>    rval</span>
<span id="cb54-48"><a href="1.6-survey-of-consumer-finances-scf.html#cb54-48" tabindex="-1"></a>  }</span></code></pre></div>
<p>Define a function to download and import each stata file:</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="1.6-survey-of-consumer-finances-scf.html#cb55-1" tabindex="-1"></a><span class="fu">library</span>(haven)</span>
<span id="cb55-2"><a href="1.6-survey-of-consumer-finances-scf.html#cb55-2" tabindex="-1"></a></span>
<span id="cb55-3"><a href="1.6-survey-of-consumer-finances-scf.html#cb55-3" tabindex="-1"></a>scf_dta_import <span class="ot">&lt;-</span></span>
<span id="cb55-4"><a href="1.6-survey-of-consumer-finances-scf.html#cb55-4" tabindex="-1"></a>  <span class="cf">function</span>(this_url) {</span>
<span id="cb55-5"><a href="1.6-survey-of-consumer-finances-scf.html#cb55-5" tabindex="-1"></a>    this_tf <span class="ot">&lt;-</span> <span class="fu">tempfile</span>()</span>
<span id="cb55-6"><a href="1.6-survey-of-consumer-finances-scf.html#cb55-6" tabindex="-1"></a>    </span>
<span id="cb55-7"><a href="1.6-survey-of-consumer-finances-scf.html#cb55-7" tabindex="-1"></a>    <span class="fu">download.file</span>(this_url , this_tf , <span class="at">mode =</span> <span class="st">&#39;wb&#39;</span>)</span>
<span id="cb55-8"><a href="1.6-survey-of-consumer-finances-scf.html#cb55-8" tabindex="-1"></a>    </span>
<span id="cb55-9"><a href="1.6-survey-of-consumer-finances-scf.html#cb55-9" tabindex="-1"></a>    this_tbl <span class="ot">&lt;-</span> <span class="fu">read_dta</span>(this_tf)</span>
<span id="cb55-10"><a href="1.6-survey-of-consumer-finances-scf.html#cb55-10" tabindex="-1"></a>    </span>
<span id="cb55-11"><a href="1.6-survey-of-consumer-finances-scf.html#cb55-11" tabindex="-1"></a>    this_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(this_tbl)</span>
<span id="cb55-12"><a href="1.6-survey-of-consumer-finances-scf.html#cb55-12" tabindex="-1"></a>    </span>
<span id="cb55-13"><a href="1.6-survey-of-consumer-finances-scf.html#cb55-13" tabindex="-1"></a>    <span class="fu">file.remove</span>(this_tf)</span>
<span id="cb55-14"><a href="1.6-survey-of-consumer-finances-scf.html#cb55-14" tabindex="-1"></a>    </span>
<span id="cb55-15"><a href="1.6-survey-of-consumer-finances-scf.html#cb55-15" tabindex="-1"></a>    <span class="fu">names</span>(this_df) <span class="ot">&lt;-</span> <span class="fu">tolower</span>(<span class="fu">names</span>(this_df))</span>
<span id="cb55-16"><a href="1.6-survey-of-consumer-finances-scf.html#cb55-16" tabindex="-1"></a>    </span>
<span id="cb55-17"><a href="1.6-survey-of-consumer-finances-scf.html#cb55-17" tabindex="-1"></a>    this_df</span>
<span id="cb55-18"><a href="1.6-survey-of-consumer-finances-scf.html#cb55-18" tabindex="-1"></a>  }</span></code></pre></div>
<p>Download and import the full, summary extract, and replicate weights tables:</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="1.6-survey-of-consumer-finances-scf.html#cb56-1" tabindex="-1"></a>scf_df <span class="ot">&lt;-</span></span>
<span id="cb56-2"><a href="1.6-survey-of-consumer-finances-scf.html#cb56-2" tabindex="-1"></a>  <span class="fu">scf_dta_import</span>(<span class="st">&quot;https://www.federalreserve.gov/econres/files/scf2022s.zip&quot;</span>)</span>
<span id="cb56-3"><a href="1.6-survey-of-consumer-finances-scf.html#cb56-3" tabindex="-1"></a></span>
<span id="cb56-4"><a href="1.6-survey-of-consumer-finances-scf.html#cb56-4" tabindex="-1"></a>ext_df <span class="ot">&lt;-</span></span>
<span id="cb56-5"><a href="1.6-survey-of-consumer-finances-scf.html#cb56-5" tabindex="-1"></a>  <span class="fu">scf_dta_import</span>(<span class="st">&quot;https://www.federalreserve.gov/econres/files/scfp2022s.zip&quot;</span>)</span>
<span id="cb56-6"><a href="1.6-survey-of-consumer-finances-scf.html#cb56-6" tabindex="-1"></a></span>
<span id="cb56-7"><a href="1.6-survey-of-consumer-finances-scf.html#cb56-7" tabindex="-1"></a>scf_rw_df <span class="ot">&lt;-</span></span>
<span id="cb56-8"><a href="1.6-survey-of-consumer-finances-scf.html#cb56-8" tabindex="-1"></a>  <span class="fu">scf_dta_import</span>(<span class="st">&quot;https://www.federalreserve.gov/econres/files/scf2022rw1s.zip&quot;</span>)</span></code></pre></div>
<p>Confirm both the full public data and the summary extract contain five records per family:</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="1.6-survey-of-consumer-finances-scf.html#cb57-1" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">nrow</span>(scf_df) <span class="sc">==</span> <span class="fu">nrow</span>(scf_rw_df) <span class="sc">*</span> <span class="dv">5</span>)</span>
<span id="cb57-2"><a href="1.6-survey-of-consumer-finances-scf.html#cb57-2" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">nrow</span>(scf_df) <span class="sc">==</span> <span class="fu">nrow</span>(ext_df))</span></code></pre></div>
<p>Confirm only the primary economic unit and the five implicate identifiers overlap:</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="1.6-survey-of-consumer-finances-scf.html#cb58-1" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="fu">sort</span>(<span class="fu">intersect</span>(</span>
<span id="cb58-2"><a href="1.6-survey-of-consumer-finances-scf.html#cb58-2" tabindex="-1"></a>  <span class="fu">names</span>(scf_df) , <span class="fu">names</span>(ext_df)</span>
<span id="cb58-3"><a href="1.6-survey-of-consumer-finances-scf.html#cb58-3" tabindex="-1"></a>)) <span class="sc">==</span> <span class="fu">c</span>(<span class="st">&#39;y1&#39;</span> , <span class="st">&#39;yy1&#39;</span>)))</span>
<span id="cb58-4"><a href="1.6-survey-of-consumer-finances-scf.html#cb58-4" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="fu">sort</span>(<span class="fu">intersect</span>(</span>
<span id="cb58-5"><a href="1.6-survey-of-consumer-finances-scf.html#cb58-5" tabindex="-1"></a>  <span class="fu">names</span>(scf_df) , <span class="fu">names</span>(scf_rw_df)</span>
<span id="cb58-6"><a href="1.6-survey-of-consumer-finances-scf.html#cb58-6" tabindex="-1"></a>)) <span class="sc">==</span> <span class="fu">c</span>(<span class="st">&#39;y1&#39;</span> , <span class="st">&#39;yy1&#39;</span>)))</span>
<span id="cb58-7"><a href="1.6-survey-of-consumer-finances-scf.html#cb58-7" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="fu">sort</span>(<span class="fu">intersect</span>(</span>
<span id="cb58-8"><a href="1.6-survey-of-consumer-finances-scf.html#cb58-8" tabindex="-1"></a>  <span class="fu">names</span>(ext_df) , <span class="fu">names</span>(scf_rw_df)</span>
<span id="cb58-9"><a href="1.6-survey-of-consumer-finances-scf.html#cb58-9" tabindex="-1"></a>)) <span class="sc">==</span> <span class="fu">c</span>(<span class="st">&#39;y1&#39;</span> , <span class="st">&#39;yy1&#39;</span>)))</span></code></pre></div>
<p>Remove the implicate identifier from the replicate weights table, add a column of fives for weighting:</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="1.6-survey-of-consumer-finances-scf.html#cb59-1" tabindex="-1"></a>scf_rw_df[, <span class="st">&#39;y1&#39;</span>] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb59-2"><a href="1.6-survey-of-consumer-finances-scf.html#cb59-2" tabindex="-1"></a></span>
<span id="cb59-3"><a href="1.6-survey-of-consumer-finances-scf.html#cb59-3" tabindex="-1"></a>scf_df[, <span class="st">&#39;five&#39;</span>] <span class="ot">&lt;-</span> <span class="dv">5</span></span></code></pre></div>
<p>Construct a multiply-imputed, complex sample survey design:</p>
<p>Break the main table into five different implicates based on the final character of the column <code>y1</code>:</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="1.6-survey-of-consumer-finances-scf.html#cb60-1" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb60-2"><a href="1.6-survey-of-consumer-finances-scf.html#cb60-2" tabindex="-1"></a></span>
<span id="cb60-3"><a href="1.6-survey-of-consumer-finances-scf.html#cb60-3" tabindex="-1"></a>s1_df <span class="ot">&lt;-</span> scf_df[<span class="fu">str_sub</span>(scf_df[, <span class="st">&#39;y1&#39;</span>] ,<span class="sc">-</span><span class="dv">1</span> ,<span class="sc">-</span><span class="dv">1</span>) <span class="sc">==</span> <span class="dv">1</span> ,]</span>
<span id="cb60-4"><a href="1.6-survey-of-consumer-finances-scf.html#cb60-4" tabindex="-1"></a>s2_df <span class="ot">&lt;-</span> scf_df[<span class="fu">str_sub</span>(scf_df[, <span class="st">&#39;y1&#39;</span>] ,<span class="sc">-</span><span class="dv">1</span> ,<span class="sc">-</span><span class="dv">1</span>) <span class="sc">==</span> <span class="dv">2</span> ,]</span>
<span id="cb60-5"><a href="1.6-survey-of-consumer-finances-scf.html#cb60-5" tabindex="-1"></a>s3_df <span class="ot">&lt;-</span> scf_df[<span class="fu">str_sub</span>(scf_df[, <span class="st">&#39;y1&#39;</span>] ,<span class="sc">-</span><span class="dv">1</span> ,<span class="sc">-</span><span class="dv">1</span>) <span class="sc">==</span> <span class="dv">3</span> ,]</span>
<span id="cb60-6"><a href="1.6-survey-of-consumer-finances-scf.html#cb60-6" tabindex="-1"></a>s4_df <span class="ot">&lt;-</span> scf_df[<span class="fu">str_sub</span>(scf_df[, <span class="st">&#39;y1&#39;</span>] ,<span class="sc">-</span><span class="dv">1</span> ,<span class="sc">-</span><span class="dv">1</span>) <span class="sc">==</span> <span class="dv">4</span> ,]</span>
<span id="cb60-7"><a href="1.6-survey-of-consumer-finances-scf.html#cb60-7" tabindex="-1"></a>s5_df <span class="ot">&lt;-</span> scf_df[<span class="fu">str_sub</span>(scf_df[, <span class="st">&#39;y1&#39;</span>] ,<span class="sc">-</span><span class="dv">1</span> ,<span class="sc">-</span><span class="dv">1</span>) <span class="sc">==</span> <span class="dv">5</span> ,]</span></code></pre></div>
<p>Combine these into a single <code>list</code>, then merge each implicate with the summary extract:</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="1.6-survey-of-consumer-finances-scf.html#cb61-1" tabindex="-1"></a>scf_imp <span class="ot">&lt;-</span> <span class="fu">list</span>(s1_df , s2_df , s3_df , s4_df , s5_df)</span>
<span id="cb61-2"><a href="1.6-survey-of-consumer-finances-scf.html#cb61-2" tabindex="-1"></a></span>
<span id="cb61-3"><a href="1.6-survey-of-consumer-finances-scf.html#cb61-3" tabindex="-1"></a>scf_list <span class="ot">&lt;-</span> <span class="fu">lapply</span>(scf_imp , merge , ext_df)</span></code></pre></div>
<p>Replace all missing values in the replicate weights table with zeroes, multiply the replicate weights by the multiplication factor, then only keep the unique identifier and the final (combined) replicate weights:</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="1.6-survey-of-consumer-finances-scf.html#cb62-1" tabindex="-1"></a>scf_rw_df[<span class="fu">is.na</span>(scf_rw_df)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb62-2"><a href="1.6-survey-of-consumer-finances-scf.html#cb62-2" tabindex="-1"></a></span>
<span id="cb62-3"><a href="1.6-survey-of-consumer-finances-scf.html#cb62-3" tabindex="-1"></a>scf_rw_df[, <span class="fu">paste0</span>(<span class="st">&#39;wgt&#39;</span> , <span class="dv">1</span><span class="sc">:</span><span class="dv">999</span>)] <span class="ot">&lt;-</span></span>
<span id="cb62-4"><a href="1.6-survey-of-consumer-finances-scf.html#cb62-4" tabindex="-1"></a>  scf_rw_df[, <span class="fu">paste0</span>(<span class="st">&#39;wt1b&#39;</span> , <span class="dv">1</span><span class="sc">:</span><span class="dv">999</span>)] <span class="sc">*</span> scf_rw_df[, <span class="fu">paste0</span>(<span class="st">&#39;mm&#39;</span> , <span class="dv">1</span><span class="sc">:</span><span class="dv">999</span>)]</span>
<span id="cb62-5"><a href="1.6-survey-of-consumer-finances-scf.html#cb62-5" tabindex="-1"></a></span>
<span id="cb62-6"><a href="1.6-survey-of-consumer-finances-scf.html#cb62-6" tabindex="-1"></a>scf_rw_df <span class="ot">&lt;-</span> scf_rw_df[, <span class="fu">c</span>(<span class="st">&#39;yy1&#39;</span> , <span class="fu">paste0</span>(<span class="st">&#39;wgt&#39;</span> , <span class="dv">1</span><span class="sc">:</span><span class="dv">999</span>))]</span></code></pre></div>
<p>Sort both the five implicates and also the replicate weights table by the unique identifier:</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="1.6-survey-of-consumer-finances-scf.html#cb63-1" tabindex="-1"></a>scf_list <span class="ot">&lt;-</span></span>
<span id="cb63-2"><a href="1.6-survey-of-consumer-finances-scf.html#cb63-2" tabindex="-1"></a>  <span class="fu">lapply</span>(scf_list , <span class="cf">function</span>(w)</span>
<span id="cb63-3"><a href="1.6-survey-of-consumer-finances-scf.html#cb63-3" tabindex="-1"></a>    w[<span class="fu">order</span>(w[, <span class="st">&#39;yy1&#39;</span>]) ,])</span>
<span id="cb63-4"><a href="1.6-survey-of-consumer-finances-scf.html#cb63-4" tabindex="-1"></a></span>
<span id="cb63-5"><a href="1.6-survey-of-consumer-finances-scf.html#cb63-5" tabindex="-1"></a>scf_rw_df <span class="ot">&lt;-</span> scf_rw_df[<span class="fu">order</span>(scf_rw_df[, <span class="st">&#39;yy1&#39;</span>]) ,]</span></code></pre></div>
<p>Define the design:</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="1.6-survey-of-consumer-finances-scf.html#cb64-1" tabindex="-1"></a><span class="fu">library</span>(survey)</span>
<span id="cb64-2"><a href="1.6-survey-of-consumer-finances-scf.html#cb64-2" tabindex="-1"></a><span class="fu">library</span>(mitools)</span>
<span id="cb64-3"><a href="1.6-survey-of-consumer-finances-scf.html#cb64-3" tabindex="-1"></a></span>
<span id="cb64-4"><a href="1.6-survey-of-consumer-finances-scf.html#cb64-4" tabindex="-1"></a>scf_design <span class="ot">&lt;-</span></span>
<span id="cb64-5"><a href="1.6-survey-of-consumer-finances-scf.html#cb64-5" tabindex="-1"></a>  <span class="fu">svrepdesign</span>(</span>
<span id="cb64-6"><a href="1.6-survey-of-consumer-finances-scf.html#cb64-6" tabindex="-1"></a>    <span class="at">weights =</span> <span class="sc">~</span> wgt ,</span>
<span id="cb64-7"><a href="1.6-survey-of-consumer-finances-scf.html#cb64-7" tabindex="-1"></a>    <span class="at">repweights =</span> scf_rw_df[,<span class="sc">-</span><span class="dv">1</span>] ,</span>
<span id="cb64-8"><a href="1.6-survey-of-consumer-finances-scf.html#cb64-8" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">imputationList</span>(scf_list) ,</span>
<span id="cb64-9"><a href="1.6-survey-of-consumer-finances-scf.html#cb64-9" tabindex="-1"></a>    <span class="at">scale =</span> <span class="dv">1</span> ,</span>
<span id="cb64-10"><a href="1.6-survey-of-consumer-finances-scf.html#cb64-10" tabindex="-1"></a>    <span class="at">rscales =</span> <span class="fu">rep</span>(<span class="dv">1</span> <span class="sc">/</span> <span class="dv">998</span> , <span class="dv">999</span>) ,</span>
<span id="cb64-11"><a href="1.6-survey-of-consumer-finances-scf.html#cb64-11" tabindex="-1"></a>    <span class="at">mse =</span> <span class="cn">FALSE</span> ,</span>
<span id="cb64-12"><a href="1.6-survey-of-consumer-finances-scf.html#cb64-12" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">&quot;other&quot;</span> ,</span>
<span id="cb64-13"><a href="1.6-survey-of-consumer-finances-scf.html#cb64-13" tabindex="-1"></a>    <span class="at">combined.weights =</span> <span class="cn">TRUE</span></span>
<span id="cb64-14"><a href="1.6-survey-of-consumer-finances-scf.html#cb64-14" tabindex="-1"></a>  )</span></code></pre></div>
<p>Run the <code>convey_prep()</code> function on the full design:</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="1.6-survey-of-consumer-finances-scf.html#cb65-1" tabindex="-1"></a>scf_design<span class="sc">$</span>designs <span class="ot">&lt;-</span> <span class="fu">lapply</span>(scf_design<span class="sc">$</span>designs , convey_prep)</span></code></pre></div>
<p>This example matches the “Table 4” tab’s cell Y6 of the <a href="https://www.federalreserve.gov/econres/files/scf2022_tables_public_nominal_historical.xlsx">Excel Based on Public Data</a>:</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="1.6-survey-of-consumer-finances-scf.html#cb66-1" tabindex="-1"></a>mean_net_worth <span class="ot">&lt;-</span></span>
<span id="cb66-2"><a href="1.6-survey-of-consumer-finances-scf.html#cb66-2" tabindex="-1"></a>  <span class="fu">scf_MIcombine</span>(<span class="fu">with</span>(scf_design , <span class="fu">svymean</span>(<span class="sc">~</span> networth)))</span>
<span id="cb66-3"><a href="1.6-survey-of-consumer-finances-scf.html#cb66-3" tabindex="-1"></a></span>
<span id="cb66-4"><a href="1.6-survey-of-consumer-finances-scf.html#cb66-4" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">round</span>(<span class="fu">coef</span>(mean_net_worth) <span class="sc">/</span> <span class="dv">1000</span> , <span class="dv">1</span>) <span class="sc">==</span> <span class="fl">1059.5</span>)</span></code></pre></div>
<p>This example comes within $500 of the standard error of mean net worth from Table 2 of the <a href="https://www.federalreserve.gov/publications/files/scf23.pdf#page=18">Federal Reserve Bulletin</a>, displaying the minor differences between the <a href="https://www.federalreserve.gov/econres/files/scf2022_tables_internal_nominal_historical.xlsx">Internal Data</a> and <a href="https://www.federalreserve.gov/econres/files/scf2022_tables_public_nominal_historical.xlsx">Public Data</a>:</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="1.6-survey-of-consumer-finances-scf.html#cb67-1" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">abs</span>(<span class="fl">23.2</span> <span class="sc">-</span> <span class="fu">round</span>(<span class="fu">SE</span>(mean_net_worth) <span class="sc">/</span> <span class="dv">1000</span> , <span class="dv">1</span>)) <span class="sc">&lt;</span> <span class="fl">0.5</span>)</span></code></pre></div>
<p>This example matches the “Table 4” tab’s cells X6 of the <a href="https://www.federalreserve.gov/econres/files/scf2022_tables_public_nominal_historical.xlsx">Excel Based on Public Data</a>:</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="1.6-survey-of-consumer-finances-scf.html#cb68-1" tabindex="-1"></a><span class="co"># compute quantile with all five implicates stacked (not the recommended technique)</span></span>
<span id="cb68-2"><a href="1.6-survey-of-consumer-finances-scf.html#cb68-2" tabindex="-1"></a>fake_design <span class="ot">&lt;-</span></span>
<span id="cb68-3"><a href="1.6-survey-of-consumer-finances-scf.html#cb68-3" tabindex="-1"></a>  <span class="fu">svydesign</span>(<span class="sc">~</span> <span class="dv">1</span> , <span class="at">data =</span> ext_df[<span class="fu">c</span>(<span class="st">&#39;networth&#39;</span> , <span class="st">&#39;wgt&#39;</span>)] , <span class="at">weights =</span> <span class="sc">~</span> wgt)</span>
<span id="cb68-4"><a href="1.6-survey-of-consumer-finances-scf.html#cb68-4" tabindex="-1"></a></span>
<span id="cb68-5"><a href="1.6-survey-of-consumer-finances-scf.html#cb68-5" tabindex="-1"></a>median_net_worth_incorrect_errors <span class="ot">&lt;-</span></span>
<span id="cb68-6"><a href="1.6-survey-of-consumer-finances-scf.html#cb68-6" tabindex="-1"></a>  <span class="fu">svyquantile</span>(<span class="sc">~</span> networth , fake_design , <span class="fl">0.5</span>)</span>
<span id="cb68-7"><a href="1.6-survey-of-consumer-finances-scf.html#cb68-7" tabindex="-1"></a></span>
<span id="cb68-8"><a href="1.6-survey-of-consumer-finances-scf.html#cb68-8" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">round</span>(<span class="fu">coef</span>(median_net_worth_incorrect_errors) <span class="sc">/</span> <span class="dv">1000</span> , <span class="dv">2</span>) <span class="sc">==</span> <span class="fl">192.7</span>)</span></code></pre></div>
<div id="analysis-examples-with-the-survey-library" class="section level3" number="1.6.1">
<h3><span class="header-section-number">1.6.1</span> Analysis Examples with the <code>survey</code> library</h3>
<p>Add new columns to the data set:</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="1.6-survey-of-consumer-finances-scf.html#cb69-1" tabindex="-1"></a>scf_design <span class="ot">&lt;-</span></span>
<span id="cb69-2"><a href="1.6-survey-of-consumer-finances-scf.html#cb69-2" tabindex="-1"></a>  <span class="fu">update</span>(</span>
<span id="cb69-3"><a href="1.6-survey-of-consumer-finances-scf.html#cb69-3" tabindex="-1"></a>    scf_design ,</span>
<span id="cb69-4"><a href="1.6-survey-of-consumer-finances-scf.html#cb69-4" tabindex="-1"></a>    </span>
<span id="cb69-5"><a href="1.6-survey-of-consumer-finances-scf.html#cb69-5" tabindex="-1"></a>    <span class="at">hhsex =</span> <span class="fu">factor</span>(</span>
<span id="cb69-6"><a href="1.6-survey-of-consumer-finances-scf.html#cb69-6" tabindex="-1"></a>      hhsex ,</span>
<span id="cb69-7"><a href="1.6-survey-of-consumer-finances-scf.html#cb69-7" tabindex="-1"></a>      <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span> ,</span>
<span id="cb69-8"><a href="1.6-survey-of-consumer-finances-scf.html#cb69-8" tabindex="-1"></a>      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;male&quot;</span> , <span class="st">&quot;female&quot;</span>)</span>
<span id="cb69-9"><a href="1.6-survey-of-consumer-finances-scf.html#cb69-9" tabindex="-1"></a>    ) ,</span>
<span id="cb69-10"><a href="1.6-survey-of-consumer-finances-scf.html#cb69-10" tabindex="-1"></a>    </span>
<span id="cb69-11"><a href="1.6-survey-of-consumer-finances-scf.html#cb69-11" tabindex="-1"></a>    <span class="at">married =</span> <span class="fu">as.numeric</span>(married <span class="sc">==</span> <span class="dv">1</span>) ,</span>
<span id="cb69-12"><a href="1.6-survey-of-consumer-finances-scf.html#cb69-12" tabindex="-1"></a>    </span>
<span id="cb69-13"><a href="1.6-survey-of-consumer-finances-scf.html#cb69-13" tabindex="-1"></a>    <span class="at">edcl =</span></span>
<span id="cb69-14"><a href="1.6-survey-of-consumer-finances-scf.html#cb69-14" tabindex="-1"></a>      <span class="fu">factor</span>(</span>
<span id="cb69-15"><a href="1.6-survey-of-consumer-finances-scf.html#cb69-15" tabindex="-1"></a>        edcl ,</span>
<span id="cb69-16"><a href="1.6-survey-of-consumer-finances-scf.html#cb69-16" tabindex="-1"></a>        <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span> ,</span>
<span id="cb69-17"><a href="1.6-survey-of-consumer-finances-scf.html#cb69-17" tabindex="-1"></a>        <span class="at">labels =</span></span>
<span id="cb69-18"><a href="1.6-survey-of-consumer-finances-scf.html#cb69-18" tabindex="-1"></a>          <span class="fu">c</span>(</span>
<span id="cb69-19"><a href="1.6-survey-of-consumer-finances-scf.html#cb69-19" tabindex="-1"></a>            <span class="st">&quot;less than high school&quot;</span> ,</span>
<span id="cb69-20"><a href="1.6-survey-of-consumer-finances-scf.html#cb69-20" tabindex="-1"></a>            <span class="st">&quot;high school or GED&quot;</span> ,</span>
<span id="cb69-21"><a href="1.6-survey-of-consumer-finances-scf.html#cb69-21" tabindex="-1"></a>            <span class="st">&quot;some college&quot;</span> ,</span>
<span id="cb69-22"><a href="1.6-survey-of-consumer-finances-scf.html#cb69-22" tabindex="-1"></a>            <span class="st">&quot;college degree&quot;</span></span>
<span id="cb69-23"><a href="1.6-survey-of-consumer-finances-scf.html#cb69-23" tabindex="-1"></a>          )</span>
<span id="cb69-24"><a href="1.6-survey-of-consumer-finances-scf.html#cb69-24" tabindex="-1"></a>      )</span>
<span id="cb69-25"><a href="1.6-survey-of-consumer-finances-scf.html#cb69-25" tabindex="-1"></a>    </span>
<span id="cb69-26"><a href="1.6-survey-of-consumer-finances-scf.html#cb69-26" tabindex="-1"></a>  )</span></code></pre></div>
<p>Count the unweighted number of records in the survey sample, overall and by groups:</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="1.6-survey-of-consumer-finances-scf.html#cb70-1" tabindex="-1"></a><span class="fu">scf_MIcombine</span>(<span class="fu">with</span>(scf_design , <span class="fu">svyby</span>(<span class="sc">~</span> five , <span class="sc">~</span> five , unwtd.count)))</span>
<span id="cb70-2"><a href="1.6-survey-of-consumer-finances-scf.html#cb70-2" tabindex="-1"></a></span>
<span id="cb70-3"><a href="1.6-survey-of-consumer-finances-scf.html#cb70-3" tabindex="-1"></a><span class="fu">scf_MIcombine</span>(<span class="fu">with</span>(scf_design , <span class="fu">svyby</span>(<span class="sc">~</span> five , <span class="sc">~</span> hhsex , unwtd.count)))</span></code></pre></div>
<p>Count the weighted size of the generalizable population, overall and by groups:</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="1.6-survey-of-consumer-finances-scf.html#cb71-1" tabindex="-1"></a><span class="fu">scf_MIcombine</span>(<span class="fu">with</span>(scf_design , <span class="fu">svytotal</span>(<span class="sc">~</span> five)))</span>
<span id="cb71-2"><a href="1.6-survey-of-consumer-finances-scf.html#cb71-2" tabindex="-1"></a></span>
<span id="cb71-3"><a href="1.6-survey-of-consumer-finances-scf.html#cb71-3" tabindex="-1"></a><span class="fu">scf_MIcombine</span>(<span class="fu">with</span>(scf_design ,</span>
<span id="cb71-4"><a href="1.6-survey-of-consumer-finances-scf.html#cb71-4" tabindex="-1"></a>                   <span class="fu">svyby</span>(<span class="sc">~</span> five , <span class="sc">~</span> hhsex , svytotal)))</span></code></pre></div>
<p>Calculate the mean (average) of a linear variable, overall and by groups:</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="1.6-survey-of-consumer-finances-scf.html#cb72-1" tabindex="-1"></a><span class="fu">scf_MIcombine</span>(<span class="fu">with</span>(scf_design , <span class="fu">svymean</span>(<span class="sc">~</span> networth)))</span>
<span id="cb72-2"><a href="1.6-survey-of-consumer-finances-scf.html#cb72-2" tabindex="-1"></a></span>
<span id="cb72-3"><a href="1.6-survey-of-consumer-finances-scf.html#cb72-3" tabindex="-1"></a><span class="fu">scf_MIcombine</span>(<span class="fu">with</span>(scf_design ,</span>
<span id="cb72-4"><a href="1.6-survey-of-consumer-finances-scf.html#cb72-4" tabindex="-1"></a>                   <span class="fu">svyby</span>(<span class="sc">~</span> networth , <span class="sc">~</span> hhsex , svymean)))</span></code></pre></div>
<p>Calculate the distribution of a categorical variable, overall and by groups:</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="1.6-survey-of-consumer-finances-scf.html#cb73-1" tabindex="-1"></a><span class="fu">scf_MIcombine</span>(<span class="fu">with</span>(scf_design , <span class="fu">svymean</span>(<span class="sc">~</span> edcl)))</span>
<span id="cb73-2"><a href="1.6-survey-of-consumer-finances-scf.html#cb73-2" tabindex="-1"></a></span>
<span id="cb73-3"><a href="1.6-survey-of-consumer-finances-scf.html#cb73-3" tabindex="-1"></a><span class="fu">scf_MIcombine</span>(<span class="fu">with</span>(scf_design ,</span>
<span id="cb73-4"><a href="1.6-survey-of-consumer-finances-scf.html#cb73-4" tabindex="-1"></a>                   <span class="fu">svyby</span>(<span class="sc">~</span> edcl , <span class="sc">~</span> hhsex , svymean)))</span></code></pre></div>
<p>Calculate the sum of a linear variable, overall and by groups:</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="1.6-survey-of-consumer-finances-scf.html#cb74-1" tabindex="-1"></a><span class="fu">scf_MIcombine</span>(<span class="fu">with</span>(scf_design , <span class="fu">svytotal</span>(<span class="sc">~</span> networth)))</span>
<span id="cb74-2"><a href="1.6-survey-of-consumer-finances-scf.html#cb74-2" tabindex="-1"></a></span>
<span id="cb74-3"><a href="1.6-survey-of-consumer-finances-scf.html#cb74-3" tabindex="-1"></a><span class="fu">scf_MIcombine</span>(<span class="fu">with</span>(scf_design ,</span>
<span id="cb74-4"><a href="1.6-survey-of-consumer-finances-scf.html#cb74-4" tabindex="-1"></a>                   <span class="fu">svyby</span>(<span class="sc">~</span> networth , <span class="sc">~</span> hhsex , svytotal)))</span></code></pre></div>
<p>Calculate the weighted sum of a categorical variable, overall and by groups:</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="1.6-survey-of-consumer-finances-scf.html#cb75-1" tabindex="-1"></a><span class="fu">scf_MIcombine</span>(<span class="fu">with</span>(scf_design , <span class="fu">svytotal</span>(<span class="sc">~</span> edcl)))</span>
<span id="cb75-2"><a href="1.6-survey-of-consumer-finances-scf.html#cb75-2" tabindex="-1"></a></span>
<span id="cb75-3"><a href="1.6-survey-of-consumer-finances-scf.html#cb75-3" tabindex="-1"></a><span class="fu">scf_MIcombine</span>(<span class="fu">with</span>(scf_design ,</span>
<span id="cb75-4"><a href="1.6-survey-of-consumer-finances-scf.html#cb75-4" tabindex="-1"></a>                   <span class="fu">svyby</span>(<span class="sc">~</span> edcl , <span class="sc">~</span> hhsex , svytotal)))</span></code></pre></div>
<p>Calculate the median (50th percentile) of a linear variable, overall and by groups:</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="1.6-survey-of-consumer-finances-scf.html#cb76-1" tabindex="-1"></a><span class="fu">scf_MIcombine</span>(<span class="fu">with</span>(</span>
<span id="cb76-2"><a href="1.6-survey-of-consumer-finances-scf.html#cb76-2" tabindex="-1"></a>  scf_design ,</span>
<span id="cb76-3"><a href="1.6-survey-of-consumer-finances-scf.html#cb76-3" tabindex="-1"></a>  <span class="fu">svyquantile</span>(<span class="sc">~</span> networth ,</span>
<span id="cb76-4"><a href="1.6-survey-of-consumer-finances-scf.html#cb76-4" tabindex="-1"></a>              <span class="fl">0.5</span> , <span class="at">se =</span> <span class="cn">TRUE</span> , <span class="at">interval.type =</span> <span class="st">&#39;quantile&#39;</span>)</span>
<span id="cb76-5"><a href="1.6-survey-of-consumer-finances-scf.html#cb76-5" tabindex="-1"></a>))</span>
<span id="cb76-6"><a href="1.6-survey-of-consumer-finances-scf.html#cb76-6" tabindex="-1"></a></span>
<span id="cb76-7"><a href="1.6-survey-of-consumer-finances-scf.html#cb76-7" tabindex="-1"></a><span class="fu">scf_MIcombine</span>(<span class="fu">with</span>(</span>
<span id="cb76-8"><a href="1.6-survey-of-consumer-finances-scf.html#cb76-8" tabindex="-1"></a>  scf_design ,</span>
<span id="cb76-9"><a href="1.6-survey-of-consumer-finances-scf.html#cb76-9" tabindex="-1"></a>  <span class="fu">svyby</span>(</span>
<span id="cb76-10"><a href="1.6-survey-of-consumer-finances-scf.html#cb76-10" tabindex="-1"></a>    <span class="sc">~</span> networth ,</span>
<span id="cb76-11"><a href="1.6-survey-of-consumer-finances-scf.html#cb76-11" tabindex="-1"></a>    <span class="sc">~</span> hhsex ,</span>
<span id="cb76-12"><a href="1.6-survey-of-consumer-finances-scf.html#cb76-12" tabindex="-1"></a>    svyquantile ,</span>
<span id="cb76-13"><a href="1.6-survey-of-consumer-finances-scf.html#cb76-13" tabindex="-1"></a>    <span class="fl">0.5</span> ,</span>
<span id="cb76-14"><a href="1.6-survey-of-consumer-finances-scf.html#cb76-14" tabindex="-1"></a>    <span class="at">se =</span> <span class="cn">TRUE</span> ,</span>
<span id="cb76-15"><a href="1.6-survey-of-consumer-finances-scf.html#cb76-15" tabindex="-1"></a>    <span class="at">interval.type =</span> <span class="st">&#39;quantile&#39;</span> ,</span>
<span id="cb76-16"><a href="1.6-survey-of-consumer-finances-scf.html#cb76-16" tabindex="-1"></a>    <span class="at">ci =</span> <span class="cn">TRUE</span></span>
<span id="cb76-17"><a href="1.6-survey-of-consumer-finances-scf.html#cb76-17" tabindex="-1"></a>  )</span>
<span id="cb76-18"><a href="1.6-survey-of-consumer-finances-scf.html#cb76-18" tabindex="-1"></a>))</span></code></pre></div>
<p>Estimate a ratio:</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="1.6-survey-of-consumer-finances-scf.html#cb77-1" tabindex="-1"></a><span class="fu">scf_MIcombine</span>(<span class="fu">with</span>(</span>
<span id="cb77-2"><a href="1.6-survey-of-consumer-finances-scf.html#cb77-2" tabindex="-1"></a>  scf_design ,</span>
<span id="cb77-3"><a href="1.6-survey-of-consumer-finances-scf.html#cb77-3" tabindex="-1"></a>  <span class="fu">svyratio</span>(<span class="at">numerator =</span> <span class="sc">~</span> income , <span class="at">denominator =</span> <span class="sc">~</span> networth)</span>
<span id="cb77-4"><a href="1.6-survey-of-consumer-finances-scf.html#cb77-4" tabindex="-1"></a>))</span></code></pre></div>
<p>Restrict the survey design to labor force participants:</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="1.6-survey-of-consumer-finances-scf.html#cb78-1" tabindex="-1"></a>sub_scf_design <span class="ot">&lt;-</span> <span class="fu">subset</span>(scf_design , lf <span class="sc">==</span> <span class="dv">1</span>)</span></code></pre></div>
<p>Calculate the mean (average) of this subset:</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="1.6-survey-of-consumer-finances-scf.html#cb79-1" tabindex="-1"></a><span class="fu">scf_MIcombine</span>(<span class="fu">with</span>(sub_scf_design , <span class="fu">svymean</span>(<span class="sc">~</span> networth)))</span></code></pre></div>
<p>Extract the coefficient, standard error, confidence interval, and coefficient of variation from any descriptive statistics function result, overall and by groups:</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="1.6-survey-of-consumer-finances-scf.html#cb80-1" tabindex="-1"></a>this_result <span class="ot">&lt;-</span></span>
<span id="cb80-2"><a href="1.6-survey-of-consumer-finances-scf.html#cb80-2" tabindex="-1"></a>  <span class="fu">scf_MIcombine</span>(<span class="fu">with</span>(scf_design ,</span>
<span id="cb80-3"><a href="1.6-survey-of-consumer-finances-scf.html#cb80-3" tabindex="-1"></a>                     <span class="fu">svymean</span>(<span class="sc">~</span> networth)))</span>
<span id="cb80-4"><a href="1.6-survey-of-consumer-finances-scf.html#cb80-4" tabindex="-1"></a></span>
<span id="cb80-5"><a href="1.6-survey-of-consumer-finances-scf.html#cb80-5" tabindex="-1"></a><span class="fu">coef</span>(this_result)</span>
<span id="cb80-6"><a href="1.6-survey-of-consumer-finances-scf.html#cb80-6" tabindex="-1"></a><span class="fu">SE</span>(this_result)</span>
<span id="cb80-7"><a href="1.6-survey-of-consumer-finances-scf.html#cb80-7" tabindex="-1"></a><span class="fu">confint</span>(this_result)</span>
<span id="cb80-8"><a href="1.6-survey-of-consumer-finances-scf.html#cb80-8" tabindex="-1"></a><span class="fu">cv</span>(this_result)</span>
<span id="cb80-9"><a href="1.6-survey-of-consumer-finances-scf.html#cb80-9" tabindex="-1"></a></span>
<span id="cb80-10"><a href="1.6-survey-of-consumer-finances-scf.html#cb80-10" tabindex="-1"></a>grouped_result <span class="ot">&lt;-</span></span>
<span id="cb80-11"><a href="1.6-survey-of-consumer-finances-scf.html#cb80-11" tabindex="-1"></a>  <span class="fu">scf_MIcombine</span>(<span class="fu">with</span>(scf_design ,</span>
<span id="cb80-12"><a href="1.6-survey-of-consumer-finances-scf.html#cb80-12" tabindex="-1"></a>                     <span class="fu">svyby</span>(<span class="sc">~</span> networth , <span class="sc">~</span> hhsex , svymean)))</span>
<span id="cb80-13"><a href="1.6-survey-of-consumer-finances-scf.html#cb80-13" tabindex="-1"></a></span>
<span id="cb80-14"><a href="1.6-survey-of-consumer-finances-scf.html#cb80-14" tabindex="-1"></a><span class="fu">coef</span>(grouped_result)</span>
<span id="cb80-15"><a href="1.6-survey-of-consumer-finances-scf.html#cb80-15" tabindex="-1"></a><span class="fu">SE</span>(grouped_result)</span>
<span id="cb80-16"><a href="1.6-survey-of-consumer-finances-scf.html#cb80-16" tabindex="-1"></a><span class="fu">confint</span>(grouped_result)</span>
<span id="cb80-17"><a href="1.6-survey-of-consumer-finances-scf.html#cb80-17" tabindex="-1"></a><span class="fu">cv</span>(grouped_result)</span></code></pre></div>
<p>Calculate the degrees of freedom of any survey design object:</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="1.6-survey-of-consumer-finances-scf.html#cb81-1" tabindex="-1"></a><span class="fu">degf</span>(scf_design<span class="sc">$</span>designs[[<span class="dv">1</span>]])</span></code></pre></div>
<p>Calculate the complex sample survey-adjusted variance of any statistic:</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="1.6-survey-of-consumer-finances-scf.html#cb82-1" tabindex="-1"></a><span class="fu">scf_MIcombine</span>(<span class="fu">with</span>(scf_design , <span class="fu">svyvar</span>(<span class="sc">~</span> networth)))</span></code></pre></div>
<p>Include the complex sample design effect in the result for a specific statistic:</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="1.6-survey-of-consumer-finances-scf.html#cb83-1" tabindex="-1"></a><span class="co"># SRS without replacement</span></span>
<span id="cb83-2"><a href="1.6-survey-of-consumer-finances-scf.html#cb83-2" tabindex="-1"></a><span class="fu">scf_MIcombine</span>(<span class="fu">with</span>(scf_design ,</span>
<span id="cb83-3"><a href="1.6-survey-of-consumer-finances-scf.html#cb83-3" tabindex="-1"></a>                   <span class="fu">svymean</span>(<span class="sc">~</span> networth , <span class="at">deff =</span> <span class="cn">TRUE</span>)))</span>
<span id="cb83-4"><a href="1.6-survey-of-consumer-finances-scf.html#cb83-4" tabindex="-1"></a></span>
<span id="cb83-5"><a href="1.6-survey-of-consumer-finances-scf.html#cb83-5" tabindex="-1"></a><span class="co"># SRS with replacement</span></span>
<span id="cb83-6"><a href="1.6-survey-of-consumer-finances-scf.html#cb83-6" tabindex="-1"></a><span class="fu">scf_MIcombine</span>(<span class="fu">with</span>(scf_design ,</span>
<span id="cb83-7"><a href="1.6-survey-of-consumer-finances-scf.html#cb83-7" tabindex="-1"></a>                   <span class="fu">svymean</span>(<span class="sc">~</span> networth , <span class="at">deff =</span> <span class="st">&quot;replace&quot;</span>)))</span></code></pre></div>
<p>Perform a survey-weighted generalized linear model:</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="1.6-survey-of-consumer-finances-scf.html#cb84-1" tabindex="-1"></a>glm_result <span class="ot">&lt;-</span></span>
<span id="cb84-2"><a href="1.6-survey-of-consumer-finances-scf.html#cb84-2" tabindex="-1"></a>  <span class="fu">scf_MIcombine</span>(<span class="fu">with</span>(scf_design ,</span>
<span id="cb84-3"><a href="1.6-survey-of-consumer-finances-scf.html#cb84-3" tabindex="-1"></a>                     <span class="fu">svyglm</span>(networth <span class="sc">~</span> married <span class="sc">+</span> edcl)))</span>
<span id="cb84-4"><a href="1.6-survey-of-consumer-finances-scf.html#cb84-4" tabindex="-1"></a></span>
<span id="cb84-5"><a href="1.6-survey-of-consumer-finances-scf.html#cb84-5" tabindex="-1"></a><span class="fu">summary</span>(glm_result)</span></code></pre></div>
</div>
<div id="family-net-worth" class="section level3" number="1.6.2">
<h3><span class="header-section-number">1.6.2</span> Family Net Worth</h3>
<p>Calculate the Gini coefficient with family net worth:</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="1.6-survey-of-consumer-finances-scf.html#cb85-1" tabindex="-1"></a><span class="fu">scf_MIcombine</span>(<span class="fu">with</span>(scf_design , <span class="fu">svygini</span>(<span class="sc">~</span> networth)))</span></code></pre></div>
<pre><code>## Multiple imputation results:
##       m &lt;- length(results)
##       scf_MIcombine(with(scf_design, svygini(~networth)))
##            results          se
## networth 0.8299718 0.003921117</code></pre>
</div>
<div id="family-income-1" class="section level3" number="1.6.3">
<h3><span class="header-section-number">1.6.3</span> Family Income</h3>
<p>Calculate the Gini coefficient with income:</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="1.6-survey-of-consumer-finances-scf.html#cb87-1" tabindex="-1"></a><span class="fu">scf_MIcombine</span>(<span class="fu">with</span>(scf_design , <span class="fu">svygini</span>(<span class="sc">~</span> income)))</span></code></pre></div>
<pre><code>## Multiple imputation results:
##       m &lt;- length(results)
##       scf_MIcombine(with(scf_design, svygini(~income)))
##          results         se
## income 0.6070385 0.01059348</code></pre>

</div>
</div>
<!-- </div> -->
<p style="text-align: center;">
<a href="1.5-pesquisa-nacional-por-amostra-de-domicílios-contínua-pnad-contínua.html"><button class="btn btn-default">Previous</button></a>
<a href="2-var.html"><button class="btn btn-default">Next</button></a>
</p>
</div>
</div>



</body>
</html>
