<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="3.7 Generalized Entropy and Decomposition (svygei, svygeidec) | Poverty and Inequality with Complex Survey Data" />
<meta property="og:type" content="book" />

<meta property="og:description" content="A book about the R convey package" />
<meta name="github-repo" content="guilhermejacob/context" />

<meta name="author" content="Guilherme Jacob, Anthony Damico, and Djalma Pessoa" />

<meta name="date" content="2023-09-07" />

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<meta name="description" content="A book about the R convey package">

<title>3.7 Generalized Entropy and Decomposition (svygei, svygeidec) | Poverty and Inequality with Complex Survey Data</title>

<link href="libs/tufte-css-2015.12.29/tufte-fonts.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte-background.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte-italics.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte.css" rel="stylesheet" />


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="toc.css" type="text/css" />

</head>

<body>



<div class="row">
<div class="col-sm-12">
<div id="TOC">
<ul>
<li class="has-sub"><a href="index.html#introduction" id="toc-introduction"><span class="toc-section-number">1</span> Introduction</a>
<ul>
<li><a href="1.1-install.html#install" id="toc-install"><span class="toc-section-number">1.1</span> Installation</a></li>
<li><a href="1.2-survey.html#survey" id="toc-survey"><span class="toc-section-number">1.2</span> Complex surveys and statistical inference</a></li>
<li><a href="1.3-usage-examples.html#usage-examples" id="toc-usage-examples"><span class="toc-section-number">1.3</span> Usage Examples</a></li>
<li><a href="1.4-lin.html#lin" id="toc-lin"><span class="toc-section-number">1.4</span> Underlying Calculations</a></li>
<li><a href="1.5-var.html#var" id="toc-var"><span class="toc-section-number">1.5</span> The Variance Estimator</a></li>
<li><a href="1.6-influence-functions.html#influence-functions" id="toc-influence-functions"><span class="toc-section-number">1.6</span> Influence Functions</a></li>
<li><a href="1.7-influence-function-examples.html#influence-function-examples" id="toc-influence-function-examples"><span class="toc-section-number">1.7</span> Influence Function Examples</a></li>
<li><a href="1.8-examples-of-linearization-using-the-influence-function.html#examples-of-linearization-using-the-influence-function" id="toc-examples-of-linearization-using-the-influence-function"><span class="toc-section-number">1.8</span> Examples of Linearization Using the Influence Function</a></li>
<li><a href="1.9-replication-designs.html#replication-designs" id="toc-replication-designs"><span class="toc-section-number">1.9</span> Replication Designs</a></li>
<li><a href="1.10-decomposition.html#decomposition" id="toc-decomposition"><span class="toc-section-number">1.10</span> Decomposition</a></li>
</ul></li>
<li class="has-sub"><a href="2-poverty.html#poverty" id="toc-poverty"><span class="toc-section-number">2</span> Poverty Indices</a>
<ul>
<li><a href="2.1-at-risk-of-poverty-threshold-svyarpt.html#at-risk-of-poverty-threshold-svyarpt" id="toc-at-risk-of-poverty-threshold-svyarpt"><span class="toc-section-number">2.1</span> At Risk of Poverty Threshold (svyarpt)</a></li>
<li><a href="2.2-at-risk-of-poverty-ratio-svyarpr.html#at-risk-of-poverty-ratio-svyarpr" id="toc-at-risk-of-poverty-ratio-svyarpr"><span class="toc-section-number">2.2</span> At Risk of Poverty Ratio (svyarpr)</a></li>
<li><a href="2.3-relative-median-income-ratio-svyrmir.html#relative-median-income-ratio-svyrmir" id="toc-relative-median-income-ratio-svyrmir"><span class="toc-section-number">2.3</span> Relative Median Income Ratio (svyrmir)</a></li>
<li><a href="2.4-relative-median-poverty-gap-svyrmpg.html#relative-median-poverty-gap-svyrmpg" id="toc-relative-median-poverty-gap-svyrmpg"><span class="toc-section-number">2.4</span> Relative Median Poverty Gap (svyrmpg)</a></li>
<li><a href="2.5-median-income-below-the-at-risk-of-poverty-threshold-svypoormed.html#median-income-below-the-at-risk-of-poverty-threshold-svypoormed" id="toc-median-income-below-the-at-risk-of-poverty-threshold-svypoormed"><span class="toc-section-number">2.5</span> Median Income Below the At Risk of Poverty Threshold (svypoormed)</a></li>
<li><a href="2.6-foster-greer-thorbecke-class-svyfgt-svyfgtdec.html#foster-greer-thorbecke-class-svyfgt-svyfgtdec" id="toc-foster-greer-thorbecke-class-svyfgt-svyfgtdec"><span class="toc-section-number">2.6</span> Foster-Greer-Thorbecke class (svyfgt, svyfgtdec)</a></li>
<li><a href="2.7-watts-poverty-measure-svywatts-svywattsdec.html#watts-poverty-measure-svywatts-svywattsdec" id="toc-watts-poverty-measure-svywatts-svywattsdec"><span class="toc-section-number">2.7</span> Watts poverty measure (svywatts, svywattsdec)</a></li>
</ul></li>
<li class="has-sub"><a href="3-inequality.html#inequality" id="toc-inequality"><span class="toc-section-number">3</span> Inequality Measurement</a>
<ul>
<li><a href="3.1-the-gender-pay-gap-svygpg.html#the-gender-pay-gap-svygpg" id="toc-the-gender-pay-gap-svygpg"><span class="toc-section-number">3.1</span> The Gender Pay Gap (svygpg)</a></li>
<li><a href="3.2-quintile-share-ratio-svyqsr.html#quintile-share-ratio-svyqsr" id="toc-quintile-share-ratio-svyqsr"><span class="toc-section-number">3.2</span> Quintile Share Ratio (svyqsr)</a></li>
<li><a href="3.3-lorenz-curve-svylorenz.html#lorenz-curve-svylorenz" id="toc-lorenz-curve-svylorenz"><span class="toc-section-number">3.3</span> Lorenz Curve (svylorenz)</a></li>
<li><a href="3.4-gini-index-svygini.html#gini-index-svygini" id="toc-gini-index-svygini"><span class="toc-section-number">3.4</span> Gini index (svygini)</a></li>
<li><a href="3.5-zenga-index-svyzenga.html#zenga-index-svyzenga" id="toc-zenga-index-svyzenga"><span class="toc-section-number">3.5</span> Zenga index (svyzenga)</a></li>
<li><a href="3.6-entropy-based-measures.html#entropy-based-measures" id="toc-entropy-based-measures"><span class="toc-section-number">3.6</span> Entropy-based Measures</a></li>
<li><a href="3.7-generalized-entropy-and-decomposition-svygei-svygeidec.html#generalized-entropy-and-decomposition-svygei-svygeidec" id="toc-generalized-entropy-and-decomposition-svygei-svygeidec"><span class="toc-section-number">3.7</span> Generalized Entropy and Decomposition (svygei, svygeidec)</a></li>
<li><a href="3.8-j-divergence-and-decomposition-svyjdiv-svyjdivdec.html#j-divergence-and-decomposition-svyjdiv-svyjdivdec" id="toc-j-divergence-and-decomposition-svyjdiv-svyjdivdec"><span class="toc-section-number">3.8</span> J-Divergence and Decomposition (svyjdiv, svyjdivdec)</a></li>
<li><a href="3.9-atkinson-index-svyatk.html#atkinson-index-svyatk" id="toc-atkinson-index-svyatk"><span class="toc-section-number">3.9</span> Atkinson index (svyatk)</a></li>
<li><a href="3.10-which-inequality-measure-should-be-used.html#which-inequality-measure-should-be-used" id="toc-which-inequality-measure-should-be-used"><span class="toc-section-number">3.10</span> Which inequality measure should be used?</a></li>
</ul></li>
<li><a href="4-richness-measures.html#richness-measures" id="toc-richness-measures"><span class="toc-section-number">4</span> Richness Measures</a></li>
</ul>
</div>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<div id="generalized-entropy-and-decomposition-svygei-svygeidec" class="section level2" number="3.7">
<h2><span class="header-section-number">3.7</span> Generalized Entropy and Decomposition (svygei, svygeidec)</h2>
<p>Using a generalization of the information function, now defined as:</p>
<p><span class="math display">\[
g(f) = \frac{1}{\alpha-1} [ 1 - f^{\alpha - 1} ]
\]</span></p>
<p>the <span class="math inline">\(\alpha\)</span>-class entropy is:</p>
<p><span class="math display">\[
H^{(\alpha)} (f) = \frac{1}{\alpha - 1} \bigg[ 1 - \int_{-\infty}^{\infty} f(y)^{ \alpha - 1} f(y) dy \bigg] \text{.}
\]</span></p>
<p>This relates to a class of inequality measures, the Generalized entropy indices, defined as:</p>
<p><span class="math display">\[
GE^{(\alpha)} = \frac{1}{\alpha^2 - \alpha} \int_{0}^\infty \bigg[ \bigg( \frac{y}{\mu} \bigg)^\alpha - 1 \bigg]dF(x) = - \frac{-H_\alpha(s) }{ \alpha } \text{.}
\]</span></p>
<p>The parameter <span class="math inline">\(\alpha\)</span> also has an economic interpretation: as <span class="math inline">\(\alpha\)</span> increases, the influence of high incomes upon the index increases. In some cases, this measure takes special forms, such as the mean log deviation and the aforementioned Theil index.</p>
<p><span class="citation">Biewen and Jenkins (<label for="tufte-mn-76" class="margin-toggle">&#8853;</label><input type="checkbox" id="tufte-mn-76" class="margin-toggle">2003<span class="marginnote">Biewen, Martin, and Stephen Jenkins. 2003. <span>“Estimation of Generalized Entropy and Atkinson Inequality Indices from Complex Survey Data.”</span> Discussion Papers of DIW Berlin 345. DIW Berlin, German Institute for Economic Research. <a href="http://EconPapers.repec.org/RePEc:diw:diwwpp:dp345">http://EconPapers.repec.org/RePEc:diw:diwwpp:dp345</a>.</span>)</span> use the following finite-population as the basis for a plugin estimator:</p>
<p><span class="math display">\[
GE^{(\alpha)} =
\begin{cases}
( \alpha^2 - \alpha)^{-1} \big[ U_0^{\alpha - 1} U_1^{-\alpha} U_\alpha -1 \big], &amp; \text{if } \alpha \in \mathbb{R} \setminus \{0,1\} \\
- T_0 U_0^{-1} + \log ( U_1 / U_0 ), &amp;\text{if } \alpha \rightarrow 0 \\
T_1 U_1^{-1} - \log ( U_1 / U_0 ), &amp; \text{if } \alpha \rightarrow 1
\end{cases}
\]</span></p>
<p>where <span class="math inline">\(U_\gamma = \sum_{i \in U} y_i^\gamma\)</span> and <span class="math inline">\(T_\gamma = \sum_{i \in U} y_i^\gamma \log y_i\)</span>. Since those are all functions of totals, the linearization of the indices are easily achieved using the theorems described in <span class="citation">Deville (<label for="tufte-mn-77" class="margin-toggle">&#8853;</label><input type="checkbox" id="tufte-mn-77" class="margin-toggle">1999<span class="marginnote">Deville, Jean-Claude. 1999. <span>“Variance Estimation for Complex Statistics and Estimators: Linearization and Residual Techniques.”</span> <em>Survey Methodology</em> 25 (2): 193–203. <a href="http://www.statcan.gc.ca/pub/12-001-x/1999002/article/4882-eng.pdf">http://www.statcan.gc.ca/pub/12-001-x/1999002/article/4882-eng.pdf</a>.</span>)</span>.</p>
<p>This class of inequality measure also has several desirable properties, such as additive decomposition. Additive decomposition allows researchers to compare the effects of inequality within and between population groups on the population’s level of inequality. Put simply, taking <span class="math inline">\(G\)</span> groups, an additive decomposable index allows for:</p>
<p><span class="math display">\[
\begin{aligned}
I ( \mathbf{y} ) &amp;= I_{Within} + I_{Between} \\
\end{aligned}
\]</span></p>
<p>where <span class="math inline">\(I_{Within} = \sum_{g \in G} W_g I( \mathbf{y}_g )\)</span>, with <span class="math inline">\(W_g\)</span> being measure-specific group weights; and <span class="math inline">\(I_{Between}\)</span> is a function of the group means and population sizes.</p>
<hr />
<p><strong>A replication example</strong></p>
<p>In July 2006, <span class="citation">Jenkins (<label for="tufte-mn-78" class="margin-toggle">&#8853;</label><input type="checkbox" id="tufte-mn-78" class="margin-toggle">2008<span class="marginnote">Jenkins, Stephen. 2008. <span>“Estimation and Interpretation of Measures of Inequality, Poverty, and Social Welfare Using Stata.”</span> North American Stata Users' Group Meetings 2006. Stata Users Group. <a href="http://EconPapers.repec.org/RePEc:boc:asug06:16">http://EconPapers.repec.org/RePEc:boc:asug06:16</a>.</span>)</span> presented at the North American Stata Users’ Group Meetings on the stata Generalized Entropy Index command. The example below reproduces those statistics.</p>
<p>Load and prepare the same data set:</p>
<div class="sourceCode" id="cb303"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb303-1"><a href="3.7-generalized-entropy-and-decomposition-svygei-svygeidec.html#cb303-1" tabindex="-1"></a><span class="co"># load the convey package</span></span>
<span id="cb303-2"><a href="3.7-generalized-entropy-and-decomposition-svygei-svygeidec.html#cb303-2" tabindex="-1"></a><span class="fu">library</span>(convey)</span>
<span id="cb303-3"><a href="3.7-generalized-entropy-and-decomposition-svygei-svygeidec.html#cb303-3" tabindex="-1"></a></span>
<span id="cb303-4"><a href="3.7-generalized-entropy-and-decomposition-svygei-svygeidec.html#cb303-4" tabindex="-1"></a><span class="co"># load the survey library</span></span>
<span id="cb303-5"><a href="3.7-generalized-entropy-and-decomposition-svygei-svygeidec.html#cb303-5" tabindex="-1"></a><span class="fu">library</span>(survey)</span>
<span id="cb303-6"><a href="3.7-generalized-entropy-and-decomposition-svygei-svygeidec.html#cb303-6" tabindex="-1"></a></span>
<span id="cb303-7"><a href="3.7-generalized-entropy-and-decomposition-svygei-svygeidec.html#cb303-7" tabindex="-1"></a><span class="co"># load the foreign library</span></span>
<span id="cb303-8"><a href="3.7-generalized-entropy-and-decomposition-svygei-svygeidec.html#cb303-8" tabindex="-1"></a><span class="fu">library</span>(foreign)</span>
<span id="cb303-9"><a href="3.7-generalized-entropy-and-decomposition-svygei-svygeidec.html#cb303-9" tabindex="-1"></a></span>
<span id="cb303-10"><a href="3.7-generalized-entropy-and-decomposition-svygei-svygeidec.html#cb303-10" tabindex="-1"></a><span class="co"># create a temporary file on the local disk</span></span>
<span id="cb303-11"><a href="3.7-generalized-entropy-and-decomposition-svygei-svygeidec.html#cb303-11" tabindex="-1"></a>tf <span class="ot">&lt;-</span> <span class="fu">tempfile</span>()</span>
<span id="cb303-12"><a href="3.7-generalized-entropy-and-decomposition-svygei-svygeidec.html#cb303-12" tabindex="-1"></a></span>
<span id="cb303-13"><a href="3.7-generalized-entropy-and-decomposition-svygei-svygeidec.html#cb303-13" tabindex="-1"></a><span class="co"># store the location of the presentation file</span></span>
<span id="cb303-14"><a href="3.7-generalized-entropy-and-decomposition-svygei-svygeidec.html#cb303-14" tabindex="-1"></a>presentation_zip <span class="ot">&lt;-</span></span>
<span id="cb303-15"><a href="3.7-generalized-entropy-and-decomposition-svygei-svygeidec.html#cb303-15" tabindex="-1"></a>  <span class="st">&quot;http://repec.org/nasug2006/nasug2006_jenkins.zip&quot;</span></span>
<span id="cb303-16"><a href="3.7-generalized-entropy-and-decomposition-svygei-svygeidec.html#cb303-16" tabindex="-1"></a></span>
<span id="cb303-17"><a href="3.7-generalized-entropy-and-decomposition-svygei-svygeidec.html#cb303-17" tabindex="-1"></a><span class="co"># download jenkins&#39; presentation to the temporary file</span></span>
<span id="cb303-18"><a href="3.7-generalized-entropy-and-decomposition-svygei-svygeidec.html#cb303-18" tabindex="-1"></a><span class="fu">download.file</span>(presentation_zip , tf , <span class="at">mode =</span> <span class="st">&#39;wb&#39;</span>)</span>
<span id="cb303-19"><a href="3.7-generalized-entropy-and-decomposition-svygei-svygeidec.html#cb303-19" tabindex="-1"></a></span>
<span id="cb303-20"><a href="3.7-generalized-entropy-and-decomposition-svygei-svygeidec.html#cb303-20" tabindex="-1"></a><span class="co"># unzip the contents of the archive</span></span>
<span id="cb303-21"><a href="3.7-generalized-entropy-and-decomposition-svygei-svygeidec.html#cb303-21" tabindex="-1"></a>presentation_files <span class="ot">&lt;-</span> <span class="fu">unzip</span>(tf , <span class="at">exdir =</span> <span class="fu">tempdir</span>())</span>
<span id="cb303-22"><a href="3.7-generalized-entropy-and-decomposition-svygei-svygeidec.html#cb303-22" tabindex="-1"></a></span>
<span id="cb303-23"><a href="3.7-generalized-entropy-and-decomposition-svygei-svygeidec.html#cb303-23" tabindex="-1"></a><span class="co"># load the institute for fiscal studies&#39; 1981, 1985, and 1991 data.frame objects</span></span>
<span id="cb303-24"><a href="3.7-generalized-entropy-and-decomposition-svygei-svygeidec.html#cb303-24" tabindex="-1"></a>x81 <span class="ot">&lt;-</span></span>
<span id="cb303-25"><a href="3.7-generalized-entropy-and-decomposition-svygei-svygeidec.html#cb303-25" tabindex="-1"></a>  <span class="fu">read.dta</span>(<span class="fu">grep</span>(<span class="st">&quot;ifs81&quot;</span> , presentation_files , <span class="at">value =</span> <span class="cn">TRUE</span>))</span>
<span id="cb303-26"><a href="3.7-generalized-entropy-and-decomposition-svygei-svygeidec.html#cb303-26" tabindex="-1"></a>x85 <span class="ot">&lt;-</span></span>
<span id="cb303-27"><a href="3.7-generalized-entropy-and-decomposition-svygei-svygeidec.html#cb303-27" tabindex="-1"></a>  <span class="fu">read.dta</span>(<span class="fu">grep</span>(<span class="st">&quot;ifs85&quot;</span> , presentation_files , <span class="at">value =</span> <span class="cn">TRUE</span>))</span>
<span id="cb303-28"><a href="3.7-generalized-entropy-and-decomposition-svygei-svygeidec.html#cb303-28" tabindex="-1"></a>x91 <span class="ot">&lt;-</span></span>
<span id="cb303-29"><a href="3.7-generalized-entropy-and-decomposition-svygei-svygeidec.html#cb303-29" tabindex="-1"></a>  <span class="fu">read.dta</span>(<span class="fu">grep</span>(<span class="st">&quot;ifs91&quot;</span> , presentation_files , <span class="at">value =</span> <span class="cn">TRUE</span>))</span>
<span id="cb303-30"><a href="3.7-generalized-entropy-and-decomposition-svygei-svygeidec.html#cb303-30" tabindex="-1"></a></span>
<span id="cb303-31"><a href="3.7-generalized-entropy-and-decomposition-svygei-svygeidec.html#cb303-31" tabindex="-1"></a><span class="co"># stack each of these three years of data into a single data.frame</span></span>
<span id="cb303-32"><a href="3.7-generalized-entropy-and-decomposition-svygei-svygeidec.html#cb303-32" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rbind</span>(x81 , x85 , x91)</span></code></pre></div>
<p>Replicate the author’s survey design statement from stata code..</p>
<pre><code>. * account for clustering within HHs 
. version 8: svyset [pweight = wgt], psu(hrn)
pweight is wgt
psu is hrn
construct an</code></pre>
<p>.. into R code:</p>
<div class="sourceCode" id="cb305"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb305-1"><a href="3.7-generalized-entropy-and-decomposition-svygei-svygeidec.html#cb305-1" tabindex="-1"></a><span class="co"># initiate a linearized survey design object</span></span>
<span id="cb305-2"><a href="3.7-generalized-entropy-and-decomposition-svygei-svygeidec.html#cb305-2" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">svydesign</span>( <span class="sc">~</span> hrn , <span class="at">data =</span> x , <span class="at">weights =</span> <span class="sc">~</span> wgt)</span>
<span id="cb305-3"><a href="3.7-generalized-entropy-and-decomposition-svygei-svygeidec.html#cb305-3" tabindex="-1"></a></span>
<span id="cb305-4"><a href="3.7-generalized-entropy-and-decomposition-svygei-svygeidec.html#cb305-4" tabindex="-1"></a><span class="co"># immediately run the `convey_prep` function on the survey design</span></span>
<span id="cb305-5"><a href="3.7-generalized-entropy-and-decomposition-svygei-svygeidec.html#cb305-5" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fu">convey_prep</span>(y)</span></code></pre></div>
<p>Replicate the author’s subset statement and each of his svygei results..</p>
<pre><code>. svygei x if year == 1981
 
Warning: x has 20 values = 0. Not used in calculations

Complex survey estimates of Generalized Entropy inequality indices
 
pweight: wgt                                   Number of obs    = 9752
Strata: &lt;one&gt;                                  Number of strata = 1
PSU: hrn                                       Number of PSUs   = 7459
                                               Population size  = 54766261
---------------------------------------------------------------------------
Index    |  Estimate   Std. Err.      z      P&gt;|z|     [95% Conf. Interval]
---------+-----------------------------------------------------------------
GE(-1)   |  .1902062   .02474921     7.69    0.000      .1416987   .2387138
MLD      |  .1142851   .00275138    41.54    0.000      .1088925   .1196777
Theil    |  .1116923   .00226489    49.31    0.000      .1072532   .1161314
GE(2)    |   .128793   .00330774    38.94    0.000      .1223099    .135276
GE(3)    |  .1739994   .00662015    26.28    0.000      .1610242   .1869747
---------------------------------------------------------------------------</code></pre>
<p>..using R code:</p>
<div class="sourceCode" id="cb307"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb307-1"><a href="3.7-generalized-entropy-and-decomposition-svygei-svygeidec.html#cb307-1" tabindex="-1"></a>z81 <span class="ot">&lt;-</span> <span class="fu">subset</span>(z , year <span class="sc">==</span> <span class="dv">1981</span>)</span>
<span id="cb307-2"><a href="3.7-generalized-entropy-and-decomposition-svygei-svygeidec.html#cb307-2" tabindex="-1"></a></span>
<span id="cb307-3"><a href="3.7-generalized-entropy-and-decomposition-svygei-svygeidec.html#cb307-3" tabindex="-1"></a><span class="fu">svygei</span>( <span class="sc">~</span> eybhc0 , <span class="fu">subset</span>(z81 , eybhc0 <span class="sc">&gt;</span> <span class="dv">0</span>) , <span class="at">epsilon =</span> <span class="sc">-</span><span class="dv">1</span>)</span></code></pre></div>
<pre><code>##            gei     SE
## eybhc0 0.19021 0.0247</code></pre>
<div class="sourceCode" id="cb309"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb309-1"><a href="3.7-generalized-entropy-and-decomposition-svygei-svygeidec.html#cb309-1" tabindex="-1"></a><span class="fu">svygei</span>( <span class="sc">~</span> eybhc0 , <span class="fu">subset</span>(z81 , eybhc0 <span class="sc">&gt;</span> <span class="dv">0</span>) , <span class="at">epsilon =</span> <span class="dv">0</span>)</span></code></pre></div>
<pre><code>##            gei     SE
## eybhc0 0.11429 0.0028</code></pre>
<div class="sourceCode" id="cb311"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb311-1"><a href="3.7-generalized-entropy-and-decomposition-svygei-svygeidec.html#cb311-1" tabindex="-1"></a><span class="fu">svygei</span>( <span class="sc">~</span> eybhc0 , <span class="fu">subset</span>(z81 , eybhc0 <span class="sc">&gt;</span> <span class="dv">0</span>))</span></code></pre></div>
<pre><code>##            gei     SE
## eybhc0 0.11169 0.0023</code></pre>
<div class="sourceCode" id="cb313"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb313-1"><a href="3.7-generalized-entropy-and-decomposition-svygei-svygeidec.html#cb313-1" tabindex="-1"></a><span class="fu">svygei</span>( <span class="sc">~</span> eybhc0 , <span class="fu">subset</span>(z81 , eybhc0 <span class="sc">&gt;</span> <span class="dv">0</span>) , <span class="at">epsilon =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>##            gei     SE
## eybhc0 0.12879 0.0033</code></pre>
<div class="sourceCode" id="cb315"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb315-1"><a href="3.7-generalized-entropy-and-decomposition-svygei-svygeidec.html#cb315-1" tabindex="-1"></a><span class="fu">svygei</span>( <span class="sc">~</span> eybhc0 , <span class="fu">subset</span>(z81 , eybhc0 <span class="sc">&gt;</span> <span class="dv">0</span>) , <span class="at">epsilon =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>##          gei     SE
## eybhc0 0.174 0.0066</code></pre>
<p>Confirm this replication applies for subsetted objects as well. Compare stata output..</p>
<pre><code>. svygei x if year == 1985 &amp; x &gt;= 1

Complex survey estimates of Generalized Entropy inequality indices
 
pweight: wgt                                   Number of obs    = 8969
Strata: &lt;one&gt;                                  Number of strata = 1
PSU: hrn                                       Number of PSUs   = 6950
                                               Population size  = 55042871
---------------------------------------------------------------------------
Index    |  Estimate   Std. Err.      z      P&gt;|z|     [95% Conf. Interval]
---------+-----------------------------------------------------------------
GE(-1)   |  .1602358   .00936931    17.10    0.000      .1418723   .1785993
MLD      |   .127616   .00332187    38.42    0.000      .1211052   .1341267
Theil    |  .1337177   .00406302    32.91    0.000      .1257543    .141681
GE(2)    |  .1676393   .00730057    22.96    0.000      .1533304   .1819481
GE(3)    |  .2609507   .01850689    14.10    0.000      .2246779   .2972235
---------------------------------------------------------------------------</code></pre>
<p>..to R code:</p>
<div class="sourceCode" id="cb318"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb318-1"><a href="3.7-generalized-entropy-and-decomposition-svygei-svygeidec.html#cb318-1" tabindex="-1"></a>z85 <span class="ot">&lt;-</span> <span class="fu">subset</span>(z , year <span class="sc">==</span> <span class="dv">1985</span>)</span>
<span id="cb318-2"><a href="3.7-generalized-entropy-and-decomposition-svygei-svygeidec.html#cb318-2" tabindex="-1"></a></span>
<span id="cb318-3"><a href="3.7-generalized-entropy-and-decomposition-svygei-svygeidec.html#cb318-3" tabindex="-1"></a><span class="fu">svygei</span>( <span class="sc">~</span> eybhc0 , <span class="fu">subset</span>(z85 , eybhc0 <span class="sc">&gt;</span> <span class="dv">1</span>) , <span class="at">epsilon =</span> <span class="sc">-</span><span class="dv">1</span>)</span></code></pre></div>
<pre><code>##            gei     SE
## eybhc0 0.16024 0.0094</code></pre>
<div class="sourceCode" id="cb320"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb320-1"><a href="3.7-generalized-entropy-and-decomposition-svygei-svygeidec.html#cb320-1" tabindex="-1"></a><span class="fu">svygei</span>( <span class="sc">~</span> eybhc0 , <span class="fu">subset</span>(z85 , eybhc0 <span class="sc">&gt;</span> <span class="dv">1</span>) , <span class="at">epsilon =</span> <span class="dv">0</span>)</span></code></pre></div>
<pre><code>##            gei     SE
## eybhc0 0.12762 0.0033</code></pre>
<div class="sourceCode" id="cb322"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb322-1"><a href="3.7-generalized-entropy-and-decomposition-svygei-svygeidec.html#cb322-1" tabindex="-1"></a><span class="fu">svygei</span>( <span class="sc">~</span> eybhc0 , <span class="fu">subset</span>(z85 , eybhc0 <span class="sc">&gt;</span> <span class="dv">1</span>))</span></code></pre></div>
<pre><code>##            gei     SE
## eybhc0 0.13372 0.0041</code></pre>
<div class="sourceCode" id="cb324"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb324-1"><a href="3.7-generalized-entropy-and-decomposition-svygei-svygeidec.html#cb324-1" tabindex="-1"></a><span class="fu">svygei</span>( <span class="sc">~</span> eybhc0 , <span class="fu">subset</span>(z85 , eybhc0 <span class="sc">&gt;</span> <span class="dv">1</span>) , <span class="at">epsilon =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>##            gei     SE
## eybhc0 0.16764 0.0073</code></pre>
<div class="sourceCode" id="cb326"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb326-1"><a href="3.7-generalized-entropy-and-decomposition-svygei-svygeidec.html#cb326-1" tabindex="-1"></a><span class="fu">svygei</span>( <span class="sc">~</span> eybhc0 , <span class="fu">subset</span>(z85 , eybhc0 <span class="sc">&gt;</span> <span class="dv">1</span>) , <span class="at">epsilon =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>##            gei     SE
## eybhc0 0.26095 0.0185</code></pre>
<p>Replicate the author’s decomposition by population subgroup (work status) shown on PDF page 57..</p>
<div class="sourceCode" id="cb328"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb328-1"><a href="3.7-generalized-entropy-and-decomposition-svygei-svygeidec.html#cb328-1" tabindex="-1"></a><span class="co"># define work status (PDF page 22)</span></span>
<span id="cb328-2"><a href="3.7-generalized-entropy-and-decomposition-svygei-svygeidec.html#cb328-2" tabindex="-1"></a>z <span class="ot">&lt;-</span></span>
<span id="cb328-3"><a href="3.7-generalized-entropy-and-decomposition-svygei-svygeidec.html#cb328-3" tabindex="-1"></a>  <span class="fu">update</span>(z , <span class="at">wkstatus =</span> <span class="fu">c</span>(<span class="dv">1</span> , <span class="dv">1</span> , <span class="dv">1</span> , <span class="dv">1</span> , <span class="dv">2</span> , <span class="dv">3</span> , <span class="dv">2</span> , <span class="dv">2</span>)[<span class="fu">as.numeric</span>(esbu)])</span>
<span id="cb328-4"><a href="3.7-generalized-entropy-and-decomposition-svygei-svygeidec.html#cb328-4" tabindex="-1"></a>z <span class="ot">&lt;-</span></span>
<span id="cb328-5"><a href="3.7-generalized-entropy-and-decomposition-svygei-svygeidec.html#cb328-5" tabindex="-1"></a>  <span class="fu">update</span>(z , <span class="at">wkstatus =</span> <span class="fu">factor</span>(wkstatus , <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;1+ ft working&quot;</span> , <span class="st">&quot;no ft working&quot;</span> , <span class="st">&quot;elderly&quot;</span>)))</span>
<span id="cb328-6"><a href="3.7-generalized-entropy-and-decomposition-svygei-svygeidec.html#cb328-6" tabindex="-1"></a></span>
<span id="cb328-7"><a href="3.7-generalized-entropy-and-decomposition-svygei-svygeidec.html#cb328-7" tabindex="-1"></a><span class="co"># subset to 1991 and remove records with zero income</span></span>
<span id="cb328-8"><a href="3.7-generalized-entropy-and-decomposition-svygei-svygeidec.html#cb328-8" tabindex="-1"></a>z91 <span class="ot">&lt;-</span> <span class="fu">subset</span>(z , year <span class="sc">==</span> <span class="dv">1991</span> <span class="sc">&amp;</span> eybhc0 <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb328-9"><a href="3.7-generalized-entropy-and-decomposition-svygei-svygeidec.html#cb328-9" tabindex="-1"></a></span>
<span id="cb328-10"><a href="3.7-generalized-entropy-and-decomposition-svygei-svygeidec.html#cb328-10" tabindex="-1"></a><span class="co"># population share</span></span>
<span id="cb328-11"><a href="3.7-generalized-entropy-and-decomposition-svygei-svygeidec.html#cb328-11" tabindex="-1"></a><span class="fu">svymean</span>( <span class="sc">~</span> wkstatus, z91)</span></code></pre></div>
<pre><code>##                          mean     SE
## wkstatus1+ ft working 0.61724 0.0067
## wkstatusno ft working 0.20607 0.0059
## wkstatuselderly       0.17669 0.0046</code></pre>
<div class="sourceCode" id="cb330"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb330-1"><a href="3.7-generalized-entropy-and-decomposition-svygei-svygeidec.html#cb330-1" tabindex="-1"></a><span class="co"># mean</span></span>
<span id="cb330-2"><a href="3.7-generalized-entropy-and-decomposition-svygei-svygeidec.html#cb330-2" tabindex="-1"></a><span class="fu">svyby</span>( <span class="sc">~</span> eybhc0, <span class="sc">~</span> wkstatus, z91, svymean)</span></code></pre></div>
<pre><code>##                    wkstatus   eybhc0       se
## 1+ ft working 1+ ft working 278.8040 3.703790
## no ft working no ft working 151.6317 3.153968
## elderly             elderly 176.6045 4.661740</code></pre>
<div class="sourceCode" id="cb332"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb332-1"><a href="3.7-generalized-entropy-and-decomposition-svygei-svygeidec.html#cb332-1" tabindex="-1"></a><span class="co"># subgroup indices: ge_k</span></span>
<span id="cb332-2"><a href="3.7-generalized-entropy-and-decomposition-svygei-svygeidec.html#cb332-2" tabindex="-1"></a><span class="fu">svyby</span>( <span class="sc">~</span> eybhc0 , <span class="sc">~</span> wkstatus , z91 , svygei , <span class="at">epsilon =</span> <span class="sc">-</span><span class="dv">1</span>)</span></code></pre></div>
<pre><code>##                    wkstatus     eybhc0          se
## 1+ ft working 1+ ft working  0.2300708  0.02853959
## no ft working no ft working 10.9231761 10.65482557
## elderly             elderly  0.1932164  0.02571991</code></pre>
<div class="sourceCode" id="cb334"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb334-1"><a href="3.7-generalized-entropy-and-decomposition-svygei-svygeidec.html#cb334-1" tabindex="-1"></a><span class="fu">svyby</span>( <span class="sc">~</span> eybhc0 , <span class="sc">~</span> wkstatus , z91 , svygei , <span class="at">epsilon =</span> <span class="dv">0</span>)</span></code></pre></div>
<pre><code>##                    wkstatus    eybhc0          se
## 1+ ft working 1+ ft working 0.1536921 0.006955506
## no ft working no ft working 0.1836835 0.014740510
## elderly             elderly 0.1653658 0.016409770</code></pre>
<div class="sourceCode" id="cb336"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb336-1"><a href="3.7-generalized-entropy-and-decomposition-svygei-svygeidec.html#cb336-1" tabindex="-1"></a><span class="fu">svyby</span>( <span class="sc">~</span> eybhc0 , <span class="sc">~</span> wkstatus , z91 , svygei , <span class="at">epsilon =</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>##                    wkstatus    eybhc0          se
## 1+ ft working 1+ ft working 0.1598558 0.008327994
## no ft working no ft working 0.1889909 0.016766120
## elderly             elderly 0.2023862 0.027787224</code></pre>
<div class="sourceCode" id="cb338"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb338-1"><a href="3.7-generalized-entropy-and-decomposition-svygei-svygeidec.html#cb338-1" tabindex="-1"></a><span class="fu">svyby</span>( <span class="sc">~</span> eybhc0 , <span class="sc">~</span> wkstatus , z91 , svygei , <span class="at">epsilon =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>##                    wkstatus    eybhc0         se
## 1+ ft working 1+ ft working 0.2130664 0.01546521
## no ft working no ft working 0.2846345 0.06016394
## elderly             elderly 0.3465088 0.07362898</code></pre>
<div class="sourceCode" id="cb340"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb340-1"><a href="3.7-generalized-entropy-and-decomposition-svygei-svygeidec.html#cb340-1" tabindex="-1"></a><span class="co"># GE decomposition</span></span>
<span id="cb340-2"><a href="3.7-generalized-entropy-and-decomposition-svygei-svygeidec.html#cb340-2" tabindex="-1"></a><span class="fu">svygeidec</span>( <span class="sc">~</span> eybhc0, <span class="sc">~</span> wkstatus, z91, <span class="at">epsilon =</span> <span class="sc">-</span><span class="dv">1</span>)</span></code></pre></div>
<pre><code>##         gei decomposition     SE
## total            3.682893 3.3999
## within           3.646572 3.3998
## between          0.036321 0.0028</code></pre>
<div class="sourceCode" id="cb342"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb342-1"><a href="3.7-generalized-entropy-and-decomposition-svygei-svygeidec.html#cb342-1" tabindex="-1"></a><span class="fu">svygeidec</span>( <span class="sc">~</span> eybhc0, <span class="sc">~</span> wkstatus, z91, <span class="at">epsilon =</span> <span class="dv">0</span>)</span></code></pre></div>
<pre><code>##         gei decomposition     SE
## total            0.195236 0.0065
## within           0.161935 0.0061
## between          0.033301 0.0025</code></pre>
<div class="sourceCode" id="cb344"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb344-1"><a href="3.7-generalized-entropy-and-decomposition-svygei-svygeidec.html#cb344-1" tabindex="-1"></a><span class="fu">svygeidec</span>( <span class="sc">~</span> eybhc0, <span class="sc">~</span> wkstatus, z91, <span class="at">epsilon =</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>##         gei decomposition     SE
## total            0.200390 0.0079
## within           0.169396 0.0076
## between          0.030994 0.0022</code></pre>
<div class="sourceCode" id="cb346"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb346-1"><a href="3.7-generalized-entropy-and-decomposition-svygei-svygeidec.html#cb346-1" tabindex="-1"></a><span class="fu">svygeidec</span>( <span class="sc">~</span> eybhc0, <span class="sc">~</span> wkstatus, z91, <span class="at">epsilon =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>##         gei decomposition     SE
## total            0.274325 0.0167
## within           0.245067 0.0164
## between          0.029258 0.0021</code></pre>
<p>For additional usage examples of <code>svygei</code> or <code>svygeidec</code>, type <code>?convey::svygei</code> or <code>?convey::svygeidec</code> in the R console.</p>
</div>
<p style="text-align: center;">
<a href="3.6-entropy-based-measures.html"><button class="btn btn-default">Previous</button></a>
<a href="3.8-j-divergence-and-decomposition-svyjdiv-svyjdivdec.html"><button class="btn btn-default">Next</button></a>
</p>
</div>
</div>



</body>
</html>
