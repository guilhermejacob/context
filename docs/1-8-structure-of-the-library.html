<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta property="og:title" content="Poverty and Inequality with Complex Survey Data" />
<meta property="og:type" content="book" />


<meta property="og:description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
<meta name="github-repo" content="gilhermejacob/context" />

<meta name="author" content="Guilherme Jacob, Anthony Damico, and Djalma Pessoa" />

<meta name="date" content="2016-12-09" />

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>
  <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_CHTML-full" type="text/javascript"></script>

<meta name="description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook.">

<title>Poverty and Inequality with Complex Survey Data</title>

<link href="libs/tufte-css-2015.12.29/tufte.css" rel="stylesheet" />


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>


<link rel="stylesheet" href="toc.css" type="text/css" />

</head>

<body>



<div class="row">
<div class="col-sm-12">
<div id="TOC">
<ul>
<li class="has-sub"><a href="index.html#introduction"><span class="toc-section-number">1</span> Introduction</a><ul>
<li><a href="1-1-install.html#install"><span class="toc-section-number">1.1</span> Installation</a></li>
<li><a href="1-2-survey.html#survey"><span class="toc-section-number">1.2</span> Complex surveys and statistical inference</a></li>
<li><a href="1-3-linearization.html#linearization"><span class="toc-section-number">1.3</span> Linearization</a></li>
<li><a href="1-4-influence-function.html#influence-function"><span class="toc-section-number">1.4</span> Influence function</a></li>
<li><a href="1-5-the-variance-estimator.html#the-variance-estimator"><span class="toc-section-number">1.5</span> The variance estimator</a></li>
<li><a href="1-6-influence-functions-examples.html#influence-functions---examples"><span class="toc-section-number">1.6</span> Influence functions - Examples</a></li>
<li><a href="1-7-linearization-by-influence-function-examples.html#linearization-by-influence-function---examples"><span class="toc-section-number">1.7</span> Linearization by influence function - Examples</a></li>
<li class="has-sub"><a href="1-8-structure-of-the-library.html#structure-of-the-library"><span class="toc-section-number">1.8</span> Structure of the library</a><ul>
<li><a href="1-8-structure-of-the-library.html#examples-of-use-of-the-library-convey"><span class="toc-section-number">1.8.1</span> Examples of use of the library convey</a></li>
</ul></li>
<li><a href="1-9-fgt-indicator.html#fgt-indicator"><span class="toc-section-number">1.9</span> FGT indicator</a></li>
</ul></li>
<li class="has-sub"><a href="2-poverty.html#poverty"><span class="toc-section-number">2</span> Poverty Indices</a><ul>
<li><a href="2-1-the-gender-pay-gap-svygpg.html#the-gender-pay-gap-svygpg"><span class="toc-section-number">2.1</span> The Gender Pay Gap (svygpg)</a></li>
<li><a href="2-2-quintile-share-ratio-svyqsr.html#quintile-share-ratio-svyqsr"><span class="toc-section-number">2.2</span> Quintile Share Ratio (svyqsr)</a></li>
<li><a href="2-3-relative-median-income-ratio-svyrmir.html#relative-median-income-ratio-svyrmir"><span class="toc-section-number">2.3</span> Relative Median Income Ratio (svyrmir)</a></li>
<li><a href="2-4-relative-median-poverty-gap-svyrmpg.html#relative-median-poverty-gap-svyrmpg"><span class="toc-section-number">2.4</span> Relative Median Poverty Gap (svyrmpg)</a></li>
<li><a href="2-5-median-income-below-the-at-risk-of-poverty-threshold-svypoormed.html#median-income-below-the-at-risk-of-poverty-threshold-svypoormed"><span class="toc-section-number">2.5</span> Median Income Below the At Risk of Poverty Threshold (svypoormed)</a></li>
<li><a href="2-6-foster-greer-thorbecke-class-svyfgt.html#foster-greer-thorbecke-class-svyfgt"><span class="toc-section-number">2.6</span> Foster-Greer-Thorbecke class (svyfgt)</a></li>
</ul></li>
<li class="has-sub"><a href="3-inequality.html#inequality"><span class="toc-section-number">3</span> Inequality Measurement</a><ul>
<li class="has-sub"><a href="3-1-theoretical-aspects-of-inequality.html#theoretical-aspects-of-inequality"><span class="toc-section-number">3.1</span> Theoretical aspects of inequality</a><ul>
<li><a href="3-1-theoretical-aspects-of-inequality.html#desirable-properties-of-inequality-measures"><span class="toc-section-number">3.1.1</span> Desirable properties of inequality measures</a></li>
</ul></li>
<li><a href="3-2-lorenz-curve-svylorenz.html#lorenz-curve-svylorenz"><span class="toc-section-number">3.2</span> Lorenz Curve (svylorenz)</a></li>
<li class="has-sub"><a href="3-3-measures-derived-from-the-lorenz-curve.html#measures-derived-from-the-lorenz-curve"><span class="toc-section-number">3.3</span> Measures derived from the Lorenz Curve</a><ul>
<li><a href="3-3-measures-derived-from-the-lorenz-curve.html#gini-index-svygini"><span class="toc-section-number">3.3.1</span> Gini index (svygini)</a></li>
<li><a href="3-3-measures-derived-from-the-lorenz-curve.html#amato-index-svyamato"><span class="toc-section-number">3.3.2</span> Amato index (svyamato)</a></li>
<li><a href="3-3-measures-derived-from-the-lorenz-curve.html#zenga-index-and-curve-svyzenga-svyzengacurve"><span class="toc-section-number">3.3.3</span> Zenga Index and Curve (svyzenga, svyzengacurve)</a></li>
</ul></li>
<li class="has-sub"><a href="3-4-entropy-based-measures.html#entropy-based-measures"><span class="toc-section-number">3.4</span> Entropy-based Measures</a><ul>
<li><a href="3-4-entropy-based-measures.html#atkinson-index-svyatk"><span class="toc-section-number">3.4.1</span> Atkinson index (svyatk)</a></li>
<li><a href="3-4-entropy-based-measures.html#generalized-entropy-and-decomposition-svygei-svygeidec"><span class="toc-section-number">3.4.2</span> Generalized Entropy and Decomposition (svygei, svygeidec)</a></li>
<li><a href="3-4-entropy-based-measures.html#j-divergence-entropy-and-decomposition-svyjdiv-svyjdivdec"><span class="toc-section-number">3.4.3</span> J-Divergence Entropy and Decomposition (svyjdiv, svyjdivdec)</a></li>
<li><a href="3-4-entropy-based-measures.html#renyi-divergence-svyrenyi"><span class="toc-section-number">3.4.4</span> Rényi Divergence (svyrenyi)</a></li>
</ul></li>
</ul></li>
<li class="has-sub"><a href="4-multidimensional.html#multidimensional"><span class="toc-section-number">4</span> Multidimensional Indices</a><ul>
<li><a href="4-1-alkire-foster-class-and-decomposition-svyafc-svyafcdec.html#alkire-foster-class-and-decomposition-svyafc-svyafcdec"><span class="toc-section-number">4.1</span> Alkire-Foster Class and Decomposition (svyafc, svyafcdec)</a></li>
<li><a href="4-2-bourguignon-1999-inequality-class-svybmi.html#bourguignon-1999-inequality-class-svybmi"><span class="toc-section-number">4.2</span> Bourguignon (1999) inequality class (svybmi)</a></li>
</ul></li>
</ul>
</div>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<div id="structure-of-the-library" class="section level2">
<h2><span class="header-section-number">1.8</span> Structure of the library</h2>
<p>In the library convey, there are some basic functions that produces the linearized variables of some estimates that often enter in the definition of measures of concentration and poverty. For example the <code>quantile</code> which is linearized by the function <code>svyiqalpha</code>. Other example is the function <code>svyisq</code> that linearizes the total below a quantile of the variable.</p>
<p>From the linearized variables of these basic estimates it is possible by using rules of composition, valid for influence functions, to derive the influence function of more complex estimates. By definition the influence function is a Gateaux derivative and the rules rules of composition valid for Gateaux derivatives also hold for Influence Functions.</p>
<p>The following property of Gateaux derivatives was often used in the library convey. Let <span class="math inline">\(g\)</span> be a differentible function of <span class="math inline">\(m\)</span> variables. Suppose we want to compute the influence function of the estimator <span class="math inline">\(g(T_1, T_2,\ldots, T_m)\)</span>, knowing the Influence function of the estimators <span class="math inline">\(T_i, i=1,\ldots, m\)</span>. Then the following holds:</p>
<p><span class="math display">\[
I(g(T_1, T_2,\ldots, T_m)) = \sum_{i=1}^m \frac{\partial g}{\partial T_i}I(T_i)
\]</span></p>
<p>In the library convey this rule is implemented by the function <code>contrastinf</code> which uses the R function <code>deriv</code> to compute the formal partial derivatives <span class="math inline">\(\frac{\partial g}{\partial T_i}\)</span>.</p>
<p>For example, suppose we want to linearize the <code>Relative median poverty gap</code>(rmpg), defined as the difference between the at-risk-of-poverty threshold (<code>arpt</code>) and the median of incomes less than the <code>arpt</code> relative to the <code>arprt</code>:</p>
<p><span class="math display">\[
rmpg= \frac{arpt-medpoor} {arpt}
\]</span></p>
<p>where <code>medpoor</code> is the median of incomes less than <code>arpt</code>.</p>
<p>Suppose we know how to linearize <code>arpt</code> and <code>medpoor</code>, then by applying the function <code>contrastinf</code> with <span class="math display">\[
g(T_1,T_2)= \frac{(T_1 - T_2)}{T_1}
\]</span> we linearize the <code>rmpg</code>.</p>
<div id="examples-of-use-of-the-library-convey" class="section level3">
<h3><span class="header-section-number">1.8.1</span> Examples of use of the library convey</h3>
<p>In the following examples we will use the data set <code>eusilc</code> contained in the libraries <code>vardpoor</code> and <code>Laeken</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(vardpoor)
<span class="kw">data</span>(eusilc)</code></pre></div>
<p>Next, we create an object of class <code>survey.design</code> using the function <code>svydesign</code> of the library survey:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(survey)
des_eusilc &lt;-<span class="st"> </span><span class="kw">svydesign</span>(<span class="dt">ids =</span> ~rb030, <span class="dt">strata =</span>~db040,  <span class="dt">weights =</span> ~rb050, <span class="dt">data =</span> eusilc)</code></pre></div>
<p>Right after the creation of the design object <code>des_eusilc</code>, we should use the function <code>convey_prep</code> that adds an attribute to the survey design which saves information on the design object based upon the whole sample, needed to work with subset designs.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(convey)
des_eusilc &lt;-<span class="st"> </span><span class="kw">convey_prep</span>( des_eusilc )</code></pre></div>
<p>To estimate the <code>at-risk-of-poverty rate</code> we use the function <code>svyarpt</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">svyarpr</span>(~eqIncome, <span class="dt">design=</span>des_eusilc)</code></pre></div>
<pre><code>            arpr     SE
eqIncome 0.14444 0.0028</code></pre>
<p>To estimate the <code>at-risk-of-poverty rate</code> for domains defined by the variable <code>db040</code> we use</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">svyby</span>(~eqIncome, <span class="dt">by =</span> ~db040, <span class="dt">design =</span> des_eusilc, <span class="dt">FUN =</span> svyarpr, <span class="dt">deff =</span> <span class="ot">FALSE</span>)</code></pre></div>
<pre><code>                      db040  eqIncome          se
Burgenland       Burgenland 0.1953984 0.017202243
Carinthia         Carinthia 0.1308627 0.010610622
Lower Austria Lower Austria 0.1384362 0.006517660
Salzburg           Salzburg 0.1378734 0.011579280
Styria               Styria 0.1437464 0.007452360
Tyrol                 Tyrol 0.1530819 0.009880430
Upper Austria Upper Austria 0.1088977 0.005928336
Vienna               Vienna 0.1723468 0.007682826
Vorarlberg       Vorarlberg 0.1653731 0.013754670</code></pre>
<p>Using the same data set, we estimate the <code>quintile share ratio</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># for the whole population</span>
<span class="kw">svyqsr</span>(~eqIncome, <span class="dt">design=</span>des_eusilc, <span class="dt">alpha=</span> .<span class="dv">20</span>)</code></pre></div>
<pre><code>          qsr     SE
eqIncome 3.97 0.0426</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># for domains</span>
<span class="kw">svyby</span>(~eqIncome, <span class="dt">by =</span> ~db040, <span class="dt">design =</span> des_eusilc,
  <span class="dt">FUN =</span> svyqsr, <span class="dt">alpha=</span> .<span class="dv">20</span>, <span class="dt">deff =</span> <span class="ot">FALSE</span>)</code></pre></div>
<pre><code>                      db040 eqIncome         se
Burgenland       Burgenland 5.008486 0.32755685
Carinthia         Carinthia 3.562404 0.10909726
Lower Austria Lower Austria 3.824539 0.08783599
Salzburg           Salzburg 3.768393 0.17015086
Styria               Styria 3.464305 0.09364800
Tyrol                 Tyrol 3.586046 0.13629739
Upper Austria Upper Austria 3.668289 0.09310624
Vienna               Vienna 4.654743 0.13135731
Vorarlberg       Vorarlberg 4.366511 0.20532075</code></pre>
<p>These functions can be used as S3 methods for the classes <code>survey.design</code> and <code>svyrep.design</code>.</p>
<p>Let’s create a design object of class <code>svyrep.design</code> and run the function <code>convey_prep</code> on it:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">des_eusilc_rep &lt;-<span class="st"> </span><span class="kw">as.svrepdesign</span>(des_eusilc, <span class="dt">type =</span> <span class="st">&quot;bootstrap&quot;</span>)
des_eusilc_rep &lt;-<span class="st"> </span><span class="kw">convey_prep</span>(des_eusilc_rep) </code></pre></div>
<p>and then use the function <code>svyarpr</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">svyarpr</span>(~eqIncome, <span class="dt">design=</span>des_eusilc_rep)</code></pre></div>
<pre><code>            arpr     SE
eqIncome 0.14444 0.0028</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">svyby</span>(~eqIncome, <span class="dt">by =</span> ~db040, <span class="dt">design =</span> des_eusilc_rep, <span class="dt">FUN =</span> svyarpr, <span class="dt">deff =</span> <span class="ot">FALSE</span>)</code></pre></div>
<pre><code>                      db040  eqIncome se.eqIncome
Burgenland       Burgenland 0.1953984 0.018939588
Carinthia         Carinthia 0.1308627 0.009883816
Lower Austria Lower Austria 0.1384362 0.006566566
Salzburg           Salzburg 0.1378734 0.012520599
Styria               Styria 0.1437464 0.007475742
Tyrol                 Tyrol 0.1530819 0.011279331
Upper Austria Upper Austria 0.1088977 0.006957120
Vienna               Vienna 0.1723468 0.007096563
Vorarlberg       Vorarlberg 0.1653731 0.011297291</code></pre>
<p>The functions of the library convey are called in a similar way to the functions in library survey.</p>
<p>It is also possible to deal with missing values by using the argument <code>na.rm</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># survey.design using a variable with missings</span>
<span class="kw">svygini</span>( ~<span class="st"> </span>py010n , <span class="dt">design =</span> des_eusilc )</code></pre></div>
<pre><code>       gini SE
py010n   NA NA</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">svygini</span>( ~<span class="st"> </span>py010n , <span class="dt">design =</span> des_eusilc , <span class="dt">na.rm =</span> <span class="ot">TRUE</span> )</code></pre></div>
<pre><code>          gini     SE
py010n 0.64606 0.0036</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># svyrep.design using a variable with missings</span>
<span class="co"># svygini( ~ py010n , design = des_eusilc_rep ) get error</span>
<span class="kw">svygini</span>( ~<span class="st"> </span>py010n , <span class="dt">design =</span> des_eusilc_rep , <span class="dt">na.rm =</span> <span class="ot">TRUE</span> )</code></pre></div>
<pre><code>          gini     SE
py010n 0.64606 0.0032</code></pre>
</div>
</div>
<p style="text-align: center;">
<a href="1-7-linearization-by-influence-function-examples.html"><button class="btn btn-default">Previous</button></a>
<a href="1-9-fgt-indicator.html"><button class="btn btn-default">Next</button></a>
</p>
</div>
</div>



</body>
</html>
