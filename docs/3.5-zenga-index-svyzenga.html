<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="3.5 Zenga index (svyzenga) | Poverty and Inequality with Complex Survey Data" />
<meta property="og:type" content="book" />

<meta property="og:description" content="A book about the R convey package" />
<meta name="github-repo" content="guilhermejacob/context" />

<meta name="author" content="Guilherme Jacob, Anthony Damico, and Djalma Pessoa" />

<meta name="date" content="2022-08-23" />

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<meta name="description" content="A book about the R convey package">

<title>3.5 Zenga index (svyzenga) | Poverty and Inequality with Complex Survey Data</title>

<link href="libs/tufte-css-2015.12.29/tufte-fonts.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte-background.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte-italics.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte.css" rel="stylesheet" />


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="toc.css" type="text/css" />

</head>

<body>



<div class="row">
<div class="col-sm-12">
<div id="TOC">
<ul>
<li class="has-sub"><a href="index.html#introduction" id="toc-introduction"><span class="toc-section-number">1</span> Introduction</a>
<ul>
<li><a href="1.1-install.html#install" id="toc-install"><span class="toc-section-number">1.1</span> Installation</a></li>
<li><a href="1.2-survey.html#survey" id="toc-survey"><span class="toc-section-number">1.2</span> Complex surveys and statistical inference</a></li>
<li><a href="1.3-usage-examples.html#usage-examples" id="toc-usage-examples"><span class="toc-section-number">1.3</span> Usage Examples</a></li>
<li><a href="1.4-underlying-calculations.html#underlying-calculations" id="toc-underlying-calculations"><span class="toc-section-number">1.4</span> Underlying Calculations</a></li>
<li><a href="1.5-the-variance-estimator.html#the-variance-estimator" id="toc-the-variance-estimator"><span class="toc-section-number">1.5</span> The Variance Estimator</a></li>
<li><a href="1.6-influence-functions.html#influence-functions" id="toc-influence-functions"><span class="toc-section-number">1.6</span> Influence Functions</a></li>
<li><a href="1.7-influence-function-examples.html#influence-function-examples" id="toc-influence-function-examples"><span class="toc-section-number">1.7</span> Influence Function Examples</a></li>
<li><a href="1.8-examples-of-linearization-using-the-influence-function.html#examples-of-linearization-using-the-influence-function" id="toc-examples-of-linearization-using-the-influence-function"><span class="toc-section-number">1.8</span> Examples of Linearization Using the Influence Function</a></li>
<li><a href="1.9-replication-designs.html#replication-designs" id="toc-replication-designs"><span class="toc-section-number">1.9</span> Replication Designs</a></li>
<li><a href="1.10-decomposition.html#decomposition" id="toc-decomposition"><span class="toc-section-number">1.10</span> Decomposition</a></li>
</ul></li>
<li class="has-sub"><a href="2-poverty.html#poverty" id="toc-poverty"><span class="toc-section-number">2</span> Poverty Indices</a>
<ul>
<li><a href="2.1-at-risk-of-poverty-threshold-svyarpt.html#at-risk-of-poverty-threshold-svyarpt" id="toc-at-risk-of-poverty-threshold-svyarpt"><span class="toc-section-number">2.1</span> At Risk of Poverty Threshold (svyarpt)</a></li>
<li><a href="2.2-at-risk-of-poverty-ratio-svyarpr.html#at-risk-of-poverty-ratio-svyarpr" id="toc-at-risk-of-poverty-ratio-svyarpr"><span class="toc-section-number">2.2</span> At Risk of Poverty Ratio (svyarpr)</a></li>
<li><a href="2.3-relative-median-income-ratio-svyrmir.html#relative-median-income-ratio-svyrmir" id="toc-relative-median-income-ratio-svyrmir"><span class="toc-section-number">2.3</span> Relative Median Income Ratio (svyrmir)</a></li>
<li><a href="2.4-relative-median-poverty-gap-svyrmpg.html#relative-median-poverty-gap-svyrmpg" id="toc-relative-median-poverty-gap-svyrmpg"><span class="toc-section-number">2.4</span> Relative Median Poverty Gap (svyrmpg)</a></li>
<li><a href="2.5-median-income-below-the-at-risk-of-poverty-threshold-svypoormed.html#median-income-below-the-at-risk-of-poverty-threshold-svypoormed" id="toc-median-income-below-the-at-risk-of-poverty-threshold-svypoormed"><span class="toc-section-number">2.5</span> Median Income Below the At Risk of Poverty Threshold (svypoormed)</a></li>
<li><a href="2.6-foster-greer-thorbecke-class-svyfgt-svyfgtdec.html#foster-greer-thorbecke-class-svyfgt-svyfgtdec" id="toc-foster-greer-thorbecke-class-svyfgt-svyfgtdec"><span class="toc-section-number">2.6</span> Foster-Greer-Thorbecke class (svyfgt, svyfgtdec)</a></li>
<li><a href="2.7-watts-poverty-measure-svywatts-svywattsdec.html#watts-poverty-measure-svywatts-svywattsdec" id="toc-watts-poverty-measure-svywatts-svywattsdec"><span class="toc-section-number">2.7</span> Watts poverty measure (svywatts, svywattsdec)</a></li>
</ul></li>
<li class="has-sub"><a href="3-inequality.html#inequality" id="toc-inequality"><span class="toc-section-number">3</span> Inequality Measurement</a>
<ul>
<li><a href="3.1-the-gender-pay-gap-svygpg.html#the-gender-pay-gap-svygpg" id="toc-the-gender-pay-gap-svygpg"><span class="toc-section-number">3.1</span> The Gender Pay Gap (svygpg)</a></li>
<li><a href="3.2-quintile-share-ratio-svyqsr.html#quintile-share-ratio-svyqsr" id="toc-quintile-share-ratio-svyqsr"><span class="toc-section-number">3.2</span> Quintile Share Ratio (svyqsr)</a></li>
<li><a href="3.3-lorenz-curve-svylorenz.html#lorenz-curve-svylorenz" id="toc-lorenz-curve-svylorenz"><span class="toc-section-number">3.3</span> Lorenz Curve (svylorenz)</a></li>
<li><a href="3.4-gini-index-svygini.html#gini-index-svygini" id="toc-gini-index-svygini"><span class="toc-section-number">3.4</span> Gini index (svygini)</a></li>
<li><a href="3.5-zenga-index-svyzenga.html#zenga-index-svyzenga" id="toc-zenga-index-svyzenga"><span class="toc-section-number">3.5</span> Zenga index (svyzenga)</a></li>
<li><a href="3.6-entropy-based-measures.html#entropy-based-measures" id="toc-entropy-based-measures"><span class="toc-section-number">3.6</span> Entropy-based Measures</a></li>
<li><a href="3.7-generalized-entropy-and-decomposition-svygei-svygeidec.html#generalized-entropy-and-decomposition-svygei-svygeidec" id="toc-generalized-entropy-and-decomposition-svygei-svygeidec"><span class="toc-section-number">3.7</span> Generalized Entropy and Decomposition (svygei, svygeidec)</a></li>
<li><a href="3.8-j-divergence-and-decomposition-svyjdiv-svyjdivdec.html#j-divergence-and-decomposition-svyjdiv-svyjdivdec" id="toc-j-divergence-and-decomposition-svyjdiv-svyjdivdec"><span class="toc-section-number">3.8</span> J-Divergence and Decomposition (svyjdiv, svyjdivdec)</a></li>
<li><a href="3.9-atkinson-index-svyatk.html#atkinson-index-svyatk" id="toc-atkinson-index-svyatk"><span class="toc-section-number">3.9</span> Atkinson index (svyatk)</a></li>
<li><a href="3.10-which-inequality-measure-should-be-used.html#which-inequality-measure-should-be-used" id="toc-which-inequality-measure-should-be-used"><span class="toc-section-number">3.10</span> Which inequality measure should be used?</a></li>
</ul></li>
</ul>
</div>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<div id="zenga-index-svyzenga" class="section level2" number="3.5">
<h2><span class="header-section-number">3.5</span> Zenga index (svyzenga)</h2>
<p>Proposed by <span class="citation">Zenga (<label for="tufte-mn-59" class="margin-toggle">&#8853;</label><input type="checkbox" id="tufte-mn-59" class="margin-toggle">2007<span class="marginnote">Zenga, Michele. 2007. <span>“Inequality Curve and Inequality Index Based on the Ratios Between Lower and Upper Arithmetic Means.”</span> <em>Statistica e Applicazioni</em> 1 (4): 3–27.</span>)</span>, the Zenga index is another inequality measure related to the Lorenz curve with interesting properties. For continuous populations, it is defined as:</p>
<p><span class="math display">\[
Z = 1 - \int_{0}^{1} \frac{L(p)}{p} \cdot \frac{ 1 - p }{ 1 - L(p) } dp
\]</span></p>
<p>In practice, <code>convey</code> uses the <span class="citation">Barabesi, Diana, and Perri (<label for="tufte-mn-60" class="margin-toggle">&#8853;</label><input type="checkbox" id="tufte-mn-60" class="margin-toggle">2016<span class="marginnote">Barabesi, Lucio, Giancarlo Diana, and Pier Francesco Perri. 2016. <span>“Linearization of Inequality Indices in the Design-Based Framework.”</span> <em>Statistics</em> 50 (5): 1161–72. <a href="https://doi.org/10.1080/02331888.2015.1135924">https://doi.org/10.1080/02331888.2015.1135924</a>.</span>)</span> estimator, based on the finite population Zenga index, and a variance estimator derived using Deville’s <span class="citation">(<label for="tufte-mn-61" class="margin-toggle">&#8853;</label><input type="checkbox" id="tufte-mn-61" class="margin-toggle">1999<span class="marginnote">Deville, Jean-Claude. 1999. <span>“Variance Estimation for Complex Statistics and Estimators: Linearization and Residual Techniques.”</span> <em>Survey Methodology</em> 25 (2): 193–203. <a href="http://www.statcan.gc.ca/pub/12-001-x/1999002/article/4882-eng.pdf">http://www.statcan.gc.ca/pub/12-001-x/1999002/article/4882-eng.pdf</a>.</span>)</span> influence function method.</p>
<p>Alternatively, <span class="citation">Langel and Tillé (<label for="tufte-mn-62" class="margin-toggle">&#8853;</label><input type="checkbox" id="tufte-mn-62" class="margin-toggle">2012<span class="marginnote">Langel, Matti, and Yves Tillé. 2012. <span>“Inference by Linearization for Zenga’s New Inequality Index: A Comparison with the Gini Index.”</span> <em>Metrika</em> 75 (8): 1093–1110. <a href="https://doi.org/10.1007/s00184-011-0369-1">https://doi.org/10.1007/s00184-011-0369-1</a>.</span>)</span> uses an estimator based on smoothed quantiles and a variance estimator based on <span class="citation">Demnati and Rao (<label for="tufte-mn-63" class="margin-toggle">&#8853;</label><input type="checkbox" id="tufte-mn-63" class="margin-toggle">2004<span class="marginnote">Demnati, A., and J. N. K. Rao. 2004. <span>“<span class="nocase">Linearization Variance Estimators for Survey Data</span>.”</span> <em>Survey Methodology</em> 30 (1): 17–26. <a href="https://www150.statcan.gc.ca/n1/en/pub/12-001-x/2004001/article/6991-eng.pdf">https://www150.statcan.gc.ca/n1/en/pub/12-001-x/2004001/article/6991-eng.pdf</a>.</span>)</span> linearization method. However, <span class="citation">Barabesi, Diana, and Perri (<label for="tufte-mn-64" class="margin-toggle">&#8853;</label><input type="checkbox" id="tufte-mn-64" class="margin-toggle">2016<span class="marginnote">Barabesi, Lucio, Giancarlo Diana, and Pier Francesco Perri. 2016. <span>“Linearization of Inequality Indices in the Design-Based Framework.”</span> <em>Statistics</em> 50 (5): 1161–72. <a href="https://doi.org/10.1080/02331888.2015.1135924">https://doi.org/10.1080/02331888.2015.1135924</a>.</span>)</span> finds that both estimators behave very similarly.</p>
<p>The intuition behind the Zenga index is based on argument similar to the Quatile Share Ratio or Palma index. While the QSR and Palma indices are based on ratios of bottom and upper shares, the Zenga scores (but not the measure itself!) is the ratio of bottom and upper means. The Zenga index is the avreage of those scores.</p>
<p>For a given p, when the mean income of the poorest is not much smaller than the mean income of the richest, the ratio is close to one, resulting in Z(p) close to zero. However, when the bottom mean is much smaller than the upper mean, the ratio goes to 0, resulting in a Z(p) close to one.</p>
<p>Take the poorest 20%: the mean income of the poorest 20%, this is the lower mean. The “complement” is the mean income of the richest 80%: this is the upper mean. If the lower mean is $100 and the upper mean is $1,000, then the respective point on the Zenga curve would associate the fraction 20% to 1 - ( $100 / $1,000 ) = 0.9. In other words, Z(20%) = 0.9 or 90%.</p>
<p>In this case, we took a fixed p = 20%; however, the full Zenga curve would be computed varying p from 0% to 100%. Then, the Zenga index is the integral of this curve in the interval (0,1).</p>
<p>Unlike the relationship between the Gini coefficient and the Lorenz curve, this allows for a more straightforward graphical interpretation (see Figure 1 from <span class="citation">Langel and Tillé (<label for="tufte-mn-65" class="margin-toggle">&#8853;</label><input type="checkbox" id="tufte-mn-65" class="margin-toggle">2012<span class="marginnote">Langel, Matti, and Yves Tillé. 2012. <span>“Inference by Linearization for Zenga’s New Inequality Index: A Comparison with the Gini Index.”</span> <em>Metrika</em> 75 (8): 1093–1110. <a href="https://doi.org/10.1007/s00184-011-0369-1">https://doi.org/10.1007/s00184-011-0369-1</a>.</span>)</span>) of the Zenga index. In fact, the Zenga index is the mean of the Y axis of the Zenga coordinates.</p>
<p>According to <span class="citation">Langel and Tillé (<label for="tufte-mn-66" class="margin-toggle">&#8853;</label><input type="checkbox" id="tufte-mn-66" class="margin-toggle">2012<span class="marginnote">Langel, Matti, and Yves Tillé. 2012. <span>“Inference by Linearization for Zenga’s New Inequality Index: A Comparison with the Gini Index.”</span> <em>Metrika</em> 75 (8): 1093–1110. <a href="https://doi.org/10.1007/s00184-011-0369-1">https://doi.org/10.1007/s00184-011-0369-1</a>.</span>)</span>, “the Zenga index is significantly less affected by extreme observations than the Gini index. This is a very important advantage of the Zenga index because inference from income data is often confronted with extreme values.”</p>
<hr />
<p><strong>A replication example</strong></p>
<p>While it is not possible to reproduce the exact results because their simulation includes random sampling, we can replicate a Monte Carlo experiment similar to the one presented by <span class="citation">Barabesi, Diana, and Perri (<label for="tufte-mn-67" class="margin-toggle">&#8853;</label><input type="checkbox" id="tufte-mn-67" class="margin-toggle">2016<span class="marginnote">Barabesi, Lucio, Giancarlo Diana, and Pier Francesco Perri. 2016. <span>“Linearization of Inequality Indices in the Design-Based Framework.”</span> <em>Statistics</em> 50 (5): 1161–72. <a href="https://doi.org/10.1080/02331888.2015.1135924">https://doi.org/10.1080/02331888.2015.1135924</a>.</span>)</span> in Table 2.</p>
<p>Load and prepare the data set:</p>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb238-1"><a href="3.5-zenga-index-svyzenga.html#cb238-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load the convey package</span></span>
<span id="cb238-2"><a href="3.5-zenga-index-svyzenga.html#cb238-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(convey)</span>
<span id="cb238-3"><a href="3.5-zenga-index-svyzenga.html#cb238-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-4"><a href="3.5-zenga-index-svyzenga.html#cb238-4" aria-hidden="true" tabindex="-1"></a><span class="co"># load the survey library</span></span>
<span id="cb238-5"><a href="3.5-zenga-index-svyzenga.html#cb238-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survey)</span>
<span id="cb238-6"><a href="3.5-zenga-index-svyzenga.html#cb238-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-7"><a href="3.5-zenga-index-svyzenga.html#cb238-7" aria-hidden="true" tabindex="-1"></a><span class="co"># create a temporary file on the local disk</span></span>
<span id="cb238-8"><a href="3.5-zenga-index-svyzenga.html#cb238-8" aria-hidden="true" tabindex="-1"></a>tf <span class="ot">&lt;-</span> <span class="fu">tempfile</span>()</span>
<span id="cb238-9"><a href="3.5-zenga-index-svyzenga.html#cb238-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-10"><a href="3.5-zenga-index-svyzenga.html#cb238-10" aria-hidden="true" tabindex="-1"></a><span class="co"># store the location of the zip file</span></span>
<span id="cb238-11"><a href="3.5-zenga-index-svyzenga.html#cb238-11" aria-hidden="true" tabindex="-1"></a>data_zip <span class="ot">&lt;-</span> <span class="st">&quot;https://www.bancaditalia.it/statistiche/tematiche/indagini-famiglie-imprese/bilanci-famiglie/distribuzione-microdati/documenti/ind12_ascii.zip&quot;</span></span>
<span id="cb238-12"><a href="3.5-zenga-index-svyzenga.html#cb238-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-13"><a href="3.5-zenga-index-svyzenga.html#cb238-13" aria-hidden="true" tabindex="-1"></a><span class="co"># download to the temporary file</span></span>
<span id="cb238-14"><a href="3.5-zenga-index-svyzenga.html#cb238-14" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>( data_zip , tf , <span class="at">mode =</span> <span class="st">&#39;wb&#39;</span> )</span>
<span id="cb238-15"><a href="3.5-zenga-index-svyzenga.html#cb238-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-16"><a href="3.5-zenga-index-svyzenga.html#cb238-16" aria-hidden="true" tabindex="-1"></a><span class="co"># unzip the contents of the archive to a temporary directory</span></span>
<span id="cb238-17"><a href="3.5-zenga-index-svyzenga.html#cb238-17" aria-hidden="true" tabindex="-1"></a>td <span class="ot">&lt;-</span> <span class="fu">file.path</span>( <span class="fu">tempdir</span>() , <span class="st">&quot;shiw2012&quot;</span> )</span>
<span id="cb238-18"><a href="3.5-zenga-index-svyzenga.html#cb238-18" aria-hidden="true" tabindex="-1"></a>data_files <span class="ot">&lt;-</span> <span class="fu">unzip</span>( tf , <span class="at">exdir =</span> td )</span>
<span id="cb238-19"><a href="3.5-zenga-index-svyzenga.html#cb238-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-20"><a href="3.5-zenga-index-svyzenga.html#cb238-20" aria-hidden="true" tabindex="-1"></a><span class="co"># load the household, consumption and income from SHIW (2012) survey data</span></span>
<span id="cb238-21"><a href="3.5-zenga-index-svyzenga.html#cb238-21" aria-hidden="true" tabindex="-1"></a>hhr.df <span class="ot">&lt;-</span> <span class="fu">read.csv</span>( <span class="fu">grep</span>( <span class="st">&quot;carcom12&quot;</span> , data_files , <span class="at">value =</span> <span class="cn">TRUE</span> ) )</span>
<span id="cb238-22"><a href="3.5-zenga-index-svyzenga.html#cb238-22" aria-hidden="true" tabindex="-1"></a>cns.df <span class="ot">&lt;-</span> <span class="fu">read.csv</span>( <span class="fu">grep</span>( <span class="st">&quot;risfam12&quot;</span> , data_files , <span class="at">value =</span> <span class="cn">TRUE</span> ) )</span>
<span id="cb238-23"><a href="3.5-zenga-index-svyzenga.html#cb238-23" aria-hidden="true" tabindex="-1"></a>inc.df <span class="ot">&lt;-</span> <span class="fu">read.csv</span>( <span class="fu">grep</span>( <span class="st">&quot;rper12&quot;</span> , data_files , <span class="at">value =</span> <span class="cn">TRUE</span> ) )</span>
<span id="cb238-24"><a href="3.5-zenga-index-svyzenga.html#cb238-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-25"><a href="3.5-zenga-index-svyzenga.html#cb238-25" aria-hidden="true" tabindex="-1"></a><span class="co"># fixes names</span></span>
<span id="cb238-26"><a href="3.5-zenga-index-svyzenga.html#cb238-26" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>( cns.df )[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">tolower</span>( <span class="fu">colnames</span>( cns.df ) )[<span class="dv">1</span>]</span>
<span id="cb238-27"><a href="3.5-zenga-index-svyzenga.html#cb238-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-28"><a href="3.5-zenga-index-svyzenga.html#cb238-28" aria-hidden="true" tabindex="-1"></a><span class="co"># household count should be 8151</span></span>
<span id="cb238-29"><a href="3.5-zenga-index-svyzenga.html#cb238-29" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>( <span class="fu">sum</span>( <span class="sc">!</span><span class="fu">duplicated</span>( hhr.df<span class="sc">$</span>nquest ) ) <span class="sc">==</span> <span class="dv">8151</span> )</span>
<span id="cb238-30"><a href="3.5-zenga-index-svyzenga.html#cb238-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-31"><a href="3.5-zenga-index-svyzenga.html#cb238-31" aria-hidden="true" tabindex="-1"></a><span class="co"># person count should be 20022</span></span>
<span id="cb238-32"><a href="3.5-zenga-index-svyzenga.html#cb238-32" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>( <span class="fu">sum</span>( <span class="sc">!</span><span class="fu">duplicated</span>( <span class="fu">paste0</span>( hhr.df<span class="sc">$</span>nquest , <span class="st">&quot;-&quot;</span> , hhr.df<span class="sc">$</span>nord ) ) ) <span class="sc">==</span> <span class="dv">20022</span> )</span>
<span id="cb238-33"><a href="3.5-zenga-index-svyzenga.html#cb238-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-34"><a href="3.5-zenga-index-svyzenga.html#cb238-34" aria-hidden="true" tabindex="-1"></a><span class="co"># income recipients: should be 12986</span></span>
<span id="cb238-35"><a href="3.5-zenga-index-svyzenga.html#cb238-35" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>( <span class="fu">sum</span>( hhr.df<span class="sc">$</span>PERC ) <span class="sc">==</span> <span class="dv">12986</span> )</span>
<span id="cb238-36"><a href="3.5-zenga-index-svyzenga.html#cb238-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-37"><a href="3.5-zenga-index-svyzenga.html#cb238-37" aria-hidden="true" tabindex="-1"></a><span class="co"># combine household roster and income datasets</span></span>
<span id="cb238-38"><a href="3.5-zenga-index-svyzenga.html#cb238-38" aria-hidden="true" tabindex="-1"></a>pop.df <span class="ot">&lt;-</span> </span>
<span id="cb238-39"><a href="3.5-zenga-index-svyzenga.html#cb238-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">merge</span>( </span>
<span id="cb238-40"><a href="3.5-zenga-index-svyzenga.html#cb238-40" aria-hidden="true" tabindex="-1"></a>        hhr.df , </span>
<span id="cb238-41"><a href="3.5-zenga-index-svyzenga.html#cb238-41" aria-hidden="true" tabindex="-1"></a>        inc.df , </span>
<span id="cb238-42"><a href="3.5-zenga-index-svyzenga.html#cb238-42" aria-hidden="true" tabindex="-1"></a>        <span class="at">by =</span> <span class="fu">c</span>( <span class="st">&quot;nquest&quot;</span> ,<span class="st">&quot;nord&quot;</span> ) , </span>
<span id="cb238-43"><a href="3.5-zenga-index-svyzenga.html#cb238-43" aria-hidden="true" tabindex="-1"></a>        <span class="at">all.x =</span> <span class="cn">TRUE</span> , </span>
<span id="cb238-44"><a href="3.5-zenga-index-svyzenga.html#cb238-44" aria-hidden="true" tabindex="-1"></a>        <span class="at">sort =</span> <span class="cn">FALSE</span> </span>
<span id="cb238-45"><a href="3.5-zenga-index-svyzenga.html#cb238-45" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb238-46"><a href="3.5-zenga-index-svyzenga.html#cb238-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-47"><a href="3.5-zenga-index-svyzenga.html#cb238-47" aria-hidden="true" tabindex="-1"></a><span class="co"># compute household-level income</span></span>
<span id="cb238-48"><a href="3.5-zenga-index-svyzenga.html#cb238-48" aria-hidden="true" tabindex="-1"></a>hinc.df <span class="ot">&lt;-</span> </span>
<span id="cb238-49"><a href="3.5-zenga-index-svyzenga.html#cb238-49" aria-hidden="true" tabindex="-1"></a>    pop.df[ </span>
<span id="cb238-50"><a href="3.5-zenga-index-svyzenga.html#cb238-50" aria-hidden="true" tabindex="-1"></a>        pop.df<span class="sc">$</span>PERC <span class="sc">==</span> <span class="dv">1</span> , </span>
<span id="cb238-51"><a href="3.5-zenga-index-svyzenga.html#cb238-51" aria-hidden="true" tabindex="-1"></a>        <span class="fu">c</span>( <span class="st">&quot;nquest&quot;</span> , <span class="st">&quot;nord&quot;</span> , <span class="st">&quot;PERC&quot;</span> , <span class="st">&quot;Y&quot;</span> , <span class="st">&quot;YL&quot;</span> , <span class="st">&quot;YM&quot;</span> , <span class="st">&quot;YT&quot;</span> , <span class="st">&quot;YC&quot;</span> ) , </span>
<span id="cb238-52"><a href="3.5-zenga-index-svyzenga.html#cb238-52" aria-hidden="true" tabindex="-1"></a>        drop <span class="ot">=</span> <span class="cn">FALSE</span> </span>
<span id="cb238-53"><a href="3.5-zenga-index-svyzenga.html#cb238-53" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb238-54"><a href="3.5-zenga-index-svyzenga.html#cb238-54" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb238-55"><a href="3.5-zenga-index-svyzenga.html#cb238-55" aria-hidden="true" tabindex="-1"></a>hinc.df <span class="ot">&lt;-</span> </span>
<span id="cb238-56"><a href="3.5-zenga-index-svyzenga.html#cb238-56" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aggregate</span>( </span>
<span id="cb238-57"><a href="3.5-zenga-index-svyzenga.html#cb238-57" aria-hidden="true" tabindex="-1"></a>        <span class="fu">rowSums</span>( </span>
<span id="cb238-58"><a href="3.5-zenga-index-svyzenga.html#cb238-58" aria-hidden="true" tabindex="-1"></a>            hinc.df[ , <span class="fu">c</span>( <span class="st">&quot;YL&quot;</span>  , <span class="st">&quot;YM&quot;</span> , <span class="st">&quot;YT&quot;</span>  ) , <span class="at">drop =</span> <span class="cn">FALSE</span> ] </span>
<span id="cb238-59"><a href="3.5-zenga-index-svyzenga.html#cb238-59" aria-hidden="true" tabindex="-1"></a>        ) , </span>
<span id="cb238-60"><a href="3.5-zenga-index-svyzenga.html#cb238-60" aria-hidden="true" tabindex="-1"></a>        <span class="fu">list</span>( <span class="st">&quot;nquest&quot;</span> <span class="ot">=</span> hinc.df<span class="sc">$</span>nquest ) , </span>
<span id="cb238-61"><a href="3.5-zenga-index-svyzenga.html#cb238-61" aria-hidden="true" tabindex="-1"></a>        sum , </span>
<span id="cb238-62"><a href="3.5-zenga-index-svyzenga.html#cb238-62" aria-hidden="true" tabindex="-1"></a>        <span class="at">na.rm =</span> <span class="cn">TRUE</span> </span>
<span id="cb238-63"><a href="3.5-zenga-index-svyzenga.html#cb238-63" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb238-64"><a href="3.5-zenga-index-svyzenga.html#cb238-64" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb238-65"><a href="3.5-zenga-index-svyzenga.html#cb238-65" aria-hidden="true" tabindex="-1"></a>pop.df <span class="ot">&lt;-</span> </span>
<span id="cb238-66"><a href="3.5-zenga-index-svyzenga.html#cb238-66" aria-hidden="true" tabindex="-1"></a>    <span class="fu">merge</span>( </span>
<span id="cb238-67"><a href="3.5-zenga-index-svyzenga.html#cb238-67" aria-hidden="true" tabindex="-1"></a>        pop.df , </span>
<span id="cb238-68"><a href="3.5-zenga-index-svyzenga.html#cb238-68" aria-hidden="true" tabindex="-1"></a>        hinc.df , </span>
<span id="cb238-69"><a href="3.5-zenga-index-svyzenga.html#cb238-69" aria-hidden="true" tabindex="-1"></a>        <span class="at">by =</span> <span class="st">&quot;nquest&quot;</span> , </span>
<span id="cb238-70"><a href="3.5-zenga-index-svyzenga.html#cb238-70" aria-hidden="true" tabindex="-1"></a>        <span class="at">all.x =</span> <span class="cn">TRUE</span> , </span>
<span id="cb238-71"><a href="3.5-zenga-index-svyzenga.html#cb238-71" aria-hidden="true" tabindex="-1"></a>        <span class="at">sort =</span> <span class="cn">FALSE</span> </span>
<span id="cb238-72"><a href="3.5-zenga-index-svyzenga.html#cb238-72" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb238-73"><a href="3.5-zenga-index-svyzenga.html#cb238-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-74"><a href="3.5-zenga-index-svyzenga.html#cb238-74" aria-hidden="true" tabindex="-1"></a><span class="co"># combine with consumption data</span></span>
<span id="cb238-75"><a href="3.5-zenga-index-svyzenga.html#cb238-75" aria-hidden="true" tabindex="-1"></a>pop.df <span class="ot">&lt;-</span> </span>
<span id="cb238-76"><a href="3.5-zenga-index-svyzenga.html#cb238-76" aria-hidden="true" tabindex="-1"></a>    <span class="fu">merge</span>( </span>
<span id="cb238-77"><a href="3.5-zenga-index-svyzenga.html#cb238-77" aria-hidden="true" tabindex="-1"></a>        pop.df , </span>
<span id="cb238-78"><a href="3.5-zenga-index-svyzenga.html#cb238-78" aria-hidden="true" tabindex="-1"></a>        cns.df , </span>
<span id="cb238-79"><a href="3.5-zenga-index-svyzenga.html#cb238-79" aria-hidden="true" tabindex="-1"></a>        <span class="at">by =</span> <span class="st">&quot;nquest&quot;</span> , </span>
<span id="cb238-80"><a href="3.5-zenga-index-svyzenga.html#cb238-80" aria-hidden="true" tabindex="-1"></a>        <span class="at">all.x =</span> <span class="cn">TRUE</span> , </span>
<span id="cb238-81"><a href="3.5-zenga-index-svyzenga.html#cb238-81" aria-hidden="true" tabindex="-1"></a>        <span class="at">sort =</span> <span class="cn">FALSE</span> </span>
<span id="cb238-82"><a href="3.5-zenga-index-svyzenga.html#cb238-82" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb238-83"><a href="3.5-zenga-index-svyzenga.html#cb238-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-84"><a href="3.5-zenga-index-svyzenga.html#cb238-84" aria-hidden="true" tabindex="-1"></a><span class="co"># treat household-level sample as the finite population</span></span>
<span id="cb238-85"><a href="3.5-zenga-index-svyzenga.html#cb238-85" aria-hidden="true" tabindex="-1"></a>pop.df <span class="ot">&lt;-</span> </span>
<span id="cb238-86"><a href="3.5-zenga-index-svyzenga.html#cb238-86" aria-hidden="true" tabindex="-1"></a>    pop.df[ <span class="sc">!</span><span class="fu">duplicated</span>( pop.df<span class="sc">$</span>nquest ) , , drop <span class="ot">=</span> <span class="cn">FALSE</span> ]</span></code></pre></div>
<p>For the Monte Carlo experiment, we take <code>5000</code> samples of (expected) size <code>1000</code> using Poisson sampling (but not Conditional Poisson Sampling) and estimate the Zenga index using each sample:</p>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb239-1"><a href="3.5-zenga-index-svyzenga.html#cb239-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set up monte carlo attributes</span></span>
<span id="cb239-2"><a href="3.5-zenga-index-svyzenga.html#cb239-2" aria-hidden="true" tabindex="-1"></a>MC.reps <span class="ot">&lt;-</span> 5000L</span>
<span id="cb239-3"><a href="3.5-zenga-index-svyzenga.html#cb239-3" aria-hidden="true" tabindex="-1"></a>n.size <span class="ot">=</span> 1000L</span>
<span id="cb239-4"><a href="3.5-zenga-index-svyzenga.html#cb239-4" aria-hidden="true" tabindex="-1"></a>N.size <span class="ot">=</span> <span class="fu">nrow</span>( pop.df )</span>
<span id="cb239-5"><a href="3.5-zenga-index-svyzenga.html#cb239-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb239-6"><a href="3.5-zenga-index-svyzenga.html#cb239-6" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate first order probabilities</span></span>
<span id="cb239-7"><a href="3.5-zenga-index-svyzenga.html#cb239-7" aria-hidden="true" tabindex="-1"></a>pop.df<span class="sc">$</span>pik <span class="ot">&lt;-</span></span>
<span id="cb239-8"><a href="3.5-zenga-index-svyzenga.html#cb239-8" aria-hidden="true" tabindex="-1"></a>    n.size <span class="sc">*</span> ( <span class="fu">abs</span>( pop.df<span class="sc">$</span>C ) <span class="sc">/</span> <span class="fu">sum</span>( <span class="fu">abs</span>( pop.df<span class="sc">$</span>C ) ) )</span>
<span id="cb239-9"><a href="3.5-zenga-index-svyzenga.html#cb239-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb239-10"><a href="3.5-zenga-index-svyzenga.html#cb239-10" aria-hidden="true" tabindex="-1"></a><span class="co"># note: if any elements are not between zero and one</span></span>
<span id="cb239-11"><a href="3.5-zenga-index-svyzenga.html#cb239-11" aria-hidden="true" tabindex="-1"></a><span class="co"># use the `inclusionprobabilities()` function</span></span>
<span id="cb239-12"><a href="3.5-zenga-index-svyzenga.html#cb239-12" aria-hidden="true" tabindex="-1"></a><span class="co"># library(sampling)</span></span>
<span id="cb239-13"><a href="3.5-zenga-index-svyzenga.html#cb239-13" aria-hidden="true" tabindex="-1"></a><span class="co"># pop.df$pik &lt;-</span></span>
<span id="cb239-14"><a href="3.5-zenga-index-svyzenga.html#cb239-14" aria-hidden="true" tabindex="-1"></a><span class="co">#   inclusionprobabilities( abs( pop.df$C ) , n.size )</span></span>
<span id="cb239-15"><a href="3.5-zenga-index-svyzenga.html#cb239-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb239-16"><a href="3.5-zenga-index-svyzenga.html#cb239-16" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate second order probabilities</span></span>
<span id="cb239-17"><a href="3.5-zenga-index-svyzenga.html#cb239-17" aria-hidden="true" tabindex="-1"></a>pikl <span class="ot">&lt;-</span> pop.df<span class="sc">$</span>pik <span class="sc">%*%</span> <span class="fu">t</span>( pop.df<span class="sc">$</span>pik )</span>
<span id="cb239-18"><a href="3.5-zenga-index-svyzenga.html#cb239-18" aria-hidden="true" tabindex="-1"></a><span class="fu">diag</span>( pikl ) <span class="ot">&lt;-</span> pop.df<span class="sc">$</span>pik </span>
<span id="cb239-19"><a href="3.5-zenga-index-svyzenga.html#cb239-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb239-20"><a href="3.5-zenga-index-svyzenga.html#cb239-20" aria-hidden="true" tabindex="-1"></a><span class="co"># set random number seed</span></span>
<span id="cb239-21"><a href="3.5-zenga-index-svyzenga.html#cb239-21" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>( <span class="dv">1997</span> )</span>
<span id="cb239-22"><a href="3.5-zenga-index-svyzenga.html#cb239-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb239-23"><a href="3.5-zenga-index-svyzenga.html#cb239-23" aria-hidden="true" tabindex="-1"></a><span class="co"># create list of survey design objects</span></span>
<span id="cb239-24"><a href="3.5-zenga-index-svyzenga.html#cb239-24" aria-hidden="true" tabindex="-1"></a><span class="co"># using poisson sampling</span></span>
<span id="cb239-25"><a href="3.5-zenga-index-svyzenga.html#cb239-25" aria-hidden="true" tabindex="-1"></a>survey.list <span class="ot">&lt;-</span> </span>
<span id="cb239-26"><a href="3.5-zenga-index-svyzenga.html#cb239-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lapply</span>( </span>
<span id="cb239-27"><a href="3.5-zenga-index-svyzenga.html#cb239-27" aria-hidden="true" tabindex="-1"></a>        <span class="fu">seq_len</span>( MC.reps ) , </span>
<span id="cb239-28"><a href="3.5-zenga-index-svyzenga.html#cb239-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">function</span>( this.rep ){</span>
<span id="cb239-29"><a href="3.5-zenga-index-svyzenga.html#cb239-29" aria-hidden="true" tabindex="-1"></a>            smp.ind <span class="ot">&lt;-</span> <span class="fu">which</span>( <span class="fu">runif</span>( N.size ) <span class="sc">&lt;=</span> pop.df<span class="sc">$</span>pik )</span>
<span id="cb239-30"><a href="3.5-zenga-index-svyzenga.html#cb239-30" aria-hidden="true" tabindex="-1"></a>            smp.df <span class="ot">&lt;-</span> pop.df[ smp.ind , , drop <span class="ot">=</span> <span class="cn">FALSE</span> ]</span>
<span id="cb239-31"><a href="3.5-zenga-index-svyzenga.html#cb239-31" aria-hidden="true" tabindex="-1"></a>            <span class="fu">svydesign</span>( </span>
<span id="cb239-32"><a href="3.5-zenga-index-svyzenga.html#cb239-32" aria-hidden="true" tabindex="-1"></a>                <span class="at">ids =</span> <span class="sc">~</span>nquest , </span>
<span id="cb239-33"><a href="3.5-zenga-index-svyzenga.html#cb239-33" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> smp.df , </span>
<span id="cb239-34"><a href="3.5-zenga-index-svyzenga.html#cb239-34" aria-hidden="true" tabindex="-1"></a>                <span class="at">fpc =</span> <span class="sc">~</span>pik , </span>
<span id="cb239-35"><a href="3.5-zenga-index-svyzenga.html#cb239-35" aria-hidden="true" tabindex="-1"></a>                <span class="at">nest =</span> <span class="cn">FALSE</span> , </span>
<span id="cb239-36"><a href="3.5-zenga-index-svyzenga.html#cb239-36" aria-hidden="true" tabindex="-1"></a>                <span class="at">pps =</span> <span class="fu">ppsmat</span>( pikl[ smp.ind , smp.ind ] ) , </span>
<span id="cb239-37"><a href="3.5-zenga-index-svyzenga.html#cb239-37" aria-hidden="true" tabindex="-1"></a>                <span class="at">variance =</span> <span class="st">&quot;HT&quot;</span> </span>
<span id="cb239-38"><a href="3.5-zenga-index-svyzenga.html#cb239-38" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb239-39"><a href="3.5-zenga-index-svyzenga.html#cb239-39" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb239-40"><a href="3.5-zenga-index-svyzenga.html#cb239-40" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb239-41"><a href="3.5-zenga-index-svyzenga.html#cb239-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb239-42"><a href="3.5-zenga-index-svyzenga.html#cb239-42" aria-hidden="true" tabindex="-1"></a><span class="co"># estimate zenga index for each sample</span></span>
<span id="cb239-43"><a href="3.5-zenga-index-svyzenga.html#cb239-43" aria-hidden="true" tabindex="-1"></a>estimate.list <span class="ot">&lt;-</span> </span>
<span id="cb239-44"><a href="3.5-zenga-index-svyzenga.html#cb239-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lapply</span>(</span>
<span id="cb239-45"><a href="3.5-zenga-index-svyzenga.html#cb239-45" aria-hidden="true" tabindex="-1"></a>        survey.list , </span>
<span id="cb239-46"><a href="3.5-zenga-index-svyzenga.html#cb239-46" aria-hidden="true" tabindex="-1"></a>        <span class="cf">function</span>( this.sample ){</span>
<span id="cb239-47"><a href="3.5-zenga-index-svyzenga.html#cb239-47" aria-hidden="true" tabindex="-1"></a>            <span class="fu">svyzenga</span>( </span>
<span id="cb239-48"><a href="3.5-zenga-index-svyzenga.html#cb239-48" aria-hidden="true" tabindex="-1"></a>                <span class="sc">~</span>x , </span>
<span id="cb239-49"><a href="3.5-zenga-index-svyzenga.html#cb239-49" aria-hidden="true" tabindex="-1"></a>                <span class="fu">subset</span>( this.sample , x <span class="sc">&gt;</span> <span class="dv">0</span> ) , </span>
<span id="cb239-50"><a href="3.5-zenga-index-svyzenga.html#cb239-50" aria-hidden="true" tabindex="-1"></a>                <span class="at">na.rm =</span> <span class="cn">TRUE</span> </span>
<span id="cb239-51"><a href="3.5-zenga-index-svyzenga.html#cb239-51" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb239-52"><a href="3.5-zenga-index-svyzenga.html#cb239-52" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb239-53"><a href="3.5-zenga-index-svyzenga.html#cb239-53" aria-hidden="true" tabindex="-1"></a>    )</span></code></pre></div>
<p>Then, we evaluate the Percentage Relative Bias (PRB) of the Zenga index estimator. Under this scenario, the PRB of the Zenga index estimator is 0.3397%, a result similar to the <code>0.321</code> shown in Table 2.</p>
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb240-1"><a href="3.5-zenga-index-svyzenga.html#cb240-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compute the (finite population) Zenga index parameter</span></span>
<span id="cb240-2"><a href="3.5-zenga-index-svyzenga.html#cb240-2" aria-hidden="true" tabindex="-1"></a>theta.pop <span class="ot">&lt;-</span> convey<span class="sc">:::</span><span class="fu">CalcZenga</span>( pop.df<span class="sc">$</span>x , <span class="fu">ifelse</span>( pop.df<span class="sc">$</span>x <span class="sc">&gt;</span> <span class="dv">0</span> , <span class="dv">1</span> , <span class="dv">0</span> ) )</span>
<span id="cb240-3"><a href="3.5-zenga-index-svyzenga.html#cb240-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-4"><a href="3.5-zenga-index-svyzenga.html#cb240-4" aria-hidden="true" tabindex="-1"></a><span class="co"># estimate the expected value of the Zenga index estimator</span></span>
<span id="cb240-5"><a href="3.5-zenga-index-svyzenga.html#cb240-5" aria-hidden="true" tabindex="-1"></a><span class="co"># using the average of the estimates</span></span>
<span id="cb240-6"><a href="3.5-zenga-index-svyzenga.html#cb240-6" aria-hidden="true" tabindex="-1"></a>theta.exp <span class="ot">&lt;-</span> <span class="fu">mean</span>( <span class="fu">sapply</span>( estimate.list , coef ) )</span>
<span id="cb240-7"><a href="3.5-zenga-index-svyzenga.html#cb240-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-8"><a href="3.5-zenga-index-svyzenga.html#cb240-8" aria-hidden="true" tabindex="-1"></a><span class="co"># estimate the percentage relative bias</span></span>
<span id="cb240-9"><a href="3.5-zenga-index-svyzenga.html#cb240-9" aria-hidden="true" tabindex="-1"></a><span class="dv">100</span> <span class="sc">*</span> ( theta.exp<span class="sc">/</span>theta.pop <span class="sc">-</span> <span class="dv">1</span> )</span></code></pre></div>
<pre><code>## [1] 0.3396837</code></pre>
<p>Then, we evaluate the PRB of the variance estimator of the Zenga index estimator. Under this scenario, the PRB of the Zenga index variance estimator is -0.4954%, another result similar to the <code>-0.600</code> shown in Table 2.</p>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb242-1"><a href="3.5-zenga-index-svyzenga.html#cb242-1" aria-hidden="true" tabindex="-1"></a><span class="co"># estimate the variance of the Zenga index estimator</span></span>
<span id="cb242-2"><a href="3.5-zenga-index-svyzenga.html#cb242-2" aria-hidden="true" tabindex="-1"></a><span class="co"># using the variance of the estimates</span></span>
<span id="cb242-3"><a href="3.5-zenga-index-svyzenga.html#cb242-3" aria-hidden="true" tabindex="-1"></a>( vartheta.popest <span class="ot">&lt;-</span> <span class="fu">var</span>( <span class="fu">sapply</span>( estimate.list , coef ) ) )</span></code></pre></div>
<pre><code>## [1] 9.47244e-05</code></pre>
<div class="sourceCode" id="cb244"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb244-1"><a href="3.5-zenga-index-svyzenga.html#cb244-1" aria-hidden="true" tabindex="-1"></a><span class="co"># estimate the expected value of the Zenga index variance estimator</span></span>
<span id="cb244-2"><a href="3.5-zenga-index-svyzenga.html#cb244-2" aria-hidden="true" tabindex="-1"></a><span class="co"># using the expected of the variance estimates</span></span>
<span id="cb244-3"><a href="3.5-zenga-index-svyzenga.html#cb244-3" aria-hidden="true" tabindex="-1"></a>( vartheta.exp <span class="ot">&lt;-</span> <span class="fu">mean</span>( <span class="fu">sapply</span>( estimate.list , vcov ) ) )</span></code></pre></div>
<pre><code>## [1] 9.425515e-05</code></pre>
<div class="sourceCode" id="cb246"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb246-1"><a href="3.5-zenga-index-svyzenga.html#cb246-1" aria-hidden="true" tabindex="-1"></a><span class="co"># estimate the percentage relative bias</span></span>
<span id="cb246-2"><a href="3.5-zenga-index-svyzenga.html#cb246-2" aria-hidden="true" tabindex="-1"></a><span class="dv">100</span> <span class="sc">*</span> ( vartheta.exp<span class="sc">/</span>vartheta.popest <span class="sc">-</span> <span class="dv">1</span> )</span></code></pre></div>
<pre><code>## [1] -0.4953863</code></pre>
<p>Next, we evaluate the Percentage Coverage Rate (PCR). In theory, under repeated sampling, the estimated 95% CIs should cover the population parameter 95% of the time. We can evaluate that using:</p>
<div class="sourceCode" id="cb248"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb248-1"><a href="3.5-zenga-index-svyzenga.html#cb248-1" aria-hidden="true" tabindex="-1"></a><span class="co"># estimate confidence intervals of the Zenga index</span></span>
<span id="cb248-2"><a href="3.5-zenga-index-svyzenga.html#cb248-2" aria-hidden="true" tabindex="-1"></a><span class="co"># for each of the samples</span></span>
<span id="cb248-3"><a href="3.5-zenga-index-svyzenga.html#cb248-3" aria-hidden="true" tabindex="-1"></a>est.cis <span class="ot">&lt;-</span> <span class="fu">t</span>( <span class="fu">sapply</span>( estimate.list, <span class="cf">function</span>( this.stat ) <span class="fu">c</span>( <span class="fu">confint</span>( this.stat ) ) ) ) </span>
<span id="cb248-4"><a href="3.5-zenga-index-svyzenga.html#cb248-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb248-5"><a href="3.5-zenga-index-svyzenga.html#cb248-5" aria-hidden="true" tabindex="-1"></a><span class="co"># evaluate</span></span>
<span id="cb248-6"><a href="3.5-zenga-index-svyzenga.html#cb248-6" aria-hidden="true" tabindex="-1"></a><span class="fu">prop.table</span>( <span class="fu">table</span>( ( theta.pop <span class="sc">&gt;</span> est.cis[,<span class="dv">1</span>] ) <span class="sc">&amp;</span> ( theta.pop <span class="sc">&lt;</span> est.cis[,<span class="dv">2</span>] ) ) )</span></code></pre></div>
<pre><code>## 
##  FALSE   TRUE 
## 0.0548 0.9452</code></pre>
<p>Our estimated 95% CIs cover the parameter 94.52% of the time, which is very close to the nominal rate and also similar to the <code>94.5</code> PCR shown in Table 2.</p>
</div>
<p style="text-align: center;">
<a href="3.4-gini-index-svygini.html"><button class="btn btn-default">Previous</button></a>
<a href="3.6-entropy-based-measures.html"><button class="btn btn-default">Next</button></a>
</p>
</div>
</div>



</body>
</html>
