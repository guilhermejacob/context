<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="1.4 The Current Population Survey (CPS) | Poverty and Inequality with Complex Survey Data" />
<meta property="og:type" content="book" />

<meta property="og:description" content="A book about the R convey package" />
<meta name="github-repo" content="guilhermejacob/context" />

<meta name="author" content="By Guilherme Jacob, Anthony Damico, and Djalma Pessoa. The authors received no external funding for the convey software and this accompanying textbook." />

<meta name="date" content="2023-11-04" />

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<meta name="description" content="A book about the R convey package">

<title>1.4 The Current Population Survey (CPS) | Poverty and Inequality with Complex Survey Data</title>

<link href="libs/tufte-css-2015.12.29/tufte-fonts.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte-background.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte-italics.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte.css" rel="stylesheet" />


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="toc.css" type="text/css" />

</head>

<body>



<div class="row">
<div class="col-sm-12">
<div id="TOC">
<ul>
<li class="has-sub"><a href="index.html#intro" id="toc-intro"><span class="toc-section-number">1</span> Intro</a>
<ul>
<li><a href="1.1-install.html#install" id="toc-install"><span class="toc-section-number">1.1</span> Installation</a></li>
<li><a href="1.2-survey.html#survey" id="toc-survey"><span class="toc-section-number">1.2</span> Complex surveys and statistical inference</a></li>
<li><a href="1.3-usage-examples.html#usage-examples" id="toc-usage-examples"><span class="toc-section-number">1.3</span> Usage Examples</a></li>
<li class="has-sub"><a href="1.4-the-current-population-survey-cps.html#the-current-population-survey-cps" id="toc-the-current-population-survey-cps"><span class="toc-section-number">1.4</span> The Current Population Survey (CPS)</a>
<ul>
<li><a href="1.4-the-current-population-survey-cps.html#household-level-analysis-of-the-cps" id="toc-household-level-analysis-of-the-cps"><span class="toc-section-number">1.4.1</span> Household-level Analysis of the CPS</a></li>
<li><a href="1.4-the-current-population-survey-cps.html#family-level-analysis-of-the-cps" id="toc-family-level-analysis-of-the-cps"><span class="toc-section-number">1.4.2</span> Family-level Analysis of the CPS</a></li>
<li><a href="1.4-the-current-population-survey-cps.html#full-time-full-year-worker-analysis-of-the-cps" id="toc-full-time-full-year-worker-analysis-of-the-cps"><span class="toc-section-number">1.4.3</span> Full-time Full Year Worker Analysis of the CPS</a></li>
</ul></li>
</ul></li>
<li class="has-sub"><a href="2-var.html#var" id="toc-var"><span class="toc-section-number">2</span> Variance Estimation</a>
<ul>
<li class="has-sub"><a href="2.1-lin.html#lin" id="toc-lin"><span class="toc-section-number">2.1</span> Linearization-Based Variance Estimation</a>
<ul>
<li><a href="2.1-lin.html#influence-functions" id="toc-influence-functions"><span class="toc-section-number">2.1.1</span> Influence Functions</a></li>
</ul></li>
<li class="has-sub"><a href="2.2-replication-based-variance-estimation.html#replication-based-variance-estimation" id="toc-replication-based-variance-estimation"><span class="toc-section-number">2.2</span> Replication-Based Variance Estimation</a>
<ul>
<li><a href="2.2-replication-based-variance-estimation.html#replication-design-example" id="toc-replication-design-example"><span class="toc-section-number">2.2.1</span> Replication Design Example</a></li>
</ul></li>
<li><a href="2.3-variance-estimation-for-decompositions.html#variance-estimation-for-decompositions" id="toc-variance-estimation-for-decompositions"><span class="toc-section-number">2.3</span> Variance Estimation for Decompositions</a></li>
</ul></li>
<li class="has-sub"><a href="3-poverty.html#poverty" id="toc-poverty"><span class="toc-section-number">3</span> Poverty Indices</a>
<ul>
<li class="has-sub"><a href="3.1-at-risk-of-poverty-threshold-svyarpt.html#at-risk-of-poverty-threshold-svyarpt" id="toc-at-risk-of-poverty-threshold-svyarpt"><span class="toc-section-number">3.1</span> At Risk of Poverty Threshold (svyarpt)</a>
<ul>
<li><a href="3.1-at-risk-of-poverty-threshold-svyarpt.html#replication-example" id="toc-replication-example"><span class="toc-section-number">3.1.1</span> Replication Example</a></li>
</ul></li>
<li class="has-sub"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#at-risk-of-poverty-ratio-svyarpr" id="toc-at-risk-of-poverty-ratio-svyarpr"><span class="toc-section-number">3.2</span> At Risk of Poverty Ratio (svyarpr)</a>
<ul>
<li><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#replication-example-1" id="toc-replication-example-1"><span class="toc-section-number">3.2.1</span> Replication Example</a></li>
</ul></li>
<li class="has-sub"><a href="3.3-relative-median-income-ratio-svyrmir.html#relative-median-income-ratio-svyrmir" id="toc-relative-median-income-ratio-svyrmir"><span class="toc-section-number">3.3</span> Relative Median Income Ratio (svyrmir)</a>
<ul>
<li><a href="3.3-relative-median-income-ratio-svyrmir.html#replication-example-2" id="toc-replication-example-2"><span class="toc-section-number">3.3.1</span> Replication Example</a></li>
</ul></li>
<li class="has-sub"><a href="3.4-relative-median-poverty-gap-svyrmpg.html#relative-median-poverty-gap-svyrmpg" id="toc-relative-median-poverty-gap-svyrmpg"><span class="toc-section-number">3.4</span> Relative Median Poverty Gap (svyrmpg)</a>
<ul>
<li><a href="3.4-relative-median-poverty-gap-svyrmpg.html#replication-example-3" id="toc-replication-example-3"><span class="toc-section-number">3.4.1</span> Replication Example</a></li>
</ul></li>
<li class="has-sub"><a href="3.5-median-income-below-the-at-risk-of-poverty-threshold-svypoormed.html#median-income-below-the-at-risk-of-poverty-threshold-svypoormed" id="toc-median-income-below-the-at-risk-of-poverty-threshold-svypoormed"><span class="toc-section-number">3.5</span> Median Income Below the At Risk of Poverty Threshold (svypoormed)</a>
<ul>
<li><a href="3.5-median-income-below-the-at-risk-of-poverty-threshold-svypoormed.html#replication-example-4" id="toc-replication-example-4"><span class="toc-section-number">3.5.1</span> Replication Example</a></li>
</ul></li>
<li class="has-sub"><a href="3.6-foster-greer-thorbecke-class-svyfgt-svyfgtdec.html#foster-greer-thorbecke-class-svyfgt-svyfgtdec" id="toc-foster-greer-thorbecke-class-svyfgt-svyfgtdec"><span class="toc-section-number">3.6</span> Foster-Greer-Thorbecke class (svyfgt, svyfgtdec)</a>
<ul>
<li><a href="3.6-foster-greer-thorbecke-class-svyfgt-svyfgtdec.html#replication-example-5" id="toc-replication-example-5"><span class="toc-section-number">3.6.1</span> Replication Example</a></li>
<li><a href="3.6-foster-greer-thorbecke-class-svyfgt-svyfgtdec.html#monte-carlo-simulation" id="toc-monte-carlo-simulation"><span class="toc-section-number">3.6.2</span> Monte Carlo Simulation</a></li>
</ul></li>
<li class="has-sub"><a href="3.7-watts-poverty-measure-svywatts-svywattsdec.html#watts-poverty-measure-svywatts-svywattsdec" id="toc-watts-poverty-measure-svywatts-svywattsdec"><span class="toc-section-number">3.7</span> Watts poverty measure (svywatts, svywattsdec)</a>
<ul>
<li><a href="3.7-watts-poverty-measure-svywatts-svywattsdec.html#monte-carlo-simulation-1" id="toc-monte-carlo-simulation-1"><span class="toc-section-number">3.7.1</span> Monte Carlo Simulation</a></li>
</ul></li>
</ul></li>
<li class="has-sub"><a href="4-inequality.html#inequality" id="toc-inequality"><span class="toc-section-number">4</span> Inequality Measurement</a>
<ul>
<li><a href="4.1-which-inequality-measure-should-be-used.html#which-inequality-measure-should-be-used" id="toc-which-inequality-measure-should-be-used"><span class="toc-section-number">4.1</span> Which inequality measure should be used?</a></li>
<li class="has-sub"><a href="4.2-the-gender-pay-gap-svygpg.html#the-gender-pay-gap-svygpg" id="toc-the-gender-pay-gap-svygpg"><span class="toc-section-number">4.2</span> The Gender Pay Gap (svygpg)</a>
<ul>
<li><a href="4.2-the-gender-pay-gap-svygpg.html#replication-example-6" id="toc-replication-example-6"><span class="toc-section-number">4.2.1</span> Replication Example</a></li>
</ul></li>
<li class="has-sub"><a href="4.3-quintile-share-ratio-svyqsr.html#quintile-share-ratio-svyqsr" id="toc-quintile-share-ratio-svyqsr"><span class="toc-section-number">4.3</span> Quintile Share Ratio (svyqsr)</a>
<ul>
<li><a href="4.3-quintile-share-ratio-svyqsr.html#replication-example-7" id="toc-replication-example-7"><span class="toc-section-number">4.3.1</span> Replication Example</a></li>
</ul></li>
<li><a href="4.4-lorenz-curve-based-measures.html#lorenz-curve-based-measures" id="toc-lorenz-curve-based-measures"><span class="toc-section-number">4.4</span> Lorenz Curve-based Measures</a></li>
<li class="has-sub"><a href="4.5-lorenz-curve-svylorenz.html#lorenz-curve-svylorenz" id="toc-lorenz-curve-svylorenz"><span class="toc-section-number">4.5</span> Lorenz Curve (svylorenz)</a>
<ul>
<li><a href="4.5-lorenz-curve-svylorenz.html#replication-example-8" id="toc-replication-example-8"><span class="toc-section-number">4.5.1</span> Replication Example</a></li>
</ul></li>
<li class="has-sub"><a href="4.6-gini-index-svygini.html#gini-index-svygini" id="toc-gini-index-svygini"><span class="toc-section-number">4.6</span> Gini index (svygini)</a>
<ul>
<li><a href="4.6-gini-index-svygini.html#replication-example-9" id="toc-replication-example-9"><span class="toc-section-number">4.6.1</span> Replication Example</a></li>
</ul></li>
<li class="has-sub"><a href="4.7-zenga-index-svyzenga.html#zenga-index-svyzenga" id="toc-zenga-index-svyzenga"><span class="toc-section-number">4.7</span> Zenga index (svyzenga)</a>
<ul>
<li><a href="4.7-zenga-index-svyzenga.html#replication-example-10" id="toc-replication-example-10"><span class="toc-section-number">4.7.1</span> Replication Example</a></li>
</ul></li>
<li><a href="4.8-social-welfare-function-based-measures.html#social-welfare-function-based-measures" id="toc-social-welfare-function-based-measures"><span class="toc-section-number">4.8</span> Social Welfare Function-based Measures</a></li>
<li class="has-sub"><a href="4.9-atkinson-index-svyatk.html#atkinson-index-svyatk" id="toc-atkinson-index-svyatk"><span class="toc-section-number">4.9</span> Atkinson index (svyatk)</a>
<ul>
<li><a href="4.9-atkinson-index-svyatk.html#replication-example-11" id="toc-replication-example-11"><span class="toc-section-number">4.9.1</span> Replication Example</a></li>
</ul></li>
<li><a href="4.10-entropy-based-measures.html#entropy-based-measures" id="toc-entropy-based-measures"><span class="toc-section-number">4.10</span> Entropy-based Measures</a></li>
<li class="has-sub"><a href="4.11-generalized-entropy-and-decomposition-svygei-svygeidec.html#generalized-entropy-and-decomposition-svygei-svygeidec" id="toc-generalized-entropy-and-decomposition-svygei-svygeidec"><span class="toc-section-number">4.11</span> Generalized Entropy and Decomposition (svygei, svygeidec)</a>
<ul>
<li><a href="4.11-generalized-entropy-and-decomposition-svygei-svygeidec.html#replication-example-12" id="toc-replication-example-12"><span class="toc-section-number">4.11.1</span> Replication Example</a></li>
</ul></li>
<li class="has-sub"><a href="4.12-j-divergence-and-decomposition-svyjdiv-svyjdivdec.html#j-divergence-and-decomposition-svyjdiv-svyjdivdec" id="toc-j-divergence-and-decomposition-svyjdiv-svyjdivdec"><span class="toc-section-number">4.12</span> J-Divergence and Decomposition (svyjdiv, svyjdivdec)</a>
<ul>
<li><a href="4.12-j-divergence-and-decomposition-svyjdiv-svyjdivdec.html#monte-carlo-simulation-2" id="toc-monte-carlo-simulation-2"><span class="toc-section-number">4.12.1</span> Monte Carlo Simulation</a></li>
</ul></li>
</ul></li>
<li class="has-sub"><a href="5-richness.html#richness" id="toc-richness"><span class="toc-section-number">5</span> Richness</a>
<ul>
<li class="has-sub"><a href="5.1-richness-measures-svyrich.html#richness-measures-svyrich" id="toc-richness-measures-svyrich"><span class="toc-section-number">5.1</span> Richness Measures (svyrich)</a>
<ul>
<li><a href="5.1-richness-measures-svyrich.html#monte-carlo-simulation-3" id="toc-monte-carlo-simulation-3"><span class="toc-section-number">5.1.1</span> Monte Carlo Simulation</a></li>
</ul></li>
</ul></li>
<li class="has-sub"><a href="6-multidimensional-poverty.html#multidimensional-poverty" id="toc-multidimensional-poverty"><span class="toc-section-number">6</span> Multidimensional Poverty</a>
<ul>
<li><a href="6.1-example-calculation.html#example-calculation" id="toc-example-calculation"><span class="toc-section-number">6.1</span> Example Calculation</a></li>
</ul></li>
<li class="has-sub"><a href="7-covariance-matrix.html#covariance-matrix" id="toc-covariance-matrix"><span class="toc-section-number">7</span> Covariance Matrix</a>
<ul>
<li><a href="7.1-example-calculation-1.html#example-calculation-1" id="toc-example-calculation-1"><span class="toc-section-number">7.1</span> Example Calculation</a></li>
</ul></li>
</ul>
</div>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<div id="the-current-population-survey-cps" class="section level2" number="1.4">
<h2><span class="header-section-number">1.4</span> The Current Population Survey (CPS)</h2>
<p>Sponsored jointly by the U.S. Census Bureau and the U.S. Bureau of Labor Statistics (BLS), the Current Population Survey is the primary source of labor force statistics for the population of the United States.</p>
<p>This section downloads, imports, and prepares the most current microdata for analysis.</p>
<p>Download and unzip the 2023 file:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="1.4-the-current-population-survey-cps.html#cb27-1" tabindex="-1"></a><span class="fu">library</span>(httr)</span>
<span id="cb27-2"><a href="1.4-the-current-population-survey-cps.html#cb27-2" tabindex="-1"></a></span>
<span id="cb27-3"><a href="1.4-the-current-population-survey-cps.html#cb27-3" tabindex="-1"></a>tf <span class="ot">&lt;-</span> <span class="fu">tempfile</span>()</span>
<span id="cb27-4"><a href="1.4-the-current-population-survey-cps.html#cb27-4" tabindex="-1"></a></span>
<span id="cb27-5"><a href="1.4-the-current-population-survey-cps.html#cb27-5" tabindex="-1"></a>this_url <span class="ot">&lt;-</span></span>
<span id="cb27-6"><a href="1.4-the-current-population-survey-cps.html#cb27-6" tabindex="-1"></a>  <span class="st">&quot;https://www2.census.gov/programs-surveys/cps/datasets/2023/march/asecpub23sas.zip&quot;</span></span>
<span id="cb27-7"><a href="1.4-the-current-population-survey-cps.html#cb27-7" tabindex="-1"></a></span>
<span id="cb27-8"><a href="1.4-the-current-population-survey-cps.html#cb27-8" tabindex="-1"></a><span class="fu">GET</span>(this_url , <span class="fu">write_disk</span>(tf) , <span class="fu">progress</span>())</span></code></pre></div>
<pre><code>## 
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |                                                                      |   1%
  |                                                                            
  |=                                                                     |   1%
  |                                                                            
  |=                                                                     |   2%
  |                                                                            
  |==                                                                    |   2%
  |                                                                            
  |==                                                                    |   3%
  |                                                                            
  |===                                                                   |   4%
  |                                                                            
  |===                                                                   |   5%
  |                                                                            
  |====                                                                  |   6%
  |                                                                            
  |=====                                                                 |   6%
  |                                                                            
  |=====                                                                 |   7%
  |                                                                            
  |=====                                                                 |   8%
  |                                                                            
  |======                                                                |   8%
  |                                                                            
  |======                                                                |   9%
  |                                                                            
  |=======                                                               |   9%
  |                                                                            
  |=======                                                               |  10%
  |                                                                            
  |========                                                              |  11%
  |                                                                            
  |========                                                              |  12%
  |                                                                            
  |=========                                                             |  12%
  |                                                                            
  |=========                                                             |  13%
  |                                                                            
  |=========                                                             |  14%
  |                                                                            
  |==========                                                            |  14%
  |                                                                            
  |==========                                                            |  15%
  |                                                                            
  |===========                                                           |  15%
  |                                                                            
  |===========                                                           |  16%
  |                                                                            
  |============                                                          |  16%
  |                                                                            
  |============                                                          |  17%
  |                                                                            
  |============                                                          |  18%
  |                                                                            
  |=============                                                         |  18%
  |                                                                            
  |=============                                                         |  19%
  |                                                                            
  |==============                                                        |  19%
  |                                                                            
  |==============                                                        |  20%
  |                                                                            
  |==============                                                        |  21%
  |                                                                            
  |===============                                                       |  21%
  |                                                                            
  |===============                                                       |  22%
  |                                                                            
  |================                                                      |  22%
  |                                                                            
  |================                                                      |  23%
  |                                                                            
  |=================                                                     |  24%
  |                                                                            
  |=================                                                     |  25%
  |                                                                            
  |==================                                                    |  25%
  |                                                                            
  |==================                                                    |  26%
  |                                                                            
  |===================                                                   |  26%
  |                                                                            
  |===================                                                   |  27%
  |                                                                            
  |===================                                                   |  28%
  |                                                                            
  |====================                                                  |  28%
  |                                                                            
  |====================                                                  |  29%
  |                                                                            
  |=====================                                                 |  29%
  |                                                                            
  |=====================                                                 |  30%
  |                                                                            
  |=====================                                                 |  31%
  |                                                                            
  |======================                                                |  31%
  |                                                                            
  |======================                                                |  32%
  |                                                                            
  |=======================                                               |  32%
  |                                                                            
  |=======================                                               |  33%
  |                                                                            
  |=======================                                               |  34%
  |                                                                            
  |========================                                              |  34%
  |                                                                            
  |========================                                              |  35%
  |                                                                            
  |=========================                                             |  35%
  |                                                                            
  |=========================                                             |  36%
  |                                                                            
  |==========================                                            |  37%
  |                                                                            
  |==========================                                            |  38%
  |                                                                            
  |===========================                                           |  38%
  |                                                                            
  |===========================                                           |  39%
  |                                                                            
  |============================                                          |  39%
  |                                                                            
  |============================                                          |  40%
  |                                                                            
  |============================                                          |  41%
  |                                                                            
  |=============================                                         |  41%
  |                                                                            
  |=============================                                         |  42%
  |                                                                            
  |==============================                                        |  42%
  |                                                                            
  |==============================                                        |  43%
  |                                                                            
  |===============================                                       |  44%
  |                                                                            
  |===============================                                       |  45%
  |                                                                            
  |================================                                      |  45%
  |                                                                            
  |================================                                      |  46%
  |                                                                            
  |=================================                                     |  46%
  |                                                                            
  |=================================                                     |  47%
  |                                                                            
  |=================================                                     |  48%
  |                                                                            
  |==================================                                    |  48%
  |                                                                            
  |==================================                                    |  49%
  |                                                                            
  |===================================                                   |  49%
  |                                                                            
  |===================================                                   |  50%
  |                                                                            
  |===================================                                   |  51%
  |                                                                            
  |====================================                                  |  51%
  |                                                                            
  |====================================                                  |  52%
  |                                                                            
  |=====================================                                 |  52%
  |                                                                            
  |=====================================                                 |  53%
  |                                                                            
  |======================================                                |  54%
  |                                                                            
  |======================================                                |  55%
  |                                                                            
  |=======================================                               |  55%
  |                                                                            
  |=======================================                               |  56%
  |                                                                            
  |========================================                              |  56%
  |                                                                            
  |========================================                              |  57%
  |                                                                            
  |========================================                              |  58%
  |                                                                            
  |=========================================                             |  58%
  |                                                                            
  |=========================================                             |  59%
  |                                                                            
  |==========================================                            |  59%
  |                                                                            
  |==========================================                            |  60%
  |                                                                            
  |==========================================                            |  61%
  |                                                                            
  |===========================================                           |  61%
  |                                                                            
  |===========================================                           |  62%
  |                                                                            
  |============================================                          |  62%
  |                                                                            
  |============================================                          |  63%
  |                                                                            
  |============================================                          |  64%
  |                                                                            
  |=============================================                         |  64%
  |                                                                            
  |=============================================                         |  65%
  |                                                                            
  |==============================================                        |  65%
  |                                                                            
  |==============================================                        |  66%
  |                                                                            
  |===============================================                       |  66%
  |                                                                            
  |===============================================                       |  67%
  |                                                                            
  |===============================================                       |  68%
  |                                                                            
  |================================================                      |  68%
  |                                                                            
  |================================================                      |  69%
  |                                                                            
  |=================================================                     |  69%
  |                                                                            
  |=================================================                     |  70%
  |                                                                            
  |=================================================                     |  71%
  |                                                                            
  |==================================================                    |  71%
  |                                                                            
  |==================================================                    |  72%
  |                                                                            
  |===================================================                   |  72%
  |                                                                            
  |===================================================                   |  73%
  |                                                                            
  |===================================================                   |  74%
  |                                                                            
  |====================================================                  |  74%
  |                                                                            
  |====================================================                  |  75%
  |                                                                            
  |=====================================================                 |  75%
  |                                                                            
  |=====================================================                 |  76%
  |                                                                            
  |======================================================                |  76%
  |                                                                            
  |======================================================                |  77%
  |                                                                            
  |======================================================                |  78%
  |                                                                            
  |=======================================================               |  78%
  |                                                                            
  |=======================================================               |  79%
  |                                                                            
  |========================================================              |  79%
  |                                                                            
  |========================================================              |  80%
  |                                                                            
  |========================================================              |  81%
  |                                                                            
  |=========================================================             |  81%
  |                                                                            
  |=========================================================             |  82%
  |                                                                            
  |==========================================================            |  82%
  |                                                                            
  |==========================================================            |  83%
  |                                                                            
  |==========================================================            |  84%
  |                                                                            
  |===========================================================           |  84%
  |                                                                            
  |===========================================================           |  85%
  |                                                                            
  |============================================================          |  85%
  |                                                                            
  |============================================================          |  86%
  |                                                                            
  |=============================================================         |  86%
  |                                                                            
  |=============================================================         |  87%
  |                                                                            
  |=============================================================         |  88%
  |                                                                            
  |==============================================================        |  88%
  |                                                                            
  |==============================================================        |  89%
  |                                                                            
  |===============================================================       |  90%
  |                                                                            
  |===============================================================       |  91%
  |                                                                            
  |================================================================      |  91%
  |                                                                            
  |================================================================      |  92%
  |                                                                            
  |=================================================================     |  93%
  |                                                                            
  |=================================================================     |  94%
  |                                                                            
  |==================================================================    |  94%
  |                                                                            
  |==================================================================    |  95%
  |                                                                            
  |===================================================================   |  95%
  |                                                                            
  |===================================================================   |  96%
  |                                                                            
  |====================================================================  |  97%
  |                                                                            
  |====================================================================  |  98%
  |                                                                            
  |===================================================================== |  98%
  |                                                                            
  |===================================================================== |  99%
  |                                                                            
  |======================================================================|  99%
  |                                                                            
  |======================================================================| 100%</code></pre>
<pre><code>## Response [https://www2.census.gov/programs-surveys/cps/datasets/2023/march/asecpub23sas.zip]
##   Date: 2023-11-04 20:12
##   Status: 200
##   Content-Type: application/zip
##   Size: 176 MB
## &lt;ON DISK&gt;  C:\Users\anthonyd\AppData\Local\Temp\RtmpEPzxb7\file5368225b1a46</code></pre>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="1.4-the-current-population-survey-cps.html#cb30-1" tabindex="-1"></a>unzipped_files <span class="ot">&lt;-</span> <span class="fu">unzip</span>(tf , <span class="at">exdir =</span> <span class="fu">tempdir</span>())</span></code></pre></div>
<p>Import all four files:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="1.4-the-current-population-survey-cps.html#cb31-1" tabindex="-1"></a><span class="fu">library</span>(haven)</span>
<span id="cb31-2"><a href="1.4-the-current-population-survey-cps.html#cb31-2" tabindex="-1"></a></span>
<span id="cb31-3"><a href="1.4-the-current-population-survey-cps.html#cb31-3" tabindex="-1"></a>four_tbl <span class="ot">&lt;-</span> <span class="fu">lapply</span>(unzipped_files , read_sas)</span>
<span id="cb31-4"><a href="1.4-the-current-population-survey-cps.html#cb31-4" tabindex="-1"></a></span>
<span id="cb31-5"><a href="1.4-the-current-population-survey-cps.html#cb31-5" tabindex="-1"></a>four_df <span class="ot">&lt;-</span> <span class="fu">lapply</span>(four_tbl , data.frame)</span>
<span id="cb31-6"><a href="1.4-the-current-population-survey-cps.html#cb31-6" tabindex="-1"></a></span>
<span id="cb31-7"><a href="1.4-the-current-population-survey-cps.html#cb31-7" tabindex="-1"></a>four_df <span class="ot">&lt;-</span></span>
<span id="cb31-8"><a href="1.4-the-current-population-survey-cps.html#cb31-8" tabindex="-1"></a>  <span class="fu">lapply</span>(four_df , <span class="cf">function</span>(w) {</span>
<span id="cb31-9"><a href="1.4-the-current-population-survey-cps.html#cb31-9" tabindex="-1"></a>    <span class="fu">names</span>(w) <span class="ot">&lt;-</span> <span class="fu">tolower</span>(<span class="fu">names</span>(w))</span>
<span id="cb31-10"><a href="1.4-the-current-population-survey-cps.html#cb31-10" tabindex="-1"></a>    w</span>
<span id="cb31-11"><a href="1.4-the-current-population-survey-cps.html#cb31-11" tabindex="-1"></a>  })</span>
<span id="cb31-12"><a href="1.4-the-current-population-survey-cps.html#cb31-12" tabindex="-1"></a></span>
<span id="cb31-13"><a href="1.4-the-current-population-survey-cps.html#cb31-13" tabindex="-1"></a>household_df <span class="ot">&lt;-</span></span>
<span id="cb31-14"><a href="1.4-the-current-population-survey-cps.html#cb31-14" tabindex="-1"></a>  four_df[[<span class="fu">grep</span>(<span class="st">&#39;hhpub&#39;</span> , <span class="fu">basename</span>(unzipped_files))]]</span>
<span id="cb31-15"><a href="1.4-the-current-population-survey-cps.html#cb31-15" tabindex="-1"></a>family_df <span class="ot">&lt;-</span></span>
<span id="cb31-16"><a href="1.4-the-current-population-survey-cps.html#cb31-16" tabindex="-1"></a>  four_df[[<span class="fu">grep</span>(<span class="st">&#39;ffpub&#39;</span> , <span class="fu">basename</span>(unzipped_files))]]</span>
<span id="cb31-17"><a href="1.4-the-current-population-survey-cps.html#cb31-17" tabindex="-1"></a>person_df <span class="ot">&lt;-</span></span>
<span id="cb31-18"><a href="1.4-the-current-population-survey-cps.html#cb31-18" tabindex="-1"></a>  four_df[[<span class="fu">grep</span>(<span class="st">&#39;pppub&#39;</span> , <span class="fu">basename</span>(unzipped_files))]]</span>
<span id="cb31-19"><a href="1.4-the-current-population-survey-cps.html#cb31-19" tabindex="-1"></a>repwgts_df <span class="ot">&lt;-</span></span>
<span id="cb31-20"><a href="1.4-the-current-population-survey-cps.html#cb31-20" tabindex="-1"></a>  four_df[[<span class="fu">grep</span>(<span class="st">&#39;repwgt&#39;</span> , <span class="fu">basename</span>(unzipped_files))]]</span></code></pre></div>
<p>Divide weights:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="1.4-the-current-population-survey-cps.html#cb32-1" tabindex="-1"></a>household_df[, <span class="st">&#39;hsup_wgt&#39;</span>] <span class="ot">&lt;-</span> household_df[, <span class="st">&#39;hsup_wgt&#39;</span>] <span class="sc">/</span> <span class="dv">100</span></span>
<span id="cb32-2"><a href="1.4-the-current-population-survey-cps.html#cb32-2" tabindex="-1"></a>family_df[, <span class="st">&#39;fsup_wgt&#39;</span>] <span class="ot">&lt;-</span> family_df[, <span class="st">&#39;fsup_wgt&#39;</span>] <span class="sc">/</span> <span class="dv">100</span></span>
<span id="cb32-3"><a href="1.4-the-current-population-survey-cps.html#cb32-3" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="fu">c</span>(<span class="st">&#39;marsupwt&#39;</span> , <span class="st">&#39;a_ernlwt&#39;</span> , <span class="st">&#39;a_fnlwgt&#39;</span>))</span>
<span id="cb32-4"><a href="1.4-the-current-population-survey-cps.html#cb32-4" tabindex="-1"></a>  person_df[, j] <span class="ot">&lt;-</span> person_df[, j] <span class="sc">/</span> <span class="dv">100</span></span></code></pre></div>
<p>Merge these four files:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="1.4-the-current-population-survey-cps.html#cb33-1" tabindex="-1"></a><span class="fu">names</span>(family_df)[<span class="fu">names</span>(family_df) <span class="sc">==</span> <span class="st">&#39;fh_seq&#39;</span>] <span class="ot">&lt;-</span> <span class="st">&#39;h_seq&#39;</span></span>
<span id="cb33-2"><a href="1.4-the-current-population-survey-cps.html#cb33-2" tabindex="-1"></a><span class="fu">names</span>(person_df)[<span class="fu">names</span>(person_df) <span class="sc">==</span> <span class="st">&#39;ph_seq&#39;</span>] <span class="ot">&lt;-</span> <span class="st">&#39;h_seq&#39;</span></span>
<span id="cb33-3"><a href="1.4-the-current-population-survey-cps.html#cb33-3" tabindex="-1"></a><span class="fu">names</span>(person_df)[<span class="fu">names</span>(person_df) <span class="sc">==</span> <span class="st">&#39;phf_seq&#39;</span>] <span class="ot">&lt;-</span> <span class="st">&#39;ffpos&#39;</span></span>
<span id="cb33-4"><a href="1.4-the-current-population-survey-cps.html#cb33-4" tabindex="-1"></a></span>
<span id="cb33-5"><a href="1.4-the-current-population-survey-cps.html#cb33-5" tabindex="-1"></a>hh_fm_df <span class="ot">&lt;-</span> <span class="fu">merge</span>(household_df , family_df)</span>
<span id="cb33-6"><a href="1.4-the-current-population-survey-cps.html#cb33-6" tabindex="-1"></a>hh_fm_pr_df <span class="ot">&lt;-</span> <span class="fu">merge</span>(hh_fm_df , person_df)</span>
<span id="cb33-7"><a href="1.4-the-current-population-survey-cps.html#cb33-7" tabindex="-1"></a>cps_df <span class="ot">&lt;-</span> <span class="fu">merge</span>(hh_fm_pr_df , repwgts_df)</span>
<span id="cb33-8"><a href="1.4-the-current-population-survey-cps.html#cb33-8" tabindex="-1"></a></span>
<span id="cb33-9"><a href="1.4-the-current-population-survey-cps.html#cb33-9" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">nrow</span>(cps_df) <span class="sc">==</span> <span class="fu">nrow</span>(person_df))</span></code></pre></div>
<p>Construct a complex sample survey design:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="1.4-the-current-population-survey-cps.html#cb34-1" tabindex="-1"></a><span class="fu">library</span>(survey)</span>
<span id="cb34-2"><a href="1.4-the-current-population-survey-cps.html#cb34-2" tabindex="-1"></a></span>
<span id="cb34-3"><a href="1.4-the-current-population-survey-cps.html#cb34-3" tabindex="-1"></a>cps_design <span class="ot">&lt;-</span></span>
<span id="cb34-4"><a href="1.4-the-current-population-survey-cps.html#cb34-4" tabindex="-1"></a>  <span class="fu">svrepdesign</span>(</span>
<span id="cb34-5"><a href="1.4-the-current-population-survey-cps.html#cb34-5" tabindex="-1"></a>    <span class="at">weights =</span> <span class="sc">~</span> marsupwt ,</span>
<span id="cb34-6"><a href="1.4-the-current-population-survey-cps.html#cb34-6" tabindex="-1"></a>    <span class="at">repweights =</span> <span class="st">&quot;pwwgt[1-9]&quot;</span> ,</span>
<span id="cb34-7"><a href="1.4-the-current-population-survey-cps.html#cb34-7" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">&quot;Fay&quot;</span> ,</span>
<span id="cb34-8"><a href="1.4-the-current-population-survey-cps.html#cb34-8" tabindex="-1"></a>    <span class="at">rho =</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="dv">1</span> <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="dv">4</span>)) ,</span>
<span id="cb34-9"><a href="1.4-the-current-population-survey-cps.html#cb34-9" tabindex="-1"></a>    <span class="at">data =</span> cps_df ,</span>
<span id="cb34-10"><a href="1.4-the-current-population-survey-cps.html#cb34-10" tabindex="-1"></a>    <span class="at">combined.weights =</span> <span class="cn">TRUE</span> ,</span>
<span id="cb34-11"><a href="1.4-the-current-population-survey-cps.html#cb34-11" tabindex="-1"></a>    <span class="at">mse =</span> <span class="cn">TRUE</span></span>
<span id="cb34-12"><a href="1.4-the-current-population-survey-cps.html#cb34-12" tabindex="-1"></a>  )</span></code></pre></div>
<p>Run the <code>convey_prep()</code> function on the full design:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="1.4-the-current-population-survey-cps.html#cb35-1" tabindex="-1"></a>cps_design <span class="ot">&lt;-</span> <span class="fu">convey_prep</span>(cps_design)</span></code></pre></div>
<div id="household-level-analysis-of-the-cps" class="section level3" number="1.4.1">
<h3><span class="header-section-number">1.4.1</span> Household-level Analysis of the CPS</h3>
<p>Limit the CPS person-level design to the household reference person, then calculate the gini coefficient with total household income:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="1.4-the-current-population-survey-cps.html#cb36-1" tabindex="-1"></a>cps_household_design <span class="ot">&lt;-</span> <span class="fu">subset</span>(cps_design , a_exprrp <span class="sc">%in%</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span>
<span id="cb36-2"><a href="1.4-the-current-population-survey-cps.html#cb36-2" tabindex="-1"></a></span>
<span id="cb36-3"><a href="1.4-the-current-population-survey-cps.html#cb36-3" tabindex="-1"></a>(cps_household_gini <span class="ot">&lt;-</span> <span class="fu">svygini</span>(<span class="sc">~</span> htotval , cps_household_design))</span></code></pre></div>
<pre><code>##            gini    SE
## htotval 0.48846 0.002</code></pre>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="1.4-the-current-population-survey-cps.html#cb38-1" tabindex="-1"></a><span class="co"># match 2022 household gini coefficient</span></span>
<span id="cb38-2"><a href="1.4-the-current-population-survey-cps.html#cb38-2" tabindex="-1"></a><span class="co"># https://www2.census.gov/programs-surveys/cps/tables/time-series/historical-income-households/h04.xlsx</span></span>
<span id="cb38-3"><a href="1.4-the-current-population-survey-cps.html#cb38-3" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">round</span>(<span class="fu">coef</span>(cps_household_gini) , <span class="dv">3</span>) <span class="sc">==</span> <span class="fl">0.488</span>)</span>
<span id="cb38-4"><a href="1.4-the-current-population-survey-cps.html#cb38-4" tabindex="-1"></a></span>
<span id="cb38-5"><a href="1.4-the-current-population-survey-cps.html#cb38-5" tabindex="-1"></a><span class="co"># match 2022 household gini margin of error</span></span>
<span id="cb38-6"><a href="1.4-the-current-population-survey-cps.html#cb38-6" tabindex="-1"></a><span class="co"># https://www.census.gov/content/dam/Census/newsroom/press-kits/2023/iphi/20230912-iphi-slides-income.pdf#page=13</span></span>
<span id="cb38-7"><a href="1.4-the-current-population-survey-cps.html#cb38-7" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">round</span>(</span>
<span id="cb38-8"><a href="1.4-the-current-population-survey-cps.html#cb38-8" tabindex="-1"></a>  <span class="fu">coef</span>(cps_household_gini) <span class="sc">-</span> <span class="fu">confint</span>(cps_household_gini , <span class="at">level =</span> <span class="fl">0.9</span>)[<span class="dv">1</span>] ,</span>
<span id="cb38-9"><a href="1.4-the-current-population-survey-cps.html#cb38-9" tabindex="-1"></a>  <span class="dv">4</span></span>
<span id="cb38-10"><a href="1.4-the-current-population-survey-cps.html#cb38-10" tabindex="-1"></a>) <span class="sc">==</span> <span class="fl">0.0033</span>) </span></code></pre></div>
</div>
<div id="family-level-analysis-of-the-cps" class="section level3" number="1.4.2">
<h3><span class="header-section-number">1.4.2</span> Family-level Analysis of the CPS</h3>
<p>Limit the CPS person-level design to the family reference person of primary families, then calculate the gini coefficient with total family income:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="1.4-the-current-population-survey-cps.html#cb39-1" tabindex="-1"></a>cps_family_design <span class="ot">&lt;-</span></span>
<span id="cb39-2"><a href="1.4-the-current-population-survey-cps.html#cb39-2" tabindex="-1"></a>  <span class="fu">subset</span>(cps_design , a_famrel <span class="sc">%in%</span> <span class="dv">1</span> <span class="sc">&amp;</span> a_famtyp <span class="sc">%in%</span> <span class="dv">1</span>)</span>
<span id="cb39-3"><a href="1.4-the-current-population-survey-cps.html#cb39-3" tabindex="-1"></a></span>
<span id="cb39-4"><a href="1.4-the-current-population-survey-cps.html#cb39-4" tabindex="-1"></a>(cps_family_gini <span class="ot">&lt;-</span> <span class="fu">svygini</span>(<span class="sc">~</span> ftotval , cps_family_design))</span></code></pre></div>
<pre><code>##            gini     SE
## ftotval 0.45816 0.0023</code></pre>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="1.4-the-current-population-survey-cps.html#cb41-1" tabindex="-1"></a><span class="co"># match 2022 family gini coefficient</span></span>
<span id="cb41-2"><a href="1.4-the-current-population-survey-cps.html#cb41-2" tabindex="-1"></a><span class="co"># https://www2.census.gov/programs-surveys/cps/tables/time-series/historical-income-families/f04.xlsx</span></span>
<span id="cb41-3"><a href="1.4-the-current-population-survey-cps.html#cb41-3" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">round</span>(<span class="fu">coef</span>(cps_family_gini) , <span class="dv">3</span>) <span class="sc">==</span> <span class="fl">0.458</span>)</span></code></pre></div>
</div>
<div id="full-time-full-year-worker-analysis-of-the-cps" class="section level3" number="1.4.3">
<h3><span class="header-section-number">1.4.3</span> Full-time Full Year Worker Analysis of the CPS</h3>
<p>Limit the CPS person-level design to full-time, full year workers, then calculate the gini coefficient with both total personal income and then total earnings:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="1.4-the-current-population-survey-cps.html#cb42-1" tabindex="-1"></a>cps_ftfy_worker_design <span class="ot">&lt;-</span> <span class="fu">subset</span>(cps_design , wewkrs <span class="sc">%in%</span> <span class="dv">1</span>)</span>
<span id="cb42-2"><a href="1.4-the-current-population-survey-cps.html#cb42-2" tabindex="-1"></a></span>
<span id="cb42-3"><a href="1.4-the-current-population-survey-cps.html#cb42-3" tabindex="-1"></a><span class="fu">svygini</span>(<span class="sc">~</span> ptotval , cps_ftfy_worker_design)</span></code></pre></div>
<pre><code>##            gini     SE
## ptotval 0.41809 0.0025</code></pre>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="1.4-the-current-population-survey-cps.html#cb44-1" tabindex="-1"></a><span class="fu">svygini</span>(<span class="sc">~</span> pearnval , cps_ftfy_worker_design)</span></code></pre></div>
<pre><code>##           gini     SE
## pearnval 0.412 0.0026</code></pre>

</div>
</div>
<!-- </div> -->
<p style="text-align: center;">
<a href="1.3-usage-examples.html"><button class="btn btn-default">Previous</button></a>
<a href="2-var.html"><button class="btn btn-default">Next</button></a>
</p>
</div>
</div>



</body>
</html>
