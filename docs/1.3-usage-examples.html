<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="1.3 Usage Examples | Poverty and Inequality with Complex Survey Data" />
<meta property="og:type" content="book" />

<meta property="og:description" content="A book about the R convey package" />
<meta name="github-repo" content="guilhermejacob/context" />

<meta name="author" content="Guilherme Jacob, Anthony Damico, and Djalma Pessoa" />

<meta name="date" content="2022-11-22" />

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<meta name="description" content="A book about the R convey package">

<title>1.3 Usage Examples | Poverty and Inequality with Complex Survey Data</title>

<link href="libs/tufte-css-2015.12.29/tufte-fonts.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte-background.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte-italics.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte.css" rel="stylesheet" />


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="toc.css" type="text/css" />

</head>

<body>



<div class="row">
<div class="col-sm-12">
<div id="TOC">
<ul>
<li class="has-sub"><a href="index.html#introduction" id="toc-introduction"><span class="toc-section-number">1</span> Introduction</a>
<ul>
<li><a href="1.1-install.html#install" id="toc-install"><span class="toc-section-number">1.1</span> Installation</a></li>
<li><a href="1.2-survey.html#survey" id="toc-survey"><span class="toc-section-number">1.2</span> Complex surveys and statistical inference</a></li>
<li><a href="1.3-usage-examples.html#usage-examples" id="toc-usage-examples"><span class="toc-section-number">1.3</span> Usage Examples</a></li>
<li><a href="1.4-underlying-calculations.html#underlying-calculations" id="toc-underlying-calculations"><span class="toc-section-number">1.4</span> Underlying Calculations</a></li>
<li><a href="1.5-the-variance-estimator.html#the-variance-estimator" id="toc-the-variance-estimator"><span class="toc-section-number">1.5</span> The Variance Estimator</a></li>
<li><a href="1.6-influence-functions.html#influence-functions" id="toc-influence-functions"><span class="toc-section-number">1.6</span> Influence Functions</a></li>
<li><a href="1.7-influence-function-examples.html#influence-function-examples" id="toc-influence-function-examples"><span class="toc-section-number">1.7</span> Influence Function Examples</a></li>
<li><a href="1.8-examples-of-linearization-using-the-influence-function.html#examples-of-linearization-using-the-influence-function" id="toc-examples-of-linearization-using-the-influence-function"><span class="toc-section-number">1.8</span> Examples of Linearization Using the Influence Function</a></li>
<li><a href="1.9-replication-designs.html#replication-designs" id="toc-replication-designs"><span class="toc-section-number">1.9</span> Replication Designs</a></li>
<li><a href="1.10-decomposition.html#decomposition" id="toc-decomposition"><span class="toc-section-number">1.10</span> Decomposition</a></li>
</ul></li>
<li class="has-sub"><a href="2-poverty.html#poverty" id="toc-poverty"><span class="toc-section-number">2</span> Poverty Indices</a>
<ul>
<li><a href="2.1-at-risk-of-poverty-threshold-svyarpt.html#at-risk-of-poverty-threshold-svyarpt" id="toc-at-risk-of-poverty-threshold-svyarpt"><span class="toc-section-number">2.1</span> At Risk of Poverty Threshold (svyarpt)</a></li>
<li><a href="2.2-at-risk-of-poverty-ratio-svyarpr.html#at-risk-of-poverty-ratio-svyarpr" id="toc-at-risk-of-poverty-ratio-svyarpr"><span class="toc-section-number">2.2</span> At Risk of Poverty Ratio (svyarpr)</a></li>
<li><a href="2.3-relative-median-income-ratio-svyrmir.html#relative-median-income-ratio-svyrmir" id="toc-relative-median-income-ratio-svyrmir"><span class="toc-section-number">2.3</span> Relative Median Income Ratio (svyrmir)</a></li>
<li><a href="2.4-relative-median-poverty-gap-svyrmpg.html#relative-median-poverty-gap-svyrmpg" id="toc-relative-median-poverty-gap-svyrmpg"><span class="toc-section-number">2.4</span> Relative Median Poverty Gap (svyrmpg)</a></li>
<li><a href="2.5-median-income-below-the-at-risk-of-poverty-threshold-svypoormed.html#median-income-below-the-at-risk-of-poverty-threshold-svypoormed" id="toc-median-income-below-the-at-risk-of-poverty-threshold-svypoormed"><span class="toc-section-number">2.5</span> Median Income Below the At Risk of Poverty Threshold (svypoormed)</a></li>
<li><a href="2.6-foster-greer-thorbecke-class-svyfgt-svyfgtdec.html#foster-greer-thorbecke-class-svyfgt-svyfgtdec" id="toc-foster-greer-thorbecke-class-svyfgt-svyfgtdec"><span class="toc-section-number">2.6</span> Foster-Greer-Thorbecke class (svyfgt, svyfgtdec)</a></li>
<li><a href="2.7-watts-poverty-measure-svywatts-svywattsdec.html#watts-poverty-measure-svywatts-svywattsdec" id="toc-watts-poverty-measure-svywatts-svywattsdec"><span class="toc-section-number">2.7</span> Watts poverty measure (svywatts, svywattsdec)</a></li>
</ul></li>
<li class="has-sub"><a href="3-inequality.html#inequality" id="toc-inequality"><span class="toc-section-number">3</span> Inequality Measurement</a>
<ul>
<li><a href="3.1-the-gender-pay-gap-svygpg.html#the-gender-pay-gap-svygpg" id="toc-the-gender-pay-gap-svygpg"><span class="toc-section-number">3.1</span> The Gender Pay Gap (svygpg)</a></li>
<li><a href="3.2-quintile-share-ratio-svyqsr.html#quintile-share-ratio-svyqsr" id="toc-quintile-share-ratio-svyqsr"><span class="toc-section-number">3.2</span> Quintile Share Ratio (svyqsr)</a></li>
<li><a href="3.3-lorenz-curve-svylorenz.html#lorenz-curve-svylorenz" id="toc-lorenz-curve-svylorenz"><span class="toc-section-number">3.3</span> Lorenz Curve (svylorenz)</a></li>
<li><a href="3.4-gini-index-svygini.html#gini-index-svygini" id="toc-gini-index-svygini"><span class="toc-section-number">3.4</span> Gini index (svygini)</a></li>
<li><a href="3.5-zenga-index-svyzenga.html#zenga-index-svyzenga" id="toc-zenga-index-svyzenga"><span class="toc-section-number">3.5</span> Zenga index (svyzenga)</a></li>
<li><a href="3.6-entropy-based-measures.html#entropy-based-measures" id="toc-entropy-based-measures"><span class="toc-section-number">3.6</span> Entropy-based Measures</a></li>
<li><a href="3.7-generalized-entropy-and-decomposition-svygei-svygeidec.html#generalized-entropy-and-decomposition-svygei-svygeidec" id="toc-generalized-entropy-and-decomposition-svygei-svygeidec"><span class="toc-section-number">3.7</span> Generalized Entropy and Decomposition (svygei, svygeidec)</a></li>
<li><a href="3.8-j-divergence-and-decomposition-svyjdiv-svyjdivdec.html#j-divergence-and-decomposition-svyjdiv-svyjdivdec" id="toc-j-divergence-and-decomposition-svyjdiv-svyjdivdec"><span class="toc-section-number">3.8</span> J-Divergence and Decomposition (svyjdiv, svyjdivdec)</a></li>
<li><a href="3.9-atkinson-index-svyatk.html#atkinson-index-svyatk" id="toc-atkinson-index-svyatk"><span class="toc-section-number">3.9</span> Atkinson index (svyatk)</a></li>
<li><a href="3.10-which-inequality-measure-should-be-used.html#which-inequality-measure-should-be-used" id="toc-which-inequality-measure-should-be-used"><span class="toc-section-number">3.10</span> Which inequality measure should be used?</a></li>
</ul></li>
</ul>
</div>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<div id="usage-examples" class="section level2" number="1.3">
<h2><span class="header-section-number">1.3</span> Usage Examples</h2>
<p>In the following example, we’ve loaded the data set <code>eusilc</code> from the R library <a href="https://CRAN.R-project.org/package=laeken">laeken</a> <span class="citation">(<label for="tufte-mn-6" class="margin-toggle">&#8853;</label><input type="checkbox" id="tufte-mn-6" class="margin-toggle">Alfons and Templ 2013<span class="marginnote">Alfons, Andreas, and Matthias Templ. 2013. <span>“Estimation of Social Exclusion Indicators from Complex Surveys: The <span>R</span> Package <span class="nocase">laeken</span>.”</span> <em>Journal of Statistical Software</em> 54 (15): 1–25. <a href="http://www.jstatsoft.org/v54/i15/">http://www.jstatsoft.org/v54/i15/</a>.</span>)</span>.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="1.3-usage-examples.html#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(laeken)</span>
<span id="cb3-2"><a href="1.3-usage-examples.html#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(eusilc)</span></code></pre></div>
<p>Next, we create an object of class <code>survey.design</code> using the function <code>svydesign</code> of the library survey:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="1.3-usage-examples.html#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survey)</span>
<span id="cb4-2"><a href="1.3-usage-examples.html#cb4-2" aria-hidden="true" tabindex="-1"></a>des_eusilc <span class="ot">&lt;-</span> <span class="fu">svydesign</span>(<span class="at">ids =</span> <span class="sc">~</span>rb030, <span class="at">strata =</span><span class="sc">~</span>db040,  <span class="at">weights =</span> <span class="sc">~</span>rb050, <span class="at">data =</span> eusilc)</span></code></pre></div>
<p>Right after the creation of the design object <code>des_eusilc</code>, we should use the function <code>convey_prep</code> that adds an attribute to the survey design which saves information on the design object based upon the whole sample, needed to work with subset designs.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="1.3-usage-examples.html#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(convey)</span>
<span id="cb5-2"><a href="1.3-usage-examples.html#cb5-2" aria-hidden="true" tabindex="-1"></a>des_eusilc <span class="ot">&lt;-</span> <span class="fu">convey_prep</span>( des_eusilc )</span></code></pre></div>
<p>To estimate the at-risk-of-poverty rate, we use the function <code>svyarpt</code>:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="1.3-usage-examples.html#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">svyarpr</span>(<span class="sc">~</span>eqIncome, <span class="at">design=</span>des_eusilc)</span></code></pre></div>
<pre><code>            arpr     SE
eqIncome 0.14444 0.0028</code></pre>
<p>To estimate the at-risk-of-poverty rate across domains defined by the variable <code>db040</code> we use:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="1.3-usage-examples.html#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">svyby</span>(<span class="sc">~</span>eqIncome, <span class="at">by =</span> <span class="sc">~</span>db040, <span class="at">design =</span> des_eusilc, <span class="at">FUN =</span> svyarpr, <span class="at">deff =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>                      db040  eqIncome          se
Burgenland       Burgenland 0.1953984 0.017202852
Carinthia         Carinthia 0.1308627 0.010606502
Lower Austria Lower Austria 0.1384362 0.006513217
Salzburg           Salzburg 0.1378734 0.011581408
Styria               Styria 0.1437464 0.007453192
Tyrol                 Tyrol 0.1530819 0.009884094
Upper Austria Upper Austria 0.1088977 0.005933094
Vienna               Vienna 0.1723468 0.007684540
Vorarlberg       Vorarlberg 0.1653731 0.013756389</code></pre>
<p>Using the same data set, we estimate the quintile share ratio:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="1.3-usage-examples.html#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># for the whole population</span></span>
<span id="cb10-2"><a href="1.3-usage-examples.html#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">svyqsr</span>(<span class="sc">~</span>eqIncome, <span class="at">design=</span>des_eusilc, <span class="at">alpha1=</span> .<span class="dv">20</span>)</span></code></pre></div>
<pre><code>          qsr     SE
eqIncome 3.97 0.0426</code></pre>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="1.3-usage-examples.html#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># for domains</span></span>
<span id="cb12-2"><a href="1.3-usage-examples.html#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">svyby</span>(<span class="sc">~</span>eqIncome, <span class="at">by =</span> <span class="sc">~</span>db040, <span class="at">design =</span> des_eusilc,</span>
<span id="cb12-3"><a href="1.3-usage-examples.html#cb12-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">FUN =</span> svyqsr, <span class="at">alpha1=</span> .<span class="dv">20</span>, <span class="at">deff =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>                      db040 eqIncome         se
Burgenland       Burgenland 5.008486 0.32755685
Carinthia         Carinthia 3.562404 0.10909726
Lower Austria Lower Austria 3.824539 0.08783599
Salzburg           Salzburg 3.768393 0.17015086
Styria               Styria 3.464305 0.09364800
Tyrol                 Tyrol 3.586046 0.13629739
Upper Austria Upper Austria 3.668289 0.09310624
Vienna               Vienna 4.654743 0.13135731
Vorarlberg       Vorarlberg 4.366511 0.20532075</code></pre>
<p>These functions can be used as S3 methods for the classes <code>survey.design</code> and <code>svyrep.design</code>.</p>
<p>Let’s create a design object of class <code>svyrep.design</code> and run the function <code>convey_prep</code> on it:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="1.3-usage-examples.html#cb14-1" aria-hidden="true" tabindex="-1"></a>des_eusilc_rep <span class="ot">&lt;-</span> <span class="fu">as.svrepdesign</span>(des_eusilc, <span class="at">type =</span> <span class="st">&quot;bootstrap&quot;</span>)</span>
<span id="cb14-2"><a href="1.3-usage-examples.html#cb14-2" aria-hidden="true" tabindex="-1"></a>des_eusilc_rep <span class="ot">&lt;-</span> <span class="fu">convey_prep</span>(des_eusilc_rep) </span></code></pre></div>
<p>and then use the function <code>svyarpr</code>:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="1.3-usage-examples.html#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">svyarpr</span>(<span class="sc">~</span>eqIncome, <span class="at">design=</span>des_eusilc_rep)</span></code></pre></div>
<pre><code>            arpr     SE
eqIncome 0.14444 0.0025</code></pre>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="1.3-usage-examples.html#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">svyby</span>(<span class="sc">~</span>eqIncome, <span class="at">by =</span> <span class="sc">~</span>db040, <span class="at">design =</span> des_eusilc_rep, <span class="at">FUN =</span> svyarpr, <span class="at">deff =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>                      db040  eqIncome se.eqIncome
Burgenland       Burgenland 0.1953984 0.016713791
Carinthia         Carinthia 0.1308627 0.012061625
Lower Austria Lower Austria 0.1384362 0.007294696
Salzburg           Salzburg 0.1378734 0.010050357
Styria               Styria 0.1437464 0.008558783
Tyrol                 Tyrol 0.1530819 0.010328225
Upper Austria Upper Austria 0.1088977 0.006212301
Vienna               Vienna 0.1723468 0.007259732
Vorarlberg       Vorarlberg 0.1653731 0.012792618</code></pre>
<p>The functions of the library convey are called in a similar way to the functions in library survey.</p>
<p>It is also possible to deal with missing values by using the argument <code>na.rm</code>.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="1.3-usage-examples.html#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># survey.design using a variable with missings</span></span>
<span id="cb19-2"><a href="1.3-usage-examples.html#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">svygini</span>( <span class="sc">~</span> py010n , <span class="at">design =</span> des_eusilc )</span></code></pre></div>
<pre><code>       gini SE
py010n   NA NA</code></pre>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="1.3-usage-examples.html#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">svygini</span>( <span class="sc">~</span> py010n , <span class="at">design =</span> des_eusilc , <span class="at">na.rm =</span> <span class="cn">TRUE</span> )</span></code></pre></div>
<pre><code>          gini     SE
py010n 0.64606 0.0036</code></pre>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="1.3-usage-examples.html#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># svyrep.design using a variable with missings</span></span>
<span id="cb23-2"><a href="1.3-usage-examples.html#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">svygini</span>( <span class="sc">~</span> py010n , <span class="at">design =</span> des_eusilc_rep )</span></code></pre></div>
<pre><code>       gini SE
py010n   NA NA</code></pre>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="1.3-usage-examples.html#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">svygini</span>( <span class="sc">~</span> py010n , <span class="at">design =</span> des_eusilc_rep , <span class="at">na.rm =</span> <span class="cn">TRUE</span> )</span></code></pre></div>
<pre><code>          gini     SE
py010n 0.64606 0.0043</code></pre>
</div>
<p style="text-align: center;">
<a href="1.2-survey.html"><button class="btn btn-default">Previous</button></a>
<a href="1.4-underlying-calculations.html"><button class="btn btn-default">Next</button></a>
</p>
</div>
</div>



</body>
</html>
