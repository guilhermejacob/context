<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="3.2 At Risk of Poverty Ratio (svyarpr) | Poverty and Inequality with Complex Survey Data" />
<meta property="og:type" content="book" />

<meta property="og:description" content="A book about the R convey package" />
<meta name="github-repo" content="guilhermejacob/context" />

<meta name="author" content="By Guilherme Jacob, Anthony Damico, and Djalma Pessoa. The authors received no external funding for the convey software and this accompanying textbook." />

<meta name="date" content="2023-11-07" />

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<meta name="description" content="A book about the R convey package">

<title>3.2 At Risk of Poverty Ratio (svyarpr) | Poverty and Inequality with Complex Survey Data</title>

<link href="libs/tufte-css-2015.12.29/tufte-fonts.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte-background.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte-italics.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte.css" rel="stylesheet" />


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="toc.css" type="text/css" />

</head>

<body>



<div class="row">
<div class="col-sm-12">
<div id="TOC">
<ul>
<li class="has-sub"><a href="index.html#intro" id="toc-intro"><span class="toc-section-number">1</span> Intro</a>
<ul>
<li><a href="1.1-install.html#install" id="toc-install"><span class="toc-section-number">1.1</span> Installation</a></li>
<li><a href="1.2-survey.html#survey" id="toc-survey"><span class="toc-section-number">1.2</span> Complex surveys and statistical inference</a></li>
<li><a href="1.3-usage-examples.html#usage-examples" id="toc-usage-examples"><span class="toc-section-number">1.3</span> Usage Examples</a></li>
<li class="has-sub"><a href="1.4-the-current-population-survey-cps.html#the-current-population-survey-cps" id="toc-the-current-population-survey-cps"><span class="toc-section-number">1.4</span> The Current Population Survey (CPS)</a>
<ul>
<li><a href="1.4-the-current-population-survey-cps.html#household-level-analysis-of-the-cps" id="toc-household-level-analysis-of-the-cps"><span class="toc-section-number">1.4.1</span> Household-level Analysis of the CPS</a></li>
<li><a href="1.4-the-current-population-survey-cps.html#family-level-analysis-of-the-cps" id="toc-family-level-analysis-of-the-cps"><span class="toc-section-number">1.4.2</span> Family-level Analysis of the CPS</a></li>
<li><a href="1.4-the-current-population-survey-cps.html#full-time-full-year-worker-analysis-of-the-cps" id="toc-full-time-full-year-worker-analysis-of-the-cps"><span class="toc-section-number">1.4.3</span> Full-time Full Year Worker Analysis of the CPS</a></li>
</ul></li>
</ul></li>
<li class="has-sub"><a href="2-var.html#var" id="toc-var"><span class="toc-section-number">2</span> Variance Estimation</a>
<ul>
<li class="has-sub"><a href="2.1-lin.html#lin" id="toc-lin"><span class="toc-section-number">2.1</span> Linearization-Based Variance Estimation</a>
<ul>
<li><a href="2.1-lin.html#influence-functions" id="toc-influence-functions"><span class="toc-section-number">2.1.1</span> Influence Functions</a></li>
</ul></li>
<li class="has-sub"><a href="2.2-replication-based-variance-estimation.html#replication-based-variance-estimation" id="toc-replication-based-variance-estimation"><span class="toc-section-number">2.2</span> Replication-Based Variance Estimation</a>
<ul>
<li><a href="2.2-replication-based-variance-estimation.html#replication-design-example" id="toc-replication-design-example"><span class="toc-section-number">2.2.1</span> Replication Design Example</a></li>
</ul></li>
<li><a href="2.3-variance-estimation-for-decompositions.html#variance-estimation-for-decompositions" id="toc-variance-estimation-for-decompositions"><span class="toc-section-number">2.3</span> Variance Estimation for Decompositions</a></li>
</ul></li>
<li class="has-sub"><a href="3-poverty.html#poverty" id="toc-poverty"><span class="toc-section-number">3</span> Poverty Indices</a>
<ul>
<li class="has-sub"><a href="3.1-at-risk-of-poverty-threshold-svyarpt.html#at-risk-of-poverty-threshold-svyarpt" id="toc-at-risk-of-poverty-threshold-svyarpt"><span class="toc-section-number">3.1</span> At Risk of Poverty Threshold (svyarpt)</a>
<ul>
<li><a href="3.1-at-risk-of-poverty-threshold-svyarpt.html#replication-example" id="toc-replication-example"><span class="toc-section-number">3.1.1</span> Replication Example</a></li>
</ul></li>
<li class="has-sub"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#at-risk-of-poverty-ratio-svyarpr" id="toc-at-risk-of-poverty-ratio-svyarpr"><span class="toc-section-number">3.2</span> At Risk of Poverty Ratio (svyarpr)</a>
<ul>
<li><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#replication-example-1" id="toc-replication-example-1"><span class="toc-section-number">3.2.1</span> Replication Example</a></li>
</ul></li>
<li class="has-sub"><a href="3.3-relative-median-income-ratio-svyrmir.html#relative-median-income-ratio-svyrmir" id="toc-relative-median-income-ratio-svyrmir"><span class="toc-section-number">3.3</span> Relative Median Income Ratio (svyrmir)</a>
<ul>
<li><a href="3.3-relative-median-income-ratio-svyrmir.html#replication-example-2" id="toc-replication-example-2"><span class="toc-section-number">3.3.1</span> Replication Example</a></li>
</ul></li>
<li class="has-sub"><a href="3.4-relative-median-poverty-gap-svyrmpg.html#relative-median-poverty-gap-svyrmpg" id="toc-relative-median-poverty-gap-svyrmpg"><span class="toc-section-number">3.4</span> Relative Median Poverty Gap (svyrmpg)</a>
<ul>
<li><a href="3.4-relative-median-poverty-gap-svyrmpg.html#replication-example-3" id="toc-replication-example-3"><span class="toc-section-number">3.4.1</span> Replication Example</a></li>
</ul></li>
<li class="has-sub"><a href="3.5-median-income-below-the-at-risk-of-poverty-threshold-svypoormed.html#median-income-below-the-at-risk-of-poverty-threshold-svypoormed" id="toc-median-income-below-the-at-risk-of-poverty-threshold-svypoormed"><span class="toc-section-number">3.5</span> Median Income Below the At Risk of Poverty Threshold (svypoormed)</a>
<ul>
<li><a href="3.5-median-income-below-the-at-risk-of-poverty-threshold-svypoormed.html#replication-example-4" id="toc-replication-example-4"><span class="toc-section-number">3.5.1</span> Replication Example</a></li>
</ul></li>
<li class="has-sub"><a href="3.6-foster-greer-thorbecke-class-svyfgt-svyfgtdec.html#foster-greer-thorbecke-class-svyfgt-svyfgtdec" id="toc-foster-greer-thorbecke-class-svyfgt-svyfgtdec"><span class="toc-section-number">3.6</span> Foster-Greer-Thorbecke class (svyfgt, svyfgtdec)</a>
<ul>
<li><a href="3.6-foster-greer-thorbecke-class-svyfgt-svyfgtdec.html#replication-example-5" id="toc-replication-example-5"><span class="toc-section-number">3.6.1</span> Replication Example</a></li>
<li><a href="3.6-foster-greer-thorbecke-class-svyfgt-svyfgtdec.html#monte-carlo-simulation" id="toc-monte-carlo-simulation"><span class="toc-section-number">3.6.2</span> Monte Carlo Simulation</a></li>
</ul></li>
<li class="has-sub"><a href="3.7-watts-poverty-measure-svywatts-svywattsdec.html#watts-poverty-measure-svywatts-svywattsdec" id="toc-watts-poverty-measure-svywatts-svywattsdec"><span class="toc-section-number">3.7</span> Watts poverty measure (svywatts, svywattsdec)</a>
<ul>
<li><a href="3.7-watts-poverty-measure-svywatts-svywattsdec.html#monte-carlo-simulation-1" id="toc-monte-carlo-simulation-1"><span class="toc-section-number">3.7.1</span> Monte Carlo Simulation</a></li>
</ul></li>
</ul></li>
<li class="has-sub"><a href="4-inequality.html#inequality" id="toc-inequality"><span class="toc-section-number">4</span> Inequality Measurement</a>
<ul>
<li><a href="4.1-which-inequality-measure-should-be-used.html#which-inequality-measure-should-be-used" id="toc-which-inequality-measure-should-be-used"><span class="toc-section-number">4.1</span> Which inequality measure should be used?</a></li>
<li class="has-sub"><a href="4.2-the-gender-pay-gap-svygpg.html#the-gender-pay-gap-svygpg" id="toc-the-gender-pay-gap-svygpg"><span class="toc-section-number">4.2</span> The Gender Pay Gap (svygpg)</a>
<ul>
<li><a href="4.2-the-gender-pay-gap-svygpg.html#replication-example-6" id="toc-replication-example-6"><span class="toc-section-number">4.2.1</span> Replication Example</a></li>
</ul></li>
<li class="has-sub"><a href="4.3-quintile-share-ratio-svyqsr.html#quintile-share-ratio-svyqsr" id="toc-quintile-share-ratio-svyqsr"><span class="toc-section-number">4.3</span> Quintile Share Ratio (svyqsr)</a>
<ul>
<li><a href="4.3-quintile-share-ratio-svyqsr.html#replication-example-7" id="toc-replication-example-7"><span class="toc-section-number">4.3.1</span> Replication Example</a></li>
</ul></li>
<li><a href="4.4-lorenz-curve-based-measures.html#lorenz-curve-based-measures" id="toc-lorenz-curve-based-measures"><span class="toc-section-number">4.4</span> Lorenz Curve-based Measures</a></li>
<li class="has-sub"><a href="4.5-lorenz-curve-svylorenz.html#lorenz-curve-svylorenz" id="toc-lorenz-curve-svylorenz"><span class="toc-section-number">4.5</span> Lorenz Curve (svylorenz)</a>
<ul>
<li><a href="4.5-lorenz-curve-svylorenz.html#replication-example-8" id="toc-replication-example-8"><span class="toc-section-number">4.5.1</span> Replication Example</a></li>
</ul></li>
<li class="has-sub"><a href="4.6-gini-index-svygini.html#gini-index-svygini" id="toc-gini-index-svygini"><span class="toc-section-number">4.6</span> Gini index (svygini)</a>
<ul>
<li><a href="4.6-gini-index-svygini.html#replication-example-9" id="toc-replication-example-9"><span class="toc-section-number">4.6.1</span> Replication Example</a></li>
</ul></li>
<li class="has-sub"><a href="4.7-zenga-index-svyzenga.html#zenga-index-svyzenga" id="toc-zenga-index-svyzenga"><span class="toc-section-number">4.7</span> Zenga index (svyzenga)</a>
<ul>
<li><a href="4.7-zenga-index-svyzenga.html#replication-example-10" id="toc-replication-example-10"><span class="toc-section-number">4.7.1</span> Replication Example</a></li>
</ul></li>
<li><a href="4.8-social-welfare-function-based-measures.html#social-welfare-function-based-measures" id="toc-social-welfare-function-based-measures"><span class="toc-section-number">4.8</span> Social Welfare Function-based Measures</a></li>
<li class="has-sub"><a href="4.9-atkinson-index-svyatk.html#atkinson-index-svyatk" id="toc-atkinson-index-svyatk"><span class="toc-section-number">4.9</span> Atkinson index (svyatk)</a>
<ul>
<li><a href="4.9-atkinson-index-svyatk.html#replication-example-11" id="toc-replication-example-11"><span class="toc-section-number">4.9.1</span> Replication Example</a></li>
</ul></li>
<li><a href="4.10-entropy-based-measures.html#entropy-based-measures" id="toc-entropy-based-measures"><span class="toc-section-number">4.10</span> Entropy-based Measures</a></li>
<li class="has-sub"><a href="4.11-generalized-entropy-and-decomposition-svygei-svygeidec.html#generalized-entropy-and-decomposition-svygei-svygeidec" id="toc-generalized-entropy-and-decomposition-svygei-svygeidec"><span class="toc-section-number">4.11</span> Generalized Entropy and Decomposition (svygei, svygeidec)</a>
<ul>
<li><a href="4.11-generalized-entropy-and-decomposition-svygei-svygeidec.html#replication-example-12" id="toc-replication-example-12"><span class="toc-section-number">4.11.1</span> Replication Example</a></li>
</ul></li>
<li class="has-sub"><a href="4.12-j-divergence-and-decomposition-svyjdiv-svyjdivdec.html#j-divergence-and-decomposition-svyjdiv-svyjdivdec" id="toc-j-divergence-and-decomposition-svyjdiv-svyjdivdec"><span class="toc-section-number">4.12</span> J-Divergence and Decomposition (svyjdiv, svyjdivdec)</a>
<ul>
<li><a href="4.12-j-divergence-and-decomposition-svyjdiv-svyjdivdec.html#monte-carlo-simulation-2" id="toc-monte-carlo-simulation-2"><span class="toc-section-number">4.12.1</span> Monte Carlo Simulation</a></li>
</ul></li>
</ul></li>
<li class="has-sub"><a href="5-richness.html#richness" id="toc-richness"><span class="toc-section-number">5</span> Richness</a>
<ul>
<li class="has-sub"><a href="5.1-richness-measures-svyrich.html#richness-measures-svyrich" id="toc-richness-measures-svyrich"><span class="toc-section-number">5.1</span> Richness Measures (svyrich)</a>
<ul>
<li><a href="5.1-richness-measures-svyrich.html#monte-carlo-simulation-3" id="toc-monte-carlo-simulation-3"><span class="toc-section-number">5.1.1</span> Monte Carlo Simulation</a></li>
</ul></li>
</ul></li>
<li class="has-sub"><a href="6-multidimensional-poverty.html#multidimensional-poverty" id="toc-multidimensional-poverty"><span class="toc-section-number">6</span> Multidimensional Poverty</a>
<ul>
<li><a href="6.1-example-calculation.html#example-calculation" id="toc-example-calculation"><span class="toc-section-number">6.1</span> Example Calculation</a></li>
</ul></li>
<li class="has-sub"><a href="7-covariance-matrix.html#covariance-matrix" id="toc-covariance-matrix"><span class="toc-section-number">7</span> Covariance Matrix</a>
<ul>
<li><a href="7.1-example-calculation-1.html#example-calculation-1" id="toc-example-calculation-1"><span class="toc-section-number">7.1</span> Example Calculation</a></li>
</ul></li>
</ul>
</div>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<div id="at-risk-of-poverty-ratio-svyarpr" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> At Risk of Poverty Ratio (svyarpr)</h2>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb71-1" tabindex="-1"></a>✔️ EU standard like ARPT, easy to understand, interpret, and implement</span>
<span id="cb71-2"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb71-2" tabindex="-1"></a>✔️ proportion of individuals below ARPT <span class="sc">--</span> a <span class="st">&quot;companion&quot;</span> <span class="cf">function</span> that uses <span class="fu">svyarpt</span>() internally</span>
<span id="cb71-3"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb71-3" tabindex="-1"></a>✔️ measure is easy to understand</span>
<span id="cb71-4"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb71-4" tabindex="-1"></a>❌ does not account <span class="cf">for</span> the intensity or inequality among the poor</span>
<span id="cb71-5"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb71-5" tabindex="-1"></a>❌ not very common outside of the EU</span>
<span id="cb71-6"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb71-6" tabindex="-1"></a>❌ just another name <span class="cf">for</span> the <span class="st">`</span><span class="at">svyfgt( g = 0 , thresh = &quot;relq&quot; )</span><span class="st">`</span></span></code></pre></div>
<p>The at-risk-of-poverty rate (ARPR) is the share of persons with an income below the at-risk-of-poverty threshold (ARPT). The logic behind this measure is that although most people below the ARPT cannot be considered “poor”, they are the ones most vulnerable to becoming poor in the event of a negative economic phenomenon like a recession.</p>
<p>The ARPR is a composite estimate, taking into account both the sampling error in the proportion itself and that in the ARPT estimate. The details of the linearization of the ARPR are discussed by <span class="citation">Deville (<label for="tufte-mn-26" class="margin-toggle">&#8853;</label><input type="checkbox" id="tufte-mn-26" class="margin-toggle">1999<span class="marginnote">Deville, Jean-Claude. 1999. <span>“Variance Estimation for Complex Statistics and Estimators: Linearization and Residual Techniques.”</span> <em>Survey Methodology</em> 25 (2): 193–203. <a href="http://www.statcan.gc.ca/pub/12-001-x/1999002/article/4882-eng.pdf">http://www.statcan.gc.ca/pub/12-001-x/1999002/article/4882-eng.pdf</a>.</span>)</span> and <span class="citation">Osier (<label for="tufte-mn-27" class="margin-toggle">&#8853;</label><input type="checkbox" id="tufte-mn-27" class="margin-toggle">2009<span class="marginnote">Osier, Guillaume. 2009. <span>“Variance Estimation for Complex Indicators of Poverty and Inequality.”</span> <em>Journal of the European Survey Research Association</em> 3 (3): 167–95. <a href="http://ojs.ub.uni-konstanz.de/srm/article/view/369">http://ojs.ub.uni-konstanz.de/srm/article/view/369</a>.</span>)</span>.</p>
<hr />
<div id="replication-example-1" class="section level3" number="3.2.1">
<h3><span class="header-section-number">3.2.1</span> Replication Example</h3>
<p>The R <code>vardpoor</code> package <span class="citation">(<label for="tufte-mn-28" class="margin-toggle">&#8853;</label><input type="checkbox" id="tufte-mn-28" class="margin-toggle">Breidaks, Liberts, and Ivanova 2016<span class="marginnote">Breidaks, Juris, Martins Liberts, and Santa Ivanova. 2016. <span>“Vardpoor: Estimation of Indicators on Social Exclusion and Poverty and Its Linearization, Variance Estimation.”</span> Riga, Latvia: CSB.</span>)</span>, created by researchers at the Central Statistical Bureau of Latvia, includes a ARPR coefficient calculation using the ultimate cluster method. The example below reproduces those statistics.</p>
<p>Load and prepare the same data set:</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb72-1" tabindex="-1"></a><span class="co"># load the convey package</span></span>
<span id="cb72-2"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb72-2" tabindex="-1"></a><span class="fu">library</span>(convey)</span>
<span id="cb72-3"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb72-3" tabindex="-1"></a></span>
<span id="cb72-4"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb72-4" tabindex="-1"></a><span class="co"># load the survey library</span></span>
<span id="cb72-5"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb72-5" tabindex="-1"></a><span class="fu">library</span>(survey)</span>
<span id="cb72-6"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb72-6" tabindex="-1"></a></span>
<span id="cb72-7"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb72-7" tabindex="-1"></a><span class="co"># load the vardpoor library</span></span>
<span id="cb72-8"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb72-8" tabindex="-1"></a><span class="fu">library</span>(vardpoor)</span>
<span id="cb72-9"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb72-9" tabindex="-1"></a></span>
<span id="cb72-10"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb72-10" tabindex="-1"></a><span class="co"># load the vardpoor library</span></span>
<span id="cb72-11"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb72-11" tabindex="-1"></a><span class="fu">library</span>(laeken)</span>
<span id="cb72-12"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb72-12" tabindex="-1"></a></span>
<span id="cb72-13"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb72-13" tabindex="-1"></a><span class="co"># load the synthetic EU statistics on income &amp; living conditions</span></span>
<span id="cb72-14"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb72-14" tabindex="-1"></a><span class="fu">data</span>(eusilc)</span>
<span id="cb72-15"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb72-15" tabindex="-1"></a></span>
<span id="cb72-16"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb72-16" tabindex="-1"></a><span class="co"># make all column names lowercase</span></span>
<span id="cb72-17"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb72-17" tabindex="-1"></a><span class="fu">names</span>(eusilc) <span class="ot">&lt;-</span> <span class="fu">tolower</span>(<span class="fu">names</span>(eusilc))</span>
<span id="cb72-18"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb72-18" tabindex="-1"></a></span>
<span id="cb72-19"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb72-19" tabindex="-1"></a><span class="co"># add a column with the row number</span></span>
<span id="cb72-20"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb72-20" tabindex="-1"></a>dati <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">data.table</span>(<span class="at">IDd =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(eusilc), eusilc)</span>
<span id="cb72-21"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb72-21" tabindex="-1"></a></span>
<span id="cb72-22"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb72-22" tabindex="-1"></a><span class="co"># calculate the arpr coefficient</span></span>
<span id="cb72-23"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb72-23" tabindex="-1"></a><span class="co"># using the R vardpoor library</span></span>
<span id="cb72-24"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb72-24" tabindex="-1"></a>varpoord_arpr_calculation <span class="ot">&lt;-</span></span>
<span id="cb72-25"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb72-25" tabindex="-1"></a>  <span class="fu">varpoord</span>(</span>
<span id="cb72-26"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb72-26" tabindex="-1"></a>    <span class="co"># analysis variable</span></span>
<span id="cb72-27"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb72-27" tabindex="-1"></a>    <span class="at">Y =</span> <span class="st">&quot;eqincome&quot;</span>,</span>
<span id="cb72-28"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb72-28" tabindex="-1"></a>    </span>
<span id="cb72-29"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb72-29" tabindex="-1"></a>    <span class="co"># weights variable</span></span>
<span id="cb72-30"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb72-30" tabindex="-1"></a>    <span class="at">w_final =</span> <span class="st">&quot;rb050&quot;</span>,</span>
<span id="cb72-31"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb72-31" tabindex="-1"></a>    </span>
<span id="cb72-32"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb72-32" tabindex="-1"></a>    <span class="co"># row number variable</span></span>
<span id="cb72-33"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb72-33" tabindex="-1"></a>    <span class="at">ID_level1 =</span> <span class="st">&quot;IDd&quot;</span>,</span>
<span id="cb72-34"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb72-34" tabindex="-1"></a>    </span>
<span id="cb72-35"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb72-35" tabindex="-1"></a>    <span class="co"># row number variable</span></span>
<span id="cb72-36"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb72-36" tabindex="-1"></a>    <span class="at">ID_level2 =</span> <span class="st">&quot;IDd&quot;</span>,</span>
<span id="cb72-37"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb72-37" tabindex="-1"></a>    </span>
<span id="cb72-38"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb72-38" tabindex="-1"></a>    <span class="co"># strata variable</span></span>
<span id="cb72-39"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb72-39" tabindex="-1"></a>    <span class="at">H =</span> <span class="st">&quot;db040&quot;</span>,</span>
<span id="cb72-40"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb72-40" tabindex="-1"></a>    </span>
<span id="cb72-41"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb72-41" tabindex="-1"></a>    <span class="at">N_h =</span> <span class="cn">NULL</span> ,</span>
<span id="cb72-42"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb72-42" tabindex="-1"></a>    </span>
<span id="cb72-43"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb72-43" tabindex="-1"></a>    <span class="co"># clustering variable</span></span>
<span id="cb72-44"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb72-44" tabindex="-1"></a>    <span class="at">PSU =</span> <span class="st">&quot;rb030&quot;</span>,</span>
<span id="cb72-45"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb72-45" tabindex="-1"></a>    </span>
<span id="cb72-46"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb72-46" tabindex="-1"></a>    <span class="co"># data.table</span></span>
<span id="cb72-47"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb72-47" tabindex="-1"></a>    <span class="at">dataset =</span> dati,</span>
<span id="cb72-48"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb72-48" tabindex="-1"></a>    </span>
<span id="cb72-49"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb72-49" tabindex="-1"></a>    <span class="co"># arpr coefficient function</span></span>
<span id="cb72-50"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb72-50" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">&quot;linarpr&quot;</span>,</span>
<span id="cb72-51"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb72-51" tabindex="-1"></a>    </span>
<span id="cb72-52"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb72-52" tabindex="-1"></a>    <span class="co"># get linearized variable</span></span>
<span id="cb72-53"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb72-53" tabindex="-1"></a>    <span class="at">outp_lin =</span> <span class="cn">TRUE</span></span>
<span id="cb72-54"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb72-54" tabindex="-1"></a>    </span>
<span id="cb72-55"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb72-55" tabindex="-1"></a>  )</span>
<span id="cb72-56"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb72-56" tabindex="-1"></a></span>
<span id="cb72-57"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb72-57" tabindex="-1"></a></span>
<span id="cb72-58"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb72-58" tabindex="-1"></a><span class="co"># construct a survey.design</span></span>
<span id="cb72-59"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb72-59" tabindex="-1"></a><span class="co"># using our recommended setup</span></span>
<span id="cb72-60"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb72-60" tabindex="-1"></a>des_eusilc <span class="ot">&lt;-</span></span>
<span id="cb72-61"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb72-61" tabindex="-1"></a>  <span class="fu">svydesign</span>(</span>
<span id="cb72-62"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb72-62" tabindex="-1"></a>    <span class="at">ids =</span> <span class="sc">~</span> rb030 ,</span>
<span id="cb72-63"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb72-63" tabindex="-1"></a>    <span class="at">strata =</span> <span class="sc">~</span> db040 ,</span>
<span id="cb72-64"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb72-64" tabindex="-1"></a>    <span class="at">weights =</span> <span class="sc">~</span> rb050 ,</span>
<span id="cb72-65"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb72-65" tabindex="-1"></a>    <span class="at">data =</span> eusilc</span>
<span id="cb72-66"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb72-66" tabindex="-1"></a>  )</span>
<span id="cb72-67"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb72-67" tabindex="-1"></a></span>
<span id="cb72-68"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb72-68" tabindex="-1"></a><span class="co"># immediately run the convey_prep function on it</span></span>
<span id="cb72-69"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb72-69" tabindex="-1"></a>des_eusilc <span class="ot">&lt;-</span> <span class="fu">convey_prep</span>(des_eusilc)</span>
<span id="cb72-70"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb72-70" tabindex="-1"></a></span>
<span id="cb72-71"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb72-71" tabindex="-1"></a><span class="co"># coefficients do match</span></span>
<span id="cb72-72"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb72-72" tabindex="-1"></a>varpoord_arpr_calculation<span class="sc">$</span>all_result<span class="sc">$</span>value</span></code></pre></div>
<pre><code>## [1] 14.44422</code></pre>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb74-1" tabindex="-1"></a><span class="fu">coef</span>(<span class="fu">svyarpr</span>( <span class="sc">~</span> eqincome , des_eusilc)) <span class="sc">*</span> <span class="dv">100</span></span></code></pre></div>
<pre><code>## eqincome 
## 14.44422</code></pre>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb76-1" tabindex="-1"></a><span class="co"># linearized variables do not match</span></span>
<span id="cb76-2"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb76-2" tabindex="-1"></a><span class="co"># because Fprime is the derivative wrt</span></span>
<span id="cb76-3"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb76-3" tabindex="-1"></a><span class="co"># to the estimated threshold, not the estimated quantile</span></span>
<span id="cb76-4"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb76-4" tabindex="-1"></a><span class="co"># for more details, see</span></span>
<span id="cb76-5"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb76-5" tabindex="-1"></a><span class="co"># https://github.com/ajdamico/convey/issues/372#issuecomment-1656264143</span></span>
<span id="cb76-6"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb76-6" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb76-7"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb76-7" tabindex="-1"></a><span class="co"># vardpoor</span></span>
<span id="cb76-8"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb76-8" tabindex="-1"></a>lin_arpr_varpoord <span class="ot">&lt;-</span> varpoord_arpr_calculation<span class="sc">$</span>lin_out<span class="sc">$</span>lin_arpr</span>
<span id="cb76-9"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb76-9" tabindex="-1"></a><span class="co"># convey</span></span>
<span id="cb76-10"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb76-10" tabindex="-1"></a>lin_arpr_convey <span class="ot">&lt;-</span> <span class="fu">attr</span>(<span class="fu">svyarpr</span>( <span class="sc">~</span> eqincome , des_eusilc), <span class="st">&quot;lin&quot;</span>)</span>
<span id="cb76-11"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb76-11" tabindex="-1"></a></span>
<span id="cb76-12"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb76-12" tabindex="-1"></a><span class="co"># check equality</span></span>
<span id="cb76-13"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb76-13" tabindex="-1"></a><span class="fu">all.equal</span>(lin_arpr_varpoord, <span class="dv">100</span> <span class="sc">*</span> lin_arpr_convey)</span></code></pre></div>
<pre><code>## [1] &quot;Mean relative difference: 0.2264738&quot;</code></pre>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb78-1" tabindex="-1"></a><span class="co"># variances do not match exactly</span></span>
<span id="cb78-2"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb78-2" tabindex="-1"></a><span class="fu">attr</span>(<span class="fu">svyarpr</span>( <span class="sc">~</span> eqincome , des_eusilc) , <span class="st">&#39;var&#39;</span>) <span class="sc">*</span> <span class="dv">10000</span></span></code></pre></div>
<pre><code>##            eqincome
## eqincome 0.07599778</code></pre>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb80-1" tabindex="-1"></a>varpoord_arpr_calculation<span class="sc">$</span>all_result<span class="sc">$</span>var</span></code></pre></div>
<pre><code>## [1] 0.08718569</code></pre>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb82-1" tabindex="-1"></a><span class="co"># standard errors do not match exactly</span></span>
<span id="cb82-2"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb82-2" tabindex="-1"></a>varpoord_arpr_calculation<span class="sc">$</span>all_result<span class="sc">$</span>se</span></code></pre></div>
<pre><code>## [1] 0.2952722</code></pre>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb84-1" tabindex="-1"></a><span class="fu">SE</span>(<span class="fu">svyarpr</span>( <span class="sc">~</span> eqincome , des_eusilc)) <span class="sc">*</span> <span class="dv">100</span></span></code></pre></div>
<pre><code>##           eqincome
## eqincome 0.2756769</code></pre>
<p>The variance estimate is computed by using the approximation defined in <a href="2-var.html#var">2</a>, while the linearized variable <span class="math inline">\(z\)</span> is defined by <a href="2.1-lin.html#lin">2.1</a>. The functions <code>convey::svyarpr</code> and <code>vardpoor::linarpr</code> produce the same linearized variable <span class="math inline">\(z\)</span>.</p>
<p>However, the measures of uncertainty do not line up. One of the reasons is that <code>library(vardpoor)</code> defaults to an ultimate cluster method that can be replicated with an alternative setup of the <code>survey.design</code> object.</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb86-1" tabindex="-1"></a><span class="co"># within each strata, sum up the weights</span></span>
<span id="cb86-2"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb86-2" tabindex="-1"></a>cluster_sums <span class="ot">&lt;-</span></span>
<span id="cb86-3"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb86-3" tabindex="-1"></a>  <span class="fu">aggregate</span>(eusilc<span class="sc">$</span>rb050 , <span class="fu">list</span>(eusilc<span class="sc">$</span>db040) , sum)</span>
<span id="cb86-4"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb86-4" tabindex="-1"></a></span>
<span id="cb86-5"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb86-5" tabindex="-1"></a><span class="co"># name the within-strata sums of weights the `cluster_sum`</span></span>
<span id="cb86-6"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb86-6" tabindex="-1"></a><span class="fu">names</span>(cluster_sums) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;db040&quot;</span> , <span class="st">&quot;cluster_sum&quot;</span>)</span>
<span id="cb86-7"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb86-7" tabindex="-1"></a></span>
<span id="cb86-8"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb86-8" tabindex="-1"></a><span class="co"># merge this column back onto the data.frame</span></span>
<span id="cb86-9"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb86-9" tabindex="-1"></a>eusilc <span class="ot">&lt;-</span> <span class="fu">merge</span>(eusilc , cluster_sums)</span>
<span id="cb86-10"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb86-10" tabindex="-1"></a></span>
<span id="cb86-11"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb86-11" tabindex="-1"></a><span class="co"># construct a survey.design</span></span>
<span id="cb86-12"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb86-12" tabindex="-1"></a><span class="co"># with the fpc using the cluster sum</span></span>
<span id="cb86-13"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb86-13" tabindex="-1"></a>des_eusilc_ultimate_cluster <span class="ot">&lt;-</span></span>
<span id="cb86-14"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb86-14" tabindex="-1"></a>  <span class="fu">svydesign</span>(</span>
<span id="cb86-15"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb86-15" tabindex="-1"></a>    <span class="at">ids =</span> <span class="sc">~</span> rb030 ,</span>
<span id="cb86-16"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb86-16" tabindex="-1"></a>    <span class="at">strata =</span> <span class="sc">~</span> db040 ,</span>
<span id="cb86-17"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb86-17" tabindex="-1"></a>    <span class="at">weights =</span> <span class="sc">~</span> rb050 ,</span>
<span id="cb86-18"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb86-18" tabindex="-1"></a>    <span class="at">data =</span> eusilc ,</span>
<span id="cb86-19"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb86-19" tabindex="-1"></a>    <span class="at">fpc =</span> <span class="sc">~</span> cluster_sum</span>
<span id="cb86-20"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb86-20" tabindex="-1"></a>  )</span>
<span id="cb86-21"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb86-21" tabindex="-1"></a></span>
<span id="cb86-22"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb86-22" tabindex="-1"></a><span class="co"># again, immediately run the convey_prep function on the `survey.design`</span></span>
<span id="cb86-23"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb86-23" tabindex="-1"></a>des_eusilc_ultimate_cluster <span class="ot">&lt;-</span></span>
<span id="cb86-24"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb86-24" tabindex="-1"></a>  <span class="fu">convey_prep</span>(des_eusilc_ultimate_cluster)</span>
<span id="cb86-25"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb86-25" tabindex="-1"></a></span>
<span id="cb86-26"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb86-26" tabindex="-1"></a><span class="co"># does not match</span></span>
<span id="cb86-27"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb86-27" tabindex="-1"></a><span class="fu">attr</span>(<span class="fu">svyarpr</span>( <span class="sc">~</span> eqincome , des_eusilc_ultimate_cluster) , <span class="st">&#39;var&#39;</span>) <span class="sc">*</span> <span class="dv">10000</span></span></code></pre></div>
<pre><code>##            eqincome
## eqincome 0.07586194</code></pre>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb88-1" tabindex="-1"></a>varpoord_arpr_calculation<span class="sc">$</span>all_result<span class="sc">$</span>var</span></code></pre></div>
<pre><code>## [1] 0.08718569</code></pre>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb90-1" tabindex="-1"></a><span class="co"># does not match</span></span>
<span id="cb90-2"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb90-2" tabindex="-1"></a>varpoord_arpr_calculation<span class="sc">$</span>all_result<span class="sc">$</span>se</span></code></pre></div>
<pre><code>## [1] 0.2952722</code></pre>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb92-1" tabindex="-1"></a><span class="fu">SE</span>(<span class="fu">svyarpr</span>( <span class="sc">~</span> eqincome , des_eusilc_ultimate_cluster)) <span class="sc">*</span> <span class="dv">100</span></span></code></pre></div>
<pre><code>##           eqincome
## eqincome 0.2754305</code></pre>
<p>Still, there is a difference in the estimates. This is discussed in detail in <a href="https://github.com/ajdamico/convey/issues/372">this issue</a>.
In order to still provide additional examples for our code, we proceed with a Monte Carlo experiment.</p>
<p>Using the <code>eusilcP</code> data from the <code>simPop</code> package <span class="citation">(<label for="tufte-mn-29" class="margin-toggle">&#8853;</label><input type="checkbox" id="tufte-mn-29" class="margin-toggle">Templ et al. 2017<span class="marginnote">Templ, Matthias, Bernhard Meindl, Alexander Kowarik, and Olivier Dupriez. 2017. <span>“Simulation of Synthetic Complex Data: The <span>R</span> Package <span class="nocase">simPop</span>.”</span> <em>Journal of Statistical Software</em> 79 (10): 1–38. <a href="https://doi.org/10.18637/jss.v079.i10">https://doi.org/10.18637/jss.v079.i10</a>.</span>)</span>, we can compute the actual value of the at risk of poverty rate for that population:</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb94-1" tabindex="-1"></a><span class="co"># load libraries</span></span>
<span id="cb94-2"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb94-2" tabindex="-1"></a><span class="fu">library</span>(sampling)</span>
<span id="cb94-3"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb94-3" tabindex="-1"></a><span class="fu">library</span>(survey)</span>
<span id="cb94-4"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb94-4" tabindex="-1"></a><span class="fu">library</span>(convey)</span>
<span id="cb94-5"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb94-5" tabindex="-1"></a><span class="fu">library</span>(parallel)</span>
<span id="cb94-6"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb94-6" tabindex="-1"></a></span>
<span id="cb94-7"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb94-7" tabindex="-1"></a><span class="co"># load pseudo population data</span></span>
<span id="cb94-8"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb94-8" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;eusilcP&quot;</span> , <span class="at">package =</span> <span class="st">&quot;simPop&quot;</span>)</span>
<span id="cb94-9"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb94-9" tabindex="-1"></a></span>
<span id="cb94-10"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb94-10" tabindex="-1"></a><span class="co"># compute population median</span></span>
<span id="cb94-11"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb94-11" tabindex="-1"></a>q50.pop <span class="ot">&lt;-</span></span>
<span id="cb94-12"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb94-12" tabindex="-1"></a>  convey<span class="sc">:::</span><span class="fu">computeQuantiles</span>(eusilcP<span class="sc">$</span>eqIncome , <span class="fu">rep</span>(<span class="dv">1</span> , <span class="fu">length</span>(eusilcP<span class="sc">$</span>eqIncome)) , .<span class="dv">50</span>)</span>
<span id="cb94-13"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb94-13" tabindex="-1"></a></span>
<span id="cb94-14"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb94-14" tabindex="-1"></a><span class="co"># compute population poverty threshold</span></span>
<span id="cb94-15"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb94-15" tabindex="-1"></a><span class="co"># as 60% of the median</span></span>
<span id="cb94-16"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb94-16" tabindex="-1"></a>thresh.pop <span class="ot">&lt;-</span> .<span class="dv">60</span> <span class="sc">*</span> q50.pop</span>
<span id="cb94-17"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb94-17" tabindex="-1"></a></span>
<span id="cb94-18"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb94-18" tabindex="-1"></a><span class="co"># compute population at risk of poverty rate</span></span>
<span id="cb94-19"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb94-19" tabindex="-1"></a>(theta.pop <span class="ot">&lt;-</span></span>
<span id="cb94-20"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb94-20" tabindex="-1"></a>    <span class="fu">mean</span>(eusilcP<span class="sc">$</span>eqIncome <span class="sc">&lt;=</span> thresh.pop , <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
<pre><code>## [1] 0.1469295</code></pre>
<p>Now, to study the distribution of the estimator under a particular sampling design, we select 5000 samples under one-stage cluster sampling of 100 households using the <code>cluster</code> function from the <code>sampling</code> package <span class="citation">(<label for="tufte-mn-30" class="margin-toggle">&#8853;</label><input type="checkbox" id="tufte-mn-30" class="margin-toggle">Tillé and Matei 2021<span class="marginnote">Tillé, Yves, and Alina Matei. 2021. <em>Sampling: Survey Sampling</em>. <a href="https://CRAN.R-project.org/package=sampling">https://CRAN.R-project.org/package=sampling</a>.</span>)</span>, and use the <code>svyarpr</code> function to estimate the ARPR for each of those samples:</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb96-1" tabindex="-1"></a><span class="co"># define the number of monte carlo replicates</span></span>
<span id="cb96-2"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb96-2" tabindex="-1"></a>mc.rep <span class="ot">&lt;-</span> 5000L</span>
<span id="cb96-3"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb96-3" tabindex="-1"></a></span>
<span id="cb96-4"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb96-4" tabindex="-1"></a><span class="co"># simulation function</span></span>
<span id="cb96-5"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb96-5" tabindex="-1"></a>arpr_sim_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(this.iter) {</span>
<span id="cb96-6"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb96-6" tabindex="-1"></a>  </span>
<span id="cb96-7"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb96-7" tabindex="-1"></a>  <span class="fu">set.seed</span>(this.iter)</span>
<span id="cb96-8"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb96-8" tabindex="-1"></a>  </span>
<span id="cb96-9"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb96-9" tabindex="-1"></a>  </span>
<span id="cb96-10"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb96-10" tabindex="-1"></a>  <span class="fu">library</span>(survey)</span>
<span id="cb96-11"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb96-11" tabindex="-1"></a>  <span class="fu">library</span>(convey)</span>
<span id="cb96-12"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb96-12" tabindex="-1"></a>  <span class="fu">library</span>(sampling)</span>
<span id="cb96-13"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb96-13" tabindex="-1"></a>  </span>
<span id="cb96-14"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb96-14" tabindex="-1"></a>  <span class="co"># load pseudo population data</span></span>
<span id="cb96-15"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb96-15" tabindex="-1"></a>  <span class="fu">data</span>(<span class="st">&quot;eusilcP&quot;</span> , <span class="at">package =</span> <span class="st">&quot;simPop&quot;</span>)</span>
<span id="cb96-16"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb96-16" tabindex="-1"></a>  </span>
<span id="cb96-17"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb96-17" tabindex="-1"></a>  <span class="co"># compute size-like variable for PPS sampling design</span></span>
<span id="cb96-18"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb96-18" tabindex="-1"></a>  eusilcP<span class="sc">$</span>aux <span class="ot">&lt;-</span></span>
<span id="cb96-19"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb96-19" tabindex="-1"></a>    <span class="fu">log</span>(<span class="fu">ifelse</span>(eusilcP<span class="sc">$</span>eqIncome <span class="sc">&gt;=</span> <span class="dv">1000</span> , eusilcP<span class="sc">$</span>eqIncome , <span class="dv">1000</span>))</span>
<span id="cb96-20"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb96-20" tabindex="-1"></a>  </span>
<span id="cb96-21"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb96-21" tabindex="-1"></a>  </span>
<span id="cb96-22"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb96-22" tabindex="-1"></a>  <span class="co"># select sample</span></span>
<span id="cb96-23"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb96-23" tabindex="-1"></a>  tt <span class="ot">&lt;-</span></span>
<span id="cb96-24"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb96-24" tabindex="-1"></a>    sampling<span class="sc">::</span><span class="fu">cluster</span>(</span>
<span id="cb96-25"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb96-25" tabindex="-1"></a>      <span class="at">data =</span> eusilcP[<span class="fu">sample.int</span>(<span class="fu">nrow</span>(eusilcP) , <span class="fu">nrow</span>(eusilcP) , <span class="at">replace =</span> <span class="cn">FALSE</span>) , ] ,</span>
<span id="cb96-26"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb96-26" tabindex="-1"></a>      <span class="at">clustername =</span> <span class="st">&quot;hid&quot;</span> ,</span>
<span id="cb96-27"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb96-27" tabindex="-1"></a>      <span class="at">size =</span> 1000L ,</span>
<span id="cb96-28"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb96-28" tabindex="-1"></a>      <span class="at">method =</span> <span class="st">&quot;systematic&quot;</span> ,</span>
<span id="cb96-29"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb96-29" tabindex="-1"></a>      <span class="at">pik =</span> eusilcP<span class="sc">$</span>aux</span>
<span id="cb96-30"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb96-30" tabindex="-1"></a>    )</span>
<span id="cb96-31"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb96-31" tabindex="-1"></a>  </span>
<span id="cb96-32"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb96-32" tabindex="-1"></a>  <span class="co"># collect data</span></span>
<span id="cb96-33"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb96-33" tabindex="-1"></a>  this.sample <span class="ot">&lt;-</span> <span class="fu">getdata</span>(eusilcP , tt)</span>
<span id="cb96-34"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb96-34" tabindex="-1"></a>  </span>
<span id="cb96-35"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb96-35" tabindex="-1"></a>  <span class="co"># create survey design object</span></span>
<span id="cb96-36"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb96-36" tabindex="-1"></a>  this.desobj <span class="ot">&lt;-</span></span>
<span id="cb96-37"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb96-37" tabindex="-1"></a>    <span class="fu">svydesign</span>(</span>
<span id="cb96-38"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb96-38" tabindex="-1"></a>      <span class="at">ids =</span> <span class="sc">~</span> hid ,</span>
<span id="cb96-39"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb96-39" tabindex="-1"></a>      <span class="at">probs =</span> <span class="sc">~</span> Prob ,</span>
<span id="cb96-40"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb96-40" tabindex="-1"></a>      <span class="at">data =</span> this.sample ,</span>
<span id="cb96-41"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb96-41" tabindex="-1"></a>      <span class="at">nest =</span> <span class="cn">FALSE</span></span>
<span id="cb96-42"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb96-42" tabindex="-1"></a>    )</span>
<span id="cb96-43"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb96-43" tabindex="-1"></a>  </span>
<span id="cb96-44"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb96-44" tabindex="-1"></a>  <span class="co"># prepare for convey functions</span></span>
<span id="cb96-45"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb96-45" tabindex="-1"></a>  this.desobj <span class="ot">&lt;-</span> <span class="fu">convey_prep</span>(this.desobj)</span>
<span id="cb96-46"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb96-46" tabindex="-1"></a>  </span>
<span id="cb96-47"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb96-47" tabindex="-1"></a>  <span class="co"># compute estimates</span></span>
<span id="cb96-48"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb96-48" tabindex="-1"></a>  <span class="fu">svyarpr</span>( <span class="sc">~</span> eqIncome , this.desobj)</span>
<span id="cb96-49"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb96-49" tabindex="-1"></a>  </span>
<span id="cb96-50"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb96-50" tabindex="-1"></a>}</span>
<span id="cb96-51"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb96-51" tabindex="-1"></a></span>
<span id="cb96-52"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb96-52" tabindex="-1"></a><span class="co"># run replications</span></span>
<span id="cb96-53"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb96-53" tabindex="-1"></a>cl <span class="ot">&lt;-</span> <span class="fu">makeCluster</span>(<span class="fu">detectCores</span>() <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb96-54"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb96-54" tabindex="-1"></a></span>
<span id="cb96-55"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb96-55" tabindex="-1"></a>arpr.estimate.list <span class="ot">&lt;-</span></span>
<span id="cb96-56"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb96-56" tabindex="-1"></a>  <span class="fu">clusterApply</span>(cl, <span class="fu">seq_len</span>(mc.rep) , arpr_sim_fun)</span>
<span id="cb96-57"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb96-57" tabindex="-1"></a></span>
<span id="cb96-58"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb96-58" tabindex="-1"></a><span class="fu">stopCluster</span>(cl)</span></code></pre></div>
<p>Then, we evaluate the Percentage Relative Bias (PRB) of the ARPR estimator. Under this scenario, the PRB of the ARPR estimator is -0.19830%.</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb97-1" tabindex="-1"></a><span class="co"># estimate the expected value of the ARPR estimator</span></span>
<span id="cb97-2"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb97-2" tabindex="-1"></a><span class="co"># using the average of the estimates</span></span>
<span id="cb97-3"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb97-3" tabindex="-1"></a>(theta.exp <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">sapply</span>(arpr.estimate.list , coef)))</span></code></pre></div>
<pre><code>## [1] 0.1466381</code></pre>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb99-1" tabindex="-1"></a><span class="co"># estimate the percentage relative bias</span></span>
<span id="cb99-2"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb99-2" tabindex="-1"></a>(percentage_relative_bias_arpr <span class="ot">&lt;-</span> <span class="dv">100</span> <span class="sc">*</span> (theta.exp <span class="sc">/</span> theta.pop <span class="sc">-</span> <span class="dv">1</span>))</span></code></pre></div>
<pre><code>## [1] -0.1982981</code></pre>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb101-1" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">round</span>(percentage_relative_bias_arpr , <span class="dv">4</span>) <span class="sc">==</span> <span class="sc">-</span><span class="fl">0.19830</span>)</span></code></pre></div>
<p>For the variance estimator, we have:</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb102-1" tabindex="-1"></a><span class="co"># estimate the variance of the ARPR estimator</span></span>
<span id="cb102-2"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb102-2" tabindex="-1"></a><span class="co"># using the empirical variance of the estimates</span></span>
<span id="cb102-3"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb102-3" tabindex="-1"></a>(vartheta.popest <span class="ot">&lt;-</span> <span class="fu">var</span>(<span class="fu">sapply</span>(arpr.estimate.list , coef)))</span></code></pre></div>
<pre><code>## [1] 0.0001048728</code></pre>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb104-1" tabindex="-1"></a><span class="co"># estimate the expected value of the ARPR variance estimator</span></span>
<span id="cb104-2"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb104-2" tabindex="-1"></a><span class="co"># using the (estimated) expected value of the variance estimates</span></span>
<span id="cb104-3"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb104-3" tabindex="-1"></a>(vartheta.exp <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">sapply</span>(arpr.estimate.list , vcov)))</span></code></pre></div>
<pre><code>## [1] 0.0001081994</code></pre>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb106-1" tabindex="-1"></a><span class="co"># estimate the percentage relative bias of the variance estimator</span></span>
<span id="cb106-2"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb106-2" tabindex="-1"></a>( percentage_relative_bias_variance <span class="ot">&lt;-</span> <span class="dv">100</span> <span class="sc">*</span>  (vartheta.exp <span class="sc">/</span> vartheta.popest <span class="sc">-</span> <span class="dv">1</span>) )</span></code></pre></div>
<pre><code>## [1] 3.172023</code></pre>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb108-1" tabindex="-1"></a><span class="fu">stopifnot</span>( <span class="fu">round</span>( percentage_relative_bias_variance , <span class="dv">4</span> ) <span class="sc">==</span> <span class="fl">3.1720</span> ) </span></code></pre></div>
<p>Under this scenario, the PRB of the ARPR variance estimator is 3.1720%.</p>
<p>Our simulation shows that the Bias Ratio of this estimator is approximately 2%:</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb109-1" tabindex="-1"></a><span class="co"># compute bias ratio</span></span>
<span id="cb109-2"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb109-2" tabindex="-1"></a><span class="dv">100</span> <span class="sc">*</span> <span class="fu">abs</span>( theta.exp <span class="sc">-</span> theta.pop ) <span class="sc">/</span> <span class="fu">sqrt</span>( vartheta.popest )</span></code></pre></div>
<pre><code>## [1] 2.84509</code></pre>
<p>if the normal approximation holds, a small bias ratio still allows for approximately valid estimates of the confidence intervals.</p>
<p>Next, we evaluate the Percentage Coverage Rate (PCR). In theory, under repeated sampling, the estimated 95% CIs should cover the population parameter approximately 95% of the time. We can evaluate that using:</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb111-1" tabindex="-1"></a><span class="co"># estimate confidence intervals of the ARPR</span></span>
<span id="cb111-2"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb111-2" tabindex="-1"></a><span class="co"># for each of the samples</span></span>
<span id="cb111-3"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb111-3" tabindex="-1"></a>est.coverage <span class="ot">&lt;-</span></span>
<span id="cb111-4"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb111-4" tabindex="-1"></a>  <span class="fu">sapply</span>(arpr.estimate.list, <span class="cf">function</span>(this.stat)</span>
<span id="cb111-5"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb111-5" tabindex="-1"></a>    <span class="fu">confint</span>(this.stat)[, <span class="dv">1</span>] <span class="sc">&lt;=</span> theta.pop <span class="sc">&amp;</span></span>
<span id="cb111-6"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb111-6" tabindex="-1"></a>      <span class="fu">confint</span>(this.stat)[, <span class="dv">2</span>] <span class="sc">&gt;=</span> theta.pop)</span>
<span id="cb111-7"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb111-7" tabindex="-1"></a></span>
<span id="cb111-8"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb111-8" tabindex="-1"></a><span class="co"># evaluate empirical coverage</span></span>
<span id="cb111-9"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb111-9" tabindex="-1"></a>(empirical_coverage <span class="ot">&lt;-</span> <span class="fu">mean</span>(est.coverage))</span></code></pre></div>
<pre><code>## [1] 0.9516</code></pre>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="3.2-at-risk-of-poverty-ratio-svyarpr.html#cb113-1" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">round</span>(empirical_coverage , <span class="dv">2</span>) <span class="sc">==</span> <span class="fl">0.95</span>)</span></code></pre></div>
<p>Our coverages are not too far from the nominal coverage level of 95%.</p>
<p>For additional usage examples of <code>svyarpr</code>, type <code>?convey::svyarpr</code> in the R console.</p>
</div>
</div>
<p style="text-align: center;">
<a href="3.1-at-risk-of-poverty-threshold-svyarpt.html"><button class="btn btn-default">Previous</button></a>
<a href="3.3-relative-median-income-ratio-svyrmir.html"><button class="btn btn-default">Next</button></a>
</p>
</div>
</div>



</body>
</html>
