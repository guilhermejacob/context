<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="2.1 At Risk of Poverty Threshold (svyarpt) | Poverty and Inequality with Complex Survey Data" />
<meta property="og:type" content="book" />


<meta property="og:description" content="A book about the R convey package" />
<meta name="github-repo" content="guilhermejacob/context" />

<meta name="author" content="Guilherme Jacob, Anthony Damico, and Djalma Pessoa" />

<meta name="date" content="2020-05-21" />

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS_CHTML-full" type="text/javascript"></script>

<meta name="description" content="A book about the R convey package">

<title>2.1 At Risk of Poverty Threshold (svyarpt) | Poverty and Inequality with Complex Survey Data</title>

<link href="libs/tufte-css-2015.12.29/tufte-fonts.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte-background.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte-italics.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte.css" rel="stylesheet" />


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="toc.css" type="text/css" />

</head>

<body>



<div class="row">
<div class="col-sm-12">
<div id="TOC">
<ul>
<li class="has-sub"><a href="index.html#introduction"><span class="toc-section-number">1</span> Introduction</a><ul>
<li><a href="1-1-install.html#install"><span class="toc-section-number">1.1</span> Installation</a></li>
<li><a href="1-2-survey.html#survey"><span class="toc-section-number">1.2</span> Complex surveys and statistical inference</a></li>
<li><a href="1-3-usage-examples.html#usage-examples"><span class="toc-section-number">1.3</span> Usage Examples</a></li>
<li><a href="1-4-underlying-calculations.html#underlying-calculations"><span class="toc-section-number">1.4</span> Underlying Calculations</a></li>
<li><a href="1-5-the-variance-estimator.html#the-variance-estimator"><span class="toc-section-number">1.5</span> The Variance Estimator</a></li>
<li><a href="1-6-influence-functions.html#influence-functions"><span class="toc-section-number">1.6</span> Influence Functions</a></li>
<li><a href="1-7-influence-function-examples.html#influence-function-examples"><span class="toc-section-number">1.7</span> Influence Function Examples</a></li>
<li><a href="1-8-examples-of-linearization-using-the-influence-function.html#examples-of-linearization-using-the-influence-function"><span class="toc-section-number">1.8</span> Examples of Linearization Using the Influence Function</a></li>
<li><a href="1-9-replication-designs.html#replication-designs"><span class="toc-section-number">1.9</span> Replication Designs</a></li>
<li><a href="1-10-decomposition.html#decomposition"><span class="toc-section-number">1.10</span> Decomposition</a></li>
</ul></li>
<li class="has-sub"><a href="2-poverty.html#poverty"><span class="toc-section-number">2</span> Poverty Indices</a><ul>
<li><a href="2-1-at-risk-of-poverty-threshold-svyarpt.html#at-risk-of-poverty-threshold-svyarpt"><span class="toc-section-number">2.1</span> At Risk of Poverty Threshold (svyarpt)</a></li>
<li><a href="2-2-at-risk-of-poverty-ratio-svyarpr.html#at-risk-of-poverty-ratio-svyarpr"><span class="toc-section-number">2.2</span> At Risk of Poverty Ratio (svyarpr)</a></li>
<li><a href="2-3-relative-median-income-ratio-svyrmir.html#relative-median-income-ratio-svyrmir"><span class="toc-section-number">2.3</span> Relative Median Income Ratio (svyrmir)</a></li>
<li><a href="2-4-relative-median-poverty-gap-svyrmpg.html#relative-median-poverty-gap-svyrmpg"><span class="toc-section-number">2.4</span> Relative Median Poverty Gap (svyrmpg)</a></li>
<li><a href="2-5-median-income-below-the-at-risk-of-poverty-threshold-svypoormed.html#median-income-below-the-at-risk-of-poverty-threshold-svypoormed"><span class="toc-section-number">2.5</span> Median Income Below the At Risk of Poverty Threshold (svypoormed)</a></li>
<li><a href="2-6-foster-greer-thorbecke-class-svyfgt-svyfgtdec.html#foster-greer-thorbecke-class-svyfgt-svyfgtdec"><span class="toc-section-number">2.6</span> Foster-Greer-Thorbecke class (svyfgt, svyfgtdec)</a></li>
<li><a href="2-7-watts-poverty-measure-svywatts-svywattsdec.html#watts-poverty-measure-svywatts-svywattsdec"><span class="toc-section-number">2.7</span> Watts poverty measure (svywatts, svywattsdec)</a></li>
<li><a href="2-8-clark-hemming-ulph-class-of-poverty-measures-svychu.html#clark-hemming-ulph-class-of-poverty-measures-svychu"><span class="toc-section-number">2.8</span> Clark-Hemming-Ulph class of poverty measures (svychu)</a></li>
</ul></li>
<li class="has-sub"><a href="3-inequality.html#inequality"><span class="toc-section-number">3</span> Inequality Measurement</a><ul>
<li><a href="3-1-the-gender-pay-gap-svygpg.html#the-gender-pay-gap-svygpg"><span class="toc-section-number">3.1</span> The Gender Pay Gap (svygpg)</a></li>
<li><a href="3-2-quintile-share-ratio-svyqsr.html#quintile-share-ratio-svyqsr"><span class="toc-section-number">3.2</span> Quintile Share Ratio (svyqsr)</a></li>
<li><a href="3-3-lorenz-curve-svylorenz.html#lorenz-curve-svylorenz"><span class="toc-section-number">3.3</span> Lorenz Curve (svylorenz)</a></li>
<li><a href="3-4-gini-index-svygini.html#gini-index-svygini"><span class="toc-section-number">3.4</span> Gini index (svygini)</a></li>
<li><a href="3-5-amato-index-svyamato.html#amato-index-svyamato"><span class="toc-section-number">3.5</span> Amato index (svyamato)</a></li>
<li><a href="3-6-zenga-index-and-curve-svyzenga-svyzengacurve.html#zenga-index-and-curve-svyzenga-svyzengacurve"><span class="toc-section-number">3.6</span> Zenga Index and Curve (svyzenga, svyzengacurve)</a></li>
<li><a href="3-7-entropy-based-measures.html#entropy-based-measures"><span class="toc-section-number">3.7</span> Entropy-based Measures</a></li>
<li><a href="3-8-generalized-entropy-and-decomposition-svygei-svygeidec.html#generalized-entropy-and-decomposition-svygei-svygeidec"><span class="toc-section-number">3.8</span> Generalized Entropy and Decomposition (svygei, svygeidec)</a></li>
<li><a href="3-9-rényi-divergence-svyrenyi.html#rényi-divergence-svyrenyi"><span class="toc-section-number">3.9</span> Rényi Divergence (svyrenyi)</a></li>
<li><a href="3-10-j-divergence-and-decomposition-svyjdiv-svyjdivdec.html#j-divergence-and-decomposition-svyjdiv-svyjdivdec"><span class="toc-section-number">3.10</span> J-Divergence and Decomposition (svyjdiv, svyjdivdec)</a></li>
<li><a href="3-11-atkinson-index-svyatk.html#atkinson-index-svyatk"><span class="toc-section-number">3.11</span> Atkinson index (svyatk)</a></li>
<li><a href="3-12-which-inequality-measure-should-be-used.html#which-inequality-measure-should-be-used"><span class="toc-section-number">3.12</span> Which inequality measure should be used?</a></li>
</ul></li>
<li class="has-sub"><a href="4-multidimensional.html#multidimensional"><span class="toc-section-number">4</span> Multidimensional Indices</a><ul>
<li><a href="4-1-alkire-foster-class-and-decomposition-svyafc-svyafcdec.html#alkire-foster-class-and-decomposition-svyafc-svyafcdec"><span class="toc-section-number">4.1</span> Alkire-Foster Class and Decomposition (svyafc, svyafcdec)</a></li>
<li><a href="4-2-bourguignon-chakravarty-2003-multidimensional-poverty-class.html#bourguignon-chakravarty-2003-multidimensional-poverty-class"><span class="toc-section-number">4.2</span> Bourguignon-Chakravarty (2003) multidimensional poverty class</a></li>
<li><a href="4-3-bourguignon-1999-inequality-class-svybmi.html#bourguignon-1999-inequality-class-svybmi"><span class="toc-section-number">4.3</span> Bourguignon (1999) inequality class (svybmi)</a></li>
</ul></li>
</ul>
</div>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<div id="at-risk-of-poverty-threshold-svyarpt" class="section level2">
<h2><span class="header-section-number">2.1</span> At Risk of Poverty Threshold (svyarpt)</h2>
<p>The at-risk-of-poverty threshold (ARPT) is a measure used to define the people whose incomes imply a low standard of living in comparison to the general living standards. I.e., even though some people are not below the effective poverty line, those below the ARPT can be considered “almost deprived”.</p>
<p>This measure is defined as <span class="math inline">\(0.6\)</span> times the median income for the entire population:</p>
<p><span class="math display">\[
arpt = 0.6 \times median(y),
\]</span>
where, <span class="math inline">\(y\)</span> is the income variable and <code>median</code> is estimated for the whole population. The details of the linearization of the <code>arpt</code> are discussed by <span class="citation">Deville (<label for="tufte-mn-16" class="margin-toggle">&#8853;</label><input type="checkbox" id="tufte-mn-16" class="margin-toggle">1999<span class="marginnote">Deville, Jean-Claude. 1999. “Variance Estimation for Complex Statistics and Estimators: Linearization and Residual Techniques.” <em>Survey Methodology</em> 25 (2): 193–203. <a href="http://www.statcan.gc.ca/pub/12-001-x/1999002/article/4882-eng.pdf">http://www.statcan.gc.ca/pub/12-001-x/1999002/article/4882-eng.pdf</a>.</span>)</span> and <span class="citation">Osier (<label for="tufte-mn-17" class="margin-toggle">&#8853;</label><input type="checkbox" id="tufte-mn-17" class="margin-toggle">2009<span class="marginnote">Osier, Guillaume. 2009. “Variance Estimation for Complex Indicators of Poverty and Inequality.” <em>Journal of the European Survey Research Association</em> 3 (3): 167–95. <a href="http://ojs.ub.uni-konstanz.de/srm/article/view/369">http://ojs.ub.uni-konstanz.de/srm/article/view/369</a>.</span>)</span>.</p>
<hr />
<p><strong>A replication example</strong></p>
<p>The R <code>vardpoor</code> package <span class="citation">(Breidaks, Liberts, and Ivanova <label for="tufte-mn-18" class="margin-toggle">&#8853;</label><input type="checkbox" id="tufte-mn-18" class="margin-toggle">2016<span class="marginnote">Breidaks, Juris, Martins Liberts, and Santa Ivanova. 2016. “Vardpoor: Estimation of Indicators on Social Exclusion and Poverty and Its Linearization, Variance Estimation.” Riga, Latvia: CSB.</span>)</span>, created by researchers at the Central Statistical Bureau of Latvia, includes a arpt coefficient calculation using the ultimate cluster method. The example below reproduces those statistics.</p>
<p>Load and prepare the same data set:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1"><span class="co"># load the convey package</span></a>
<a class="sourceLine" id="cb27-2" data-line-number="2"><span class="kw">library</span>(convey)</a>
<a class="sourceLine" id="cb27-3" data-line-number="3"></a>
<a class="sourceLine" id="cb27-4" data-line-number="4"><span class="co"># load the survey library</span></a>
<a class="sourceLine" id="cb27-5" data-line-number="5"><span class="kw">library</span>(survey)</a>
<a class="sourceLine" id="cb27-6" data-line-number="6"></a>
<a class="sourceLine" id="cb27-7" data-line-number="7"><span class="co"># load the vardpoor library</span></a>
<a class="sourceLine" id="cb27-8" data-line-number="8"><span class="kw">library</span>(vardpoor)</a>
<a class="sourceLine" id="cb27-9" data-line-number="9"></a>
<a class="sourceLine" id="cb27-10" data-line-number="10"><span class="co"># load the laeken library</span></a>
<a class="sourceLine" id="cb27-11" data-line-number="11"><span class="kw">library</span>(laeken)</a>
<a class="sourceLine" id="cb27-12" data-line-number="12"></a>
<a class="sourceLine" id="cb27-13" data-line-number="13"><span class="co"># load the synthetic EU statistics on income &amp; living conditions</span></a>
<a class="sourceLine" id="cb27-14" data-line-number="14"><span class="kw">data</span>(eusilc)</a>
<a class="sourceLine" id="cb27-15" data-line-number="15"></a>
<a class="sourceLine" id="cb27-16" data-line-number="16"><span class="co"># make all column names lowercase</span></a>
<a class="sourceLine" id="cb27-17" data-line-number="17"><span class="kw">names</span>( eusilc ) &lt;-<span class="st"> </span><span class="kw">tolower</span>( <span class="kw">names</span>( eusilc ) )</a>
<a class="sourceLine" id="cb27-18" data-line-number="18"></a>
<a class="sourceLine" id="cb27-19" data-line-number="19"><span class="co"># add a column with the row number</span></a>
<a class="sourceLine" id="cb27-20" data-line-number="20">dati &lt;-<span class="st"> </span>data.table<span class="op">::</span><span class="kw">data.table</span>(<span class="dt">IDd =</span> <span class="dv">1</span> <span class="op">:</span><span class="st"> </span><span class="kw">nrow</span>(eusilc), eusilc)</a>
<a class="sourceLine" id="cb27-21" data-line-number="21"></a>
<a class="sourceLine" id="cb27-22" data-line-number="22"><span class="co"># calculate the arpt coefficient</span></a>
<a class="sourceLine" id="cb27-23" data-line-number="23"><span class="co"># using the R vardpoor library</span></a>
<a class="sourceLine" id="cb27-24" data-line-number="24">varpoord_arpt_calculation &lt;-</a>
<a class="sourceLine" id="cb27-25" data-line-number="25"><span class="st">    </span><span class="kw">varpoord</span>(</a>
<a class="sourceLine" id="cb27-26" data-line-number="26">    </a>
<a class="sourceLine" id="cb27-27" data-line-number="27">        <span class="co"># analysis variable</span></a>
<a class="sourceLine" id="cb27-28" data-line-number="28">        <span class="dt">Y =</span> <span class="st">&quot;eqincome&quot;</span>, </a>
<a class="sourceLine" id="cb27-29" data-line-number="29">        </a>
<a class="sourceLine" id="cb27-30" data-line-number="30">        <span class="co"># weights variable</span></a>
<a class="sourceLine" id="cb27-31" data-line-number="31">        <span class="dt">w_final =</span> <span class="st">&quot;rb050&quot;</span>,</a>
<a class="sourceLine" id="cb27-32" data-line-number="32">        </a>
<a class="sourceLine" id="cb27-33" data-line-number="33">        <span class="co"># row number variable</span></a>
<a class="sourceLine" id="cb27-34" data-line-number="34">        <span class="dt">ID_level1 =</span> <span class="st">&quot;IDd&quot;</span>,</a>
<a class="sourceLine" id="cb27-35" data-line-number="35">        </a>
<a class="sourceLine" id="cb27-36" data-line-number="36">        <span class="co"># row number variable</span></a>
<a class="sourceLine" id="cb27-37" data-line-number="37">        <span class="dt">ID_level2 =</span> <span class="st">&quot;IDd&quot;</span>,</a>
<a class="sourceLine" id="cb27-38" data-line-number="38">        </a>
<a class="sourceLine" id="cb27-39" data-line-number="39">        <span class="co"># strata variable</span></a>
<a class="sourceLine" id="cb27-40" data-line-number="40">        <span class="dt">H =</span> <span class="st">&quot;db040&quot;</span>, </a>
<a class="sourceLine" id="cb27-41" data-line-number="41">        </a>
<a class="sourceLine" id="cb27-42" data-line-number="42">        <span class="dt">N_h =</span> <span class="ot">NULL</span> ,</a>
<a class="sourceLine" id="cb27-43" data-line-number="43">        </a>
<a class="sourceLine" id="cb27-44" data-line-number="44">        <span class="co"># clustering variable</span></a>
<a class="sourceLine" id="cb27-45" data-line-number="45">        <span class="dt">PSU =</span> <span class="st">&quot;rb030&quot;</span>, </a>
<a class="sourceLine" id="cb27-46" data-line-number="46">        </a>
<a class="sourceLine" id="cb27-47" data-line-number="47">        <span class="co"># data.table</span></a>
<a class="sourceLine" id="cb27-48" data-line-number="48">        <span class="dt">dataset =</span> dati, </a>
<a class="sourceLine" id="cb27-49" data-line-number="49">        </a>
<a class="sourceLine" id="cb27-50" data-line-number="50">        <span class="co"># arpt coefficient function</span></a>
<a class="sourceLine" id="cb27-51" data-line-number="51">        <span class="dt">type =</span> <span class="st">&quot;linarpt&quot;</span>,</a>
<a class="sourceLine" id="cb27-52" data-line-number="52">      </a>
<a class="sourceLine" id="cb27-53" data-line-number="53">      <span class="co"># poverty threshold range</span></a>
<a class="sourceLine" id="cb27-54" data-line-number="54">      <span class="dt">order_quant =</span> 50L ,</a>
<a class="sourceLine" id="cb27-55" data-line-number="55">      </a>
<a class="sourceLine" id="cb27-56" data-line-number="56">        <span class="co"># get linearized variable</span></a>
<a class="sourceLine" id="cb27-57" data-line-number="57">      <span class="dt">outp_lin =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb27-58" data-line-number="58">    )</a>
<a class="sourceLine" id="cb27-59" data-line-number="59"></a>
<a class="sourceLine" id="cb27-60" data-line-number="60"></a>
<a class="sourceLine" id="cb27-61" data-line-number="61"><span class="co"># construct a survey.design</span></a>
<a class="sourceLine" id="cb27-62" data-line-number="62"><span class="co"># using our recommended setup</span></a>
<a class="sourceLine" id="cb27-63" data-line-number="63">des_eusilc &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb27-64" data-line-number="64"><span class="st">    </span><span class="kw">svydesign</span>( </a>
<a class="sourceLine" id="cb27-65" data-line-number="65">        <span class="dt">ids =</span> <span class="op">~</span><span class="st"> </span>rb030 , </a>
<a class="sourceLine" id="cb27-66" data-line-number="66">        <span class="dt">strata =</span> <span class="op">~</span><span class="st"> </span>db040 ,  </a>
<a class="sourceLine" id="cb27-67" data-line-number="67">        <span class="dt">weights =</span> <span class="op">~</span><span class="st"> </span>rb050 , </a>
<a class="sourceLine" id="cb27-68" data-line-number="68">        <span class="dt">data =</span> eusilc</a>
<a class="sourceLine" id="cb27-69" data-line-number="69">    )</a>
<a class="sourceLine" id="cb27-70" data-line-number="70"></a>
<a class="sourceLine" id="cb27-71" data-line-number="71"><span class="co"># immediately run the convey_prep function on it</span></a>
<a class="sourceLine" id="cb27-72" data-line-number="72">des_eusilc &lt;-<span class="st"> </span><span class="kw">convey_prep</span>( des_eusilc )</a>
<a class="sourceLine" id="cb27-73" data-line-number="73"></a>
<a class="sourceLine" id="cb27-74" data-line-number="74"><span class="co"># coefficients do match</span></a>
<a class="sourceLine" id="cb27-75" data-line-number="75">varpoord_arpt_calculation<span class="op">$</span>all_result<span class="op">$</span>value</a></code></pre></div>
<pre><code>## [1] 10859.24</code></pre>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" data-line-number="1"><span class="kw">coef</span>( <span class="kw">svyarpt</span>( <span class="op">~</span><span class="st"> </span>eqincome , des_eusilc ) )</a></code></pre></div>
<pre><code>## eqincome 
## 10859.24</code></pre>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" data-line-number="1"><span class="co"># linearized variables do match</span></a>
<a class="sourceLine" id="cb31-2" data-line-number="2"><span class="co"># vardpoor</span></a>
<a class="sourceLine" id="cb31-3" data-line-number="3">lin_arpt_varpoord&lt;-<span class="st"> </span>varpoord_arpt_calculation<span class="op">$</span>lin_out<span class="op">$</span>lin_arpt</a>
<a class="sourceLine" id="cb31-4" data-line-number="4"><span class="co"># convey </span></a>
<a class="sourceLine" id="cb31-5" data-line-number="5">lin_arpt_convey &lt;-<span class="st"> </span><span class="kw">attr</span>(<span class="kw">svyarpt</span>( <span class="op">~</span><span class="st"> </span>eqincome , des_eusilc ),<span class="st">&quot;lin&quot;</span>)</a>
<a class="sourceLine" id="cb31-6" data-line-number="6"></a>
<a class="sourceLine" id="cb31-7" data-line-number="7"><span class="co"># check equality</span></a>
<a class="sourceLine" id="cb31-8" data-line-number="8"><span class="kw">all.equal</span>(lin_arpt_varpoord, lin_arpt_convey )</a></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" data-line-number="1"><span class="co"># variances do not match exactly</span></a>
<a class="sourceLine" id="cb33-2" data-line-number="2"><span class="kw">attr</span>( <span class="kw">svyarpt</span>( <span class="op">~</span><span class="st"> </span>eqincome , des_eusilc ) , <span class="st">&#39;var&#39;</span> )</a></code></pre></div>
<pre><code>##          eqincome
## eqincome 2564.027</code></pre>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" data-line-number="1">varpoord_arpt_calculation<span class="op">$</span>all_result<span class="op">$</span>var</a></code></pre></div>
<pre><code>## [1] 2559.442</code></pre>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb37-1" data-line-number="1"><span class="co"># standard errors do not match exactly</span></a>
<a class="sourceLine" id="cb37-2" data-line-number="2">varpoord_arpt_calculation<span class="op">$</span>all_result<span class="op">$</span>se</a></code></pre></div>
<pre><code>## [1] 50.59093</code></pre>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb39-1" data-line-number="1"><span class="kw">SE</span>( <span class="kw">svyarpt</span>( <span class="op">~</span><span class="st"> </span>eqincome , des_eusilc ) )</a></code></pre></div>
<pre><code>##          eqincome
## eqincome 50.63622</code></pre>
<p>The variance estimate is computed by using the approximation defined in <a href="1-5-the-variance-estimator.html#eq:var">(1.1)</a>, where the linearized variable <span class="math inline">\(z\)</span> is defined by <a href="1-5-the-variance-estimator.html#eq:lin">(1.2)</a>. The functions <code>convey::svyarpt</code> and <code>vardpoor::linarpt</code> produce the same linearized variable <span class="math inline">\(z\)</span>.</p>
<p>However, the measures of uncertainty do not line up, because <code>library(vardpoor)</code> defaults to an ultimate cluster method that can be replicated with an alternative setup of the <code>survey.design</code> object.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb41-1" data-line-number="1"><span class="co"># within each strata, sum up the weights</span></a>
<a class="sourceLine" id="cb41-2" data-line-number="2">cluster_sums &lt;-<span class="st"> </span><span class="kw">aggregate</span>( eusilc<span class="op">$</span>rb050 , <span class="kw">list</span>( eusilc<span class="op">$</span>db040 ) , sum )</a>
<a class="sourceLine" id="cb41-3" data-line-number="3"></a>
<a class="sourceLine" id="cb41-4" data-line-number="4"><span class="co"># name the within-strata sums of weights the `cluster_sum`</span></a>
<a class="sourceLine" id="cb41-5" data-line-number="5"><span class="kw">names</span>( cluster_sums ) &lt;-<span class="st"> </span><span class="kw">c</span>( <span class="st">&quot;db040&quot;</span> , <span class="st">&quot;cluster_sum&quot;</span> )</a>
<a class="sourceLine" id="cb41-6" data-line-number="6"></a>
<a class="sourceLine" id="cb41-7" data-line-number="7"><span class="co"># merge this column back onto the data.frame</span></a>
<a class="sourceLine" id="cb41-8" data-line-number="8">eusilc &lt;-<span class="st"> </span><span class="kw">merge</span>( eusilc , cluster_sums )</a>
<a class="sourceLine" id="cb41-9" data-line-number="9"></a>
<a class="sourceLine" id="cb41-10" data-line-number="10"><span class="co"># construct a survey.design</span></a>
<a class="sourceLine" id="cb41-11" data-line-number="11"><span class="co"># with the fpc using the cluster sum</span></a>
<a class="sourceLine" id="cb41-12" data-line-number="12">des_eusilc_ultimate_cluster &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb41-13" data-line-number="13"><span class="st">    </span><span class="kw">svydesign</span>( </a>
<a class="sourceLine" id="cb41-14" data-line-number="14">        <span class="dt">ids =</span> <span class="op">~</span><span class="st"> </span>rb030 , </a>
<a class="sourceLine" id="cb41-15" data-line-number="15">        <span class="dt">strata =</span> <span class="op">~</span><span class="st"> </span>db040 ,  </a>
<a class="sourceLine" id="cb41-16" data-line-number="16">        <span class="dt">weights =</span> <span class="op">~</span><span class="st"> </span>rb050 , </a>
<a class="sourceLine" id="cb41-17" data-line-number="17">        <span class="dt">data =</span> eusilc , </a>
<a class="sourceLine" id="cb41-18" data-line-number="18">        <span class="dt">fpc =</span> <span class="op">~</span><span class="st"> </span>cluster_sum </a>
<a class="sourceLine" id="cb41-19" data-line-number="19">    )</a>
<a class="sourceLine" id="cb41-20" data-line-number="20"></a>
<a class="sourceLine" id="cb41-21" data-line-number="21"><span class="co"># again, immediately run the convey_prep function on the `survey.design`</span></a>
<a class="sourceLine" id="cb41-22" data-line-number="22">des_eusilc_ultimate_cluster &lt;-<span class="st"> </span><span class="kw">convey_prep</span>( des_eusilc_ultimate_cluster )</a>
<a class="sourceLine" id="cb41-23" data-line-number="23"></a>
<a class="sourceLine" id="cb41-24" data-line-number="24"><span class="co"># matches</span></a>
<a class="sourceLine" id="cb41-25" data-line-number="25"><span class="kw">attr</span>( <span class="kw">svyarpt</span>( <span class="op">~</span><span class="st"> </span>eqincome , des_eusilc_ultimate_cluster ) , <span class="st">&#39;var&#39;</span> )</a></code></pre></div>
<pre><code>##          eqincome
## eqincome 2559.442</code></pre>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb43-1" data-line-number="1">varpoord_arpt_calculation<span class="op">$</span>all_result<span class="op">$</span>var</a></code></pre></div>
<pre><code>## [1] 2559.442</code></pre>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb45-1" data-line-number="1"><span class="co"># matches</span></a>
<a class="sourceLine" id="cb45-2" data-line-number="2">varpoord_arpt_calculation<span class="op">$</span>all_result<span class="op">$</span>se</a></code></pre></div>
<pre><code>## [1] 50.59093</code></pre>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb47-1" data-line-number="1"><span class="kw">SE</span>( <span class="kw">svyarpt</span>( <span class="op">~</span><span class="st"> </span>eqincome , des_eusilc_ultimate_cluster ) )</a></code></pre></div>
<pre><code>##          eqincome
## eqincome 50.59093</code></pre>
<p>For additional usage examples of <code>svyarpt</code>, type <code>?convey::svyarpt</code> in the R console.</p>
</div>
<p style="text-align: center;">
<a href="2-poverty.html"><button class="btn btn-default">Previous</button></a>
<a href="2-2-at-risk-of-poverty-ratio-svyarpr.html"><button class="btn btn-default">Next</button></a>
</p>
</div>
</div>



</body>
</html>
